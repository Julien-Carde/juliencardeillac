"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[34],{4788:function(e,t,r){r.d(t,{qA:function(){return eu}});var a=r(3428),n=r(2265),i=r(2955),o=r(6375);let s=e=>e&&e.isCubeTexture;class l extends o.Mesh{constructor(e,t){var r,a;let n=s(e),i=Math.floor(Math.log2((null!=(a=n?null==(r=e.image[0])?void 0:r.width:e.image.width)?a:1024)/4)),l=Math.pow(2,i),u=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,f=[n?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/(3*Math.max(l,112))}`,`#define CUBEUV_TEXEL_HEIGHT ${1/(4*l)}`,`#define CUBEUV_MAX_MIP ${i}.0`].join("\n")+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${parseInt(o.REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `;super(new o.IcosahedronGeometry(1,16),new o.ShaderMaterial({uniforms:{map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}},fragmentShader:f,vertexShader:u,side:o.DoubleSide}))}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}class u extends o.DataTextureLoader{constructor(e){super(e),this.type=o.HalfFloatType}parse(e){let t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:console.error("THREE.RGBELoader: Error: "+(t||""))}return -1},r=function(e,t,r){t=t||1024;let a=e.pos,n=-1,i=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+128)));for(;0>(n=s.indexOf("\n"))&&i<t&&a<e.byteLength;)o+=s,i+=s.length,a+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+128)));return -1<n&&(!1!==r&&(e.pos+=i+n+1),o+s.slice(0,n))},a=new Uint8Array(e);a.pos=0;let n=function(e){let a,n;let i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(a=r(e)))return t(1,"no header found");if(!(n=a.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(u.valid|=1,u.programtype=n[1],u.string+=a+"\n";!1!==(a=r(e));){if(u.string+=a+"\n","#"===a.charAt(0)){u.comments+=a+"\n";continue}if((n=a.match(i))&&(u.gamma=parseFloat(n[1])),(n=a.match(o))&&(u.exposure=parseFloat(n[1])),(n=a.match(s))&&(u.valid|=2,u.format=n[1]),(n=a.match(l))&&(u.valid|=4,u.height=parseInt(n[1],10),u.width=parseInt(n[2],10)),2&u.valid&&4&u.valid)break}return 2&u.valid?4&u.valid?u:t(3,"missing image size specifier"):t(3,"missing format specifier")}(a);if(-1!==n){let e=n.width,r=n.height,i=function(e,r,a){if(r<8||r>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(r!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");let n=new Uint8Array(4*r*a);if(!n.length)return t(4,"unable to allocate buffer space");let i=0,o=0,s=4*r,l=new Uint8Array(4),u=new Uint8Array(s),f=a;for(;f>0&&o<e.byteLength;){if(o+4>e.byteLength)return t(1);if(l[0]=e[o++],l[1]=e[o++],l[2]=e[o++],l[3]=e[o++],2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=r)return t(3,"bad rgbe scanline format");let a=0,c;for(;a<s&&o<e.byteLength;){let r=(c=e[o++])>128;if(r&&(c-=128),0===c||a+c>s)return t(3,"bad scanline data");if(r){let t=e[o++];for(let e=0;e<c;e++)u[a++]=t}else u.set(e.subarray(o,o+c),a),a+=c,o+=c}for(let e=0;e<r;e++){let t=0;n[i]=u[e+t],t+=r,n[i+1]=u[e+t],t+=r,n[i+2]=u[e+t],t+=r,n[i+3]=u[e+t],i+=4}f--}return n}(a.subarray(a.pos),e,r);if(-1!==i){let t,a,s;switch(this.type){case o.FloatType:s=i.length/4;let l=new Float32Array(4*s);for(let e=0;e<s;e++)!function(e,t,r,a){let n=Math.pow(2,e[t+3]-128)/255;r[a+0]=e[t+0]*n,r[a+1]=e[t+1]*n,r[a+2]=e[t+2]*n,r[a+3]=1}(i,4*e,l,4*e);t=l,a=o.FloatType;break;case o.HalfFloatType:s=i.length/4;let u=new Uint16Array(4*s);for(let e=0;e<s;e++)!function(e,t,r,a){let n=Math.pow(2,e[t+3]-128)/255;r[a+0]=o.DataUtils.toHalfFloat(Math.min(e[t+0]*n,65504)),r[a+1]=o.DataUtils.toHalfFloat(Math.min(e[t+1]*n,65504)),r[a+2]=o.DataUtils.toHalfFloat(Math.min(e[t+2]*n,65504)),r[a+3]=o.DataUtils.toHalfFloat(1)}(i,4*e,u,4*e);t=u,a=o.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:r,data:t,header:n.string,gamma:n.gamma,exposure:n.exposure,type:a}}}return null}setDataType(e){return this.type=e,this}load(e,t,r,a){return super.load(e,function(e,r){switch(e.type){case o.FloatType:case o.HalfFloatType:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=o.LinearFilter,e.magFilter=o.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,a)}}var f={},c=Uint8Array,h=Uint16Array,d=Uint32Array,p=new c([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),v=new c([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),g=new c([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),m=function(e,t){for(var r=new h(31),a=0;a<31;++a)r[a]=t+=1<<e[a-1];for(var n=new d(r[30]),a=1;a<30;++a)for(var i=r[a];i<r[a+1];++i)n[i]=i-r[a]<<5|a;return[r,n]},y=m(p,2),b=y[0],w=y[1];b[28]=258,w[258]=28;for(var S=m(v,0),x=S[0],_=S[1],U=new h(32768),k=0;k<32768;++k){var T=(43690&k)>>>1|(21845&k)<<1;T=(61680&(T=(52428&T)>>>2|(13107&T)<<2))>>>4|(3855&T)<<4,U[k]=((65280&T)>>>8|(255&T)<<8)>>>1}for(var C=function(e,t,r){for(var a,n=e.length,i=0,o=new h(t);i<n;++i)++o[e[i]-1];var s=new h(t);for(i=0;i<t;++i)s[i]=s[i-1]+o[i-1]<<1;if(r){a=new h(1<<t);var l=15-t;for(i=0;i<n;++i)if(e[i])for(var u=i<<4|e[i],f=t-e[i],c=s[e[i]-1]++<<f,d=c|(1<<f)-1;c<=d;++c)a[U[c]>>>l]=u}else for(i=0,a=new h(n);i<n;++i)e[i]&&(a[i]=U[s[e[i]-1]++]>>>15-e[i]);return a},M=new c(288),k=0;k<144;++k)M[k]=8;for(var k=144;k<256;++k)M[k]=9;for(var k=256;k<280;++k)M[k]=7;for(var k=280;k<288;++k)M[k]=8;for(var F=new c(32),k=0;k<32;++k)F[k]=5;var E=C(M,9,1),A=C(F,5,1),I=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},R=function(e,t,r){var a=t/8|0;return(e[a]|e[a+1]<<8)>>(7&t)&r},P=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},D=function(e){return(e/8|0)+(7&e&&1)},O=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var a=new(e instanceof h?h:e instanceof d?d:c)(r-t);return a.set(e.subarray(t,r)),a},B=function(e,t,r){var a=e.length;if(!a||r&&!r.l&&a<5)return t||new c(0);var n=!t||r,i=!r||r.i;r||(r={}),t||(t=new c(3*a));var o=function(e){var r=t.length;if(e>r){var a=new c(Math.max(2*r,e));a.set(t),t=a}},s=r.f||0,l=r.p||0,u=r.b||0,f=r.l,h=r.d,d=r.m,m=r.n,y=8*a;do{if(!f){r.f=s=R(e,l,1);var w=R(e,l+1,3);if(l+=3,w){if(1==w)f=E,h=A,d=9,m=5;else if(2==w){var S=R(e,l,31)+257,_=R(e,l+10,15)+4,U=S+R(e,l+5,31)+1;l+=14;for(var k=new c(U),T=new c(19),M=0;M<_;++M)T[g[M]]=R(e,l+3*M,7);l+=3*_;for(var F=I(T),B=(1<<F)-1,L=C(T,F,1),M=0;M<U;){var G=L[R(e,l,B)];l+=15&G;var z=G>>>4;if(z<16)k[M++]=z;else{var V=0,j=0;for(16==z?(j=3+R(e,l,3),l+=2,V=k[M-1]):17==z?(j=3+R(e,l,7),l+=3):18==z&&(j=11+R(e,l,127),l+=7);j--;)k[M++]=V}}var N=k.subarray(0,S),W=k.subarray(S);d=I(N),m=I(W),f=C(N,d,1),h=C(W,m,1)}else throw"invalid block type"}else{var z=D(l)+4,q=e[z-4]|e[z-3]<<8,$=z+q;if($>a){if(i)throw"unexpected EOF";break}n&&o(u+q),t.set(e.subarray(z,$),u),r.b=u+=q,r.p=l=8*$;continue}if(l>y){if(i)throw"unexpected EOF";break}}n&&o(u+131072);for(var X=(1<<d)-1,H=(1<<m)-1,Y=l;;Y=l){var V=f[P(e,l)&X],Q=V>>>4;if((l+=15&V)>y){if(i)throw"unexpected EOF";break}if(!V)throw"invalid length/literal";if(Q<256)t[u++]=Q;else if(256==Q){Y=l,f=null;break}else{var Z=Q-254;if(Q>264){var M=Q-257,K=p[M];Z=R(e,l,(1<<K)-1)+b[M],l+=K}var J=h[P(e,l)&H],ee=J>>>4;if(!J)throw"invalid distance";l+=15&J;var W=x[ee];if(ee>3){var K=v[ee];W+=P(e,l)&(1<<K)-1,l+=K}if(l>y){if(i)throw"unexpected EOF";break}n&&o(u+131072);for(var et=u+Z;u<et;u+=4)t[u]=t[u-W],t[u+1]=t[u+1-W],t[u+2]=t[u+2-W],t[u+3]=t[u+3-W];u=et}}r.l=f,r.p=Y,r.b=u,f&&(s=1,r.m=d,r.d=h,r.n=m)}while(!s);return u==t.length?t:O(t,0,u)},L=function(e,t,r){r<<=7&t;var a=t/8|0;e[a]|=r,e[a+1]|=r>>>8},G=function(e,t,r){r<<=7&t;var a=t/8|0;e[a]|=r,e[a+1]|=r>>>8,e[a+2]|=r>>>16},z=function(e,t){for(var r=[],a=0;a<e.length;++a)e[a]&&r.push({s:a,f:e[a]});var n=r.length,i=r.slice();if(!n)return[X,0];if(1==n){var o=new c(r[0].s+1);return o[r[0].s]=1,[o,1]}r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var s=r[0],l=r[1],u=0,f=1,d=2;for(r[0]={s:-1,f:s.f+l.f,l:s,r:l};f!=n-1;)s=r[r[u].f<r[d].f?u++:d++],l=r[u!=f&&r[u].f<r[d].f?u++:d++],r[f++]={s:-1,f:s.f+l.f,l:s,r:l};for(var p=i[0].s,a=1;a<n;++a)i[a].s>p&&(p=i[a].s);var v=new h(p+1),g=V(r[f-1],v,0);if(g>t){var a=0,m=0,y=g-t,b=1<<y;for(i.sort(function(e,t){return v[t.s]-v[e.s]||e.f-t.f});a<n;++a){var w=i[a].s;if(v[w]>t)m+=b-(1<<g-v[w]),v[w]=t;else break}for(m>>>=y;m>0;){var S=i[a].s;v[S]<t?m-=1<<t-v[S]++-1:++a}for(;a>=0&&m;--a){var x=i[a].s;v[x]==t&&(--v[x],++m)}g=t}return[new c(v),g]},V=function(e,t,r){return -1==e.s?Math.max(V(e.l,t,r+1),V(e.r,t,r+1)):t[e.s]=r},j=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new h(++t),a=0,n=e[0],i=1,o=function(e){r[a++]=e},s=1;s<=t;++s)if(e[s]==n&&s!=t)++i;else{if(!n&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(n),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(n);i=1,n=e[s]}return[r.subarray(0,a),t]},N=function(e,t){for(var r=0,a=0;a<t.length;++a)r+=e[a]*t[a];return r},W=function(e,t,r){var a=r.length,n=D(t+2);e[n]=255&a,e[n+1]=a>>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var i=0;i<a;++i)e[n+i+4]=r[i];return(n+4+a)*8},q=function(e,t,r,a,n,i,o,s,l,u,f){L(t,f++,r),++n[256];for(var c,d,m,y,b=z(n,15),w=b[0],S=b[1],x=z(i,15),_=x[0],U=x[1],k=j(w),T=k[0],E=k[1],A=j(_),I=A[0],R=A[1],P=new h(19),D=0;D<T.length;++D)P[31&T[D]]++;for(var D=0;D<I.length;++D)P[31&I[D]]++;for(var O=z(P,7),B=O[0],V=O[1],q=19;q>4&&!B[g[q-1]];--q);var $=u+5<<3,X=N(n,M)+N(i,F)+o,H=N(n,w)+N(i,_)+o+14+3*q+N(P,B)+(2*P[16]+3*P[17]+7*P[18]);if($<=X&&$<=H)return W(t,f,e.subarray(l,l+u));if(L(t,f,1+(H<X)),f+=2,H<X){c=C(w,S,0),d=w,m=C(_,U,0),y=_;var Y=C(B,V,0);L(t,f,E-257),L(t,f+5,R-1),L(t,f+10,q-4),f+=14;for(var D=0;D<q;++D)L(t,f+3*D,B[g[D]]);f+=3*q;for(var Q=[T,I],Z=0;Z<2;++Z)for(var K=Q[Z],D=0;D<K.length;++D){var J=31&K[D];L(t,f,Y[J]),f+=B[J],J>15&&(L(t,f,K[D]>>>5&127),f+=K[D]>>>12)}}else c=null,d=M,m=null,y=F;for(var D=0;D<s;++D)if(a[D]>255){var J=a[D]>>>18&31;G(t,f,c[J+257]),f+=d[J+257],J>7&&(L(t,f,a[D]>>>23&31),f+=p[J]);var ee=31&a[D];G(t,f,m[ee]),f+=y[ee],ee>3&&(G(t,f,a[D]>>>5&8191),f+=v[ee])}else G(t,f,c[a[D]]),f+=d[a[D]];return G(t,f,c[256]),f+d[256]},$=new d([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),X=new c(0),H=function(e){if((15&e[0])!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function Y(e,t){return B((H(e),e.subarray(2,-4)),t)}var Q="undefined"!=typeof TextDecoder&&new TextDecoder;try{Q.decode(X,{stream:!0})}catch(e){}let Z="colorSpace"in new o.Texture;class K extends o.DataTextureLoader{constructor(e){super(e),this.type=o.HalfFloatType}parse(e){let t={l:0,c:0,lc:0};function r(e,r,a,n,i){for(;a<e;)r=r<<8|T(n,i),a+=8;a-=e,t.l=r>>a&(1<<e)-1,t.c=r,t.lc=a}let a=Array(59),n={c:0,lc:0};function i(e,t,r,a){e=e<<8|T(r,a),t+=8,n.c=e,n.lc=t}let s={c:0,lc:0};function l(e,t,r,a,o,l,u,f,c,h){if(e==t){a<8&&(i(r,a,o,u),r=n.c,a=n.lc);var d=r>>(a-=8),d=new Uint8Array([d])[0];if(c.value+d>h)return!1;for(var p=f[c.value-1];d-- >0;)f[c.value++]=p}else{if(!(c.value<h))return!1;f[c.value++]=e}s.c=r,s.lc=a}function u(e){var t=65535&e;return t>32767?t-65536:t}let f={a:0,b:0};function c(e,t){var r=u(e),a=u(t),n=r+(1&a)+(a>>1),i=n-a;f.a=n,f.b=i}function h(e,t){var r=65535&t,a=(65535&e)-(r>>1)&65535;f.a=r+a-32768&65535,f.b=a}function d(e,o,u,f,c,h){var d=u.value,p=k(o,u),v=k(o,u);u.value+=4;var g=k(o,u);if(u.value+=4,p<0||p>=65537||v<0||v>=65537)throw"Something wrong with HUF_ENCSIZE";var m=Array(65537),y=Array(16384);!function(e){for(var t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(y);var b=f-(u.value-d);if(!function(e,n,i,o,s,l,u){for(var f=0,c=0;s<=l;s++){if(i.value-i.value>o)return!1;r(6,f,c,e,i);var h=t.l;if(f=t.c,c=t.lc,u[s]=h,63==h){if(i.value-i.value>o)throw"Something wrong with hufUnpackEncTable";r(8,f,c,e,i);var d=t.l+6;if(f=t.c,c=t.lc,s+d>l+1)throw"Something wrong with hufUnpackEncTable";for(;d--;)u[s++]=0;s--}else if(h>=59){var d=h-59+2;if(s+d>l+1)throw"Something wrong with hufUnpackEncTable";for(;d--;)u[s++]=0;s--}}!function(e){for(var t=0;t<=58;++t)a[t]=0;for(var t=0;t<65537;++t)a[e[t]]+=1;for(var r=0,t=58;t>0;--t){var n=r+a[t]>>1;a[t]=r,r=n}for(var t=0;t<65537;++t){var i=e[t];i>0&&(e[t]=i|a[i]++<<6)}}(u)}(e,0,u,b,p,v,m),g>8*(f-(u.value-d)))throw"Something wrong with hufUncompress";!function(e,t,r,a){for(;t<=r;t++){var n=e[t]>>6,i=63&e[t];if(n>>i)throw"Invalid table entry";if(i>14){var o=a[n>>i-14];if(o.len)throw"Invalid table entry";if(o.lit++,o.p){var s=o.p;o.p=Array(o.lit);for(var l=0;l<o.lit-1;++l)o.p[l]=s[l]}else o.p=[,];o.p[o.lit-1]=t}else if(i)for(var u=0,l=1<<14-i;l>0;l--){var o=a[(n<<14-i)+u];if(o.len||o.p)throw"Invalid table entry";o.len=i,o.lit=t,u++}}}(m,p,v,y),function(e,t,r,a,o,u,f,c,h,d){for(var p=0,v=0,g=Math.trunc(o.value+(u+7)/8);o.value<g;)for(i(p,v,r,o),p=n.c,v=n.lc;v>=14;){var m=t[p>>v-14&16383];if(m.len)v-=m.len,l(m.lit,f,p,v,r,a,o,h,d,c),p=s.c,v=s.lc;else{if(!m.p)throw"hufDecode issues";for(y=0;y<m.lit;y++){for(var y,b=63&e[m.p[y]];v<b&&o.value<g;)i(p,v,r,o),p=n.c,v=n.lc;if(v>=b&&e[m.p[y]]>>6==(p>>v-b&(1<<b)-1)){v-=b,l(m.p[y],f,p,v,r,a,o,h,d,c),p=s.c,v=s.lc;break}}if(y==m.lit)throw"hufDecode issues"}}var w=8-u&7;for(p>>=w,v-=w;v>0;){var m=t[p<<14-v&16383];if(m.len)v-=m.len,l(m.lit,f,p,v,r,a,o,h,d,c),p=s.c,v=s.lc;else throw"hufDecode issues"}}(m,y,e,o,u,g,v,h,c,{value:0})}function p(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function v(e,t){for(var r=0,a=Math.floor((e.length+1)/2),n=0,i=e.length-1;!(n>i)&&(t[n++]=e[r++],!(n>i));)t[n++]=e[a++]}function g(e){for(var t=e.byteLength,r=[],a=0,n=new DataView(e);t>0;){var i=n.getInt8(a++);if(i<0){var o=-i;t-=o+1;for(var s=0;s<o;s++)r.push(n.getUint8(a++))}else{var o=i;t-=2;for(var l=n.getUint8(a++),s=0;s<o+1;s++)r.push(l)}}return r}function m(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function y(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),r=new Uint8Array(g(t)),a=new Uint8Array(r.length);return p(r),v(r,a),new DataView(a.buffer)}function b(e){var t=Y(e.array.slice(e.offset.value,e.offset.value+e.size)),r=new Uint8Array(t.length);return p(t),v(t,r),new DataView(r.buffer)}function w(e){for(var t=e.viewer,r={value:e.offset.value},a=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),n=new Uint8Array(8192),i=0,o=Array(e.channels),s=0;s<e.channels;s++)o[s]={},o[s].start=i,o[s].end=o[s].start,o[s].nx=e.width,o[s].ny=e.lines,o[s].size=e.type,i+=o[s].nx*o[s].ny*o[s].size;var l=I(t,r),u=I(t,r);if(u>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(l<=u)for(var s=0;s<u-l+1;s++)n[s+l]=C(t,r);var p=new Uint16Array(65536),v=function(e,t){for(var r=0,a=0;a<65536;++a)(0==a||e[a>>3]&1<<(7&a))&&(t[r++]=a);for(var n=r-1;r<65536;)t[r++]=0;return n}(n,p),g=k(t,r);d(e.array,t,r,g,a,i);for(var s=0;s<e.channels;++s)for(var m=o[s],y=0;y<o[s].size;++y)!function(e,t,r,a,n,i,o){for(var s=o<16384,l=r>n?n:r,u=1;u<=l;)u<<=1;for(u>>=1,d=u,u>>=1;u>=1;){for(var d,p,v,g,m,y=0,b=0+i*(n-d),w=i*u,S=i*d,x=a*u,_=a*d;y<=b;y+=S){for(var U=y,k=y+a*(r-d);U<=k;U+=_){var T=U+x,C=U+w,M=C+x;s?(c(e[U+t],e[C+t]),p=f.a,g=f.b,c(e[T+t],e[M+t]),v=f.a,m=f.b,c(p,v),e[U+t]=f.a,e[T+t]=f.b,c(g,m)):(h(e[U+t],e[C+t]),p=f.a,g=f.b,h(e[T+t],e[M+t]),v=f.a,m=f.b,h(p,v),e[U+t]=f.a,e[T+t]=f.b,h(g,m)),e[C+t]=f.a,e[M+t]=f.b}if(r&u){var C=U+w;s?c(e[U+t],e[C+t]):h(e[U+t],e[C+t]),p=f.a,e[C+t]=f.b,e[U+t]=p}}if(n&u)for(var U=y,k=y+a*(r-d);U<=k;U+=_){var T=U+x;s?c(e[U+t],e[T+t]):h(e[U+t],e[T+t]),p=f.a,e[T+t]=f.b,e[U+t]=p}d=u,u>>=1}}(a,m.start+y,m.nx,m.size,m.ny,m.nx*m.size,v);!function(e,t,r){for(var a=0;a<r;++a)t[a]=e[t[a]]}(p,a,i);for(var b=0,w=new Uint8Array(a.buffer.byteLength),S=0;S<e.lines;S++)for(var x=0;x<e.channels;x++){var m=o[x],_=m.nx*m.size,U=new Uint8Array(a.buffer,2*m.end,2*_);w.set(U,b),b+=2*_,m.end+=_}return new DataView(w.buffer)}function S(e){var t=Y(e.array.slice(e.offset.value,e.offset.value+e.size));let r=e.lines*e.channels*e.width,a=1==e.type?new Uint16Array(r):new Uint32Array(r),n=0,i=0,o=[,,,,];for(let r=0;r<e.lines;r++)for(let r=0;r<e.channels;r++){let r=0;switch(e.type){case 1:o[0]=n,o[1]=o[0]+e.width,n=o[1]+e.width;for(let n=0;n<e.width;++n)r+=t[o[0]++]<<8|t[o[1]++],a[i]=r,i++;break;case 2:o[0]=n,o[1]=o[0]+e.width,o[2]=o[1]+e.width,n=o[2]+e.width;for(let n=0;n<e.width;++n)r+=t[o[0]++]<<24|t[o[1]++]<<16|t[o[2]++]<<8,a[i]=r,i++}}return new DataView(a.buffer)}function x(e){var t=e.viewer,r={value:e.offset.value},a=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),n={version:M(t,r),unknownUncompressedSize:M(t,r),unknownCompressedSize:M(t,r),acCompressedSize:M(t,r),dcCompressedSize:M(t,r),rleCompressedSize:M(t,r),rleUncompressedSize:M(t,r),rleRawSize:M(t,r),totalAcUncompressedCount:M(t,r),totalDcUncompressedCount:M(t,r),acCompression:M(t,r)};if(n.version<2)throw"EXRLoader.parse: "+B.compression+" version "+n.version+" is unsupported";for(var i=[],s=I(t,r)-2;s>0;){var l=_(t.buffer,r),u=C(t,r),f=u>>2&3,c=(u>>4)-1,h=new Int8Array([c])[0],p=C(t,r);i.push({name:l,index:h,type:p,compression:f}),s-=l.length+3}for(var v=B.channels,m=Array(e.channels),y=0;y<e.channels;++y){var w=m[y]={},S=v[y];w.name=S.name,w.compression=0,w.decoded=!1,w.type=S.pixelType,w.pLinear=S.pLinear,w.width=e.width,w.height=e.lines}for(var x={idx:[,,,]},U=0;U<e.channels;++U)for(var w=m[U],y=0;y<i.length;++y){var k=i[y];w.name==k.name&&(w.compression=k.compression,k.index>=0&&(x.idx[k.index]=U),w.offset=U)}if(n.acCompressedSize>0)switch(n.acCompression){case 0:var T=new Uint16Array(n.totalAcUncompressedCount);d(e.array,t,r,n.acCompressedSize,T,n.totalAcUncompressedCount);break;case 1:var F=e.array.slice(r.value,r.value+n.totalAcUncompressedCount),E=Y(F),T=new Uint16Array(E.buffer);r.value+=n.totalAcUncompressedCount}if(n.dcCompressedSize>0){var R={array:e.array,offset:r,size:n.dcCompressedSize},P=new Uint16Array(b(R).buffer);r.value+=n.dcCompressedSize}if(n.rleRawSize>0){var F=e.array.slice(r.value,r.value+n.rleCompressedSize),E=Y(F),D=g(E.buffer);r.value+=n.rleCompressedSize}for(var O=0,L=Array(m.length),y=0;y<L.length;++y)L[y]=[];for(var G=0;G<e.lines;++G)for(var z=0;z<m.length;++z)L[z].push(O),O+=m[z].width*e.type*2;!function(e,t,r,a,n,i){var s=new DataView(i.buffer),l=r[e.idx[0]].width,u=r[e.idx[0]].height,f=Math.floor(l/8),c=Math.ceil(l/8),h=Math.ceil(u/8),d=l-(c-1)*8,p=u-(h-1)*8,v={value:0},g=[,,,],m=[,,,],y=[,,,],b=[,,,],w=[,,,];for(let r=0;r<3;++r)w[r]=t[e.idx[r]],g[r]=r<1?0:g[r-1]+c*h,m[r]=new Float32Array(64),y[r]=new Uint16Array(64),b[r]=new Uint16Array(64*c);for(let t=0;t<h;++t){var S,x,_=8;t==h-1&&(_=p);var U=8;for(let e=0;e<c;++e){e==c-1&&(U=d);for(let e=0;e<3;++e)y[e].fill(0),y[e][0]=n[g[e]++],function(e,t,r){for(var a,n=1;n<64;)65280==(a=t[e.value])?n=64:a>>8==255?n+=255&a:(r[n]=a,n++),e.value++}(v,a,y[e]),S=y[e],(x=m[e])[0]=A(S[0]),x[1]=A(S[1]),x[2]=A(S[5]),x[3]=A(S[6]),x[4]=A(S[14]),x[5]=A(S[15]),x[6]=A(S[27]),x[7]=A(S[28]),x[8]=A(S[2]),x[9]=A(S[4]),x[10]=A(S[7]),x[11]=A(S[13]),x[12]=A(S[16]),x[13]=A(S[26]),x[14]=A(S[29]),x[15]=A(S[42]),x[16]=A(S[3]),x[17]=A(S[8]),x[18]=A(S[12]),x[19]=A(S[17]),x[20]=A(S[25]),x[21]=A(S[30]),x[22]=A(S[41]),x[23]=A(S[43]),x[24]=A(S[9]),x[25]=A(S[11]),x[26]=A(S[18]),x[27]=A(S[24]),x[28]=A(S[31]),x[29]=A(S[40]),x[30]=A(S[44]),x[31]=A(S[53]),x[32]=A(S[10]),x[33]=A(S[19]),x[34]=A(S[23]),x[35]=A(S[32]),x[36]=A(S[39]),x[37]=A(S[45]),x[38]=A(S[52]),x[39]=A(S[54]),x[40]=A(S[20]),x[41]=A(S[22]),x[42]=A(S[33]),x[43]=A(S[38]),x[44]=A(S[46]),x[45]=A(S[51]),x[46]=A(S[55]),x[47]=A(S[60]),x[48]=A(S[21]),x[49]=A(S[34]),x[50]=A(S[37]),x[51]=A(S[47]),x[52]=A(S[50]),x[53]=A(S[56]),x[54]=A(S[59]),x[55]=A(S[61]),x[56]=A(S[35]),x[57]=A(S[36]),x[58]=A(S[48]),x[59]=A(S[49]),x[60]=A(S[57]),x[61]=A(S[58]),x[62]=A(S[62]),x[63]=A(S[63]),function(e){let t=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),a=.5*Math.cos(3*3.14159/16),n=.5*Math.cos(3*3.14159/8);for(var i=[,,,,],o=[,,,,],s=[,,,,],l=[,,,,],u=0;u<8;++u){var f=8*u;i[0]=r*e[f+2],i[1]=n*e[f+2],i[2]=r*e[f+6],i[3]=n*e[f+6],o[0]=t*e[f+1]+a*e[f+3]+.2777854612564676*e[f+5]+.09754573032714427*e[f+7],o[1]=a*e[f+1]-.09754573032714427*e[f+3]-t*e[f+5]-.2777854612564676*e[f+7],o[2]=.2777854612564676*e[f+1]-t*e[f+3]+.09754573032714427*e[f+5]+a*e[f+7],o[3]=.09754573032714427*e[f+1]-.2777854612564676*e[f+3]+a*e[f+5]-t*e[f+7],s[0]=.35355362513961314*(e[f+0]+e[f+4]),s[3]=.35355362513961314*(e[f+0]-e[f+4]),s[1]=i[0]+i[3],s[2]=i[1]-i[2],l[0]=s[0]+s[1],l[1]=s[3]+s[2],l[2]=s[3]-s[2],l[3]=s[0]-s[1],e[f+0]=l[0]+o[0],e[f+1]=l[1]+o[1],e[f+2]=l[2]+o[2],e[f+3]=l[3]+o[3],e[f+4]=l[3]-o[3],e[f+5]=l[2]-o[2],e[f+6]=l[1]-o[1],e[f+7]=l[0]-o[0]}for(var c=0;c<8;++c)i[0]=r*e[16+c],i[1]=n*e[16+c],i[2]=r*e[48+c],i[3]=n*e[48+c],o[0]=t*e[8+c]+a*e[24+c]+.2777854612564676*e[40+c]+.09754573032714427*e[56+c],o[1]=a*e[8+c]-.09754573032714427*e[24+c]-t*e[40+c]-.2777854612564676*e[56+c],o[2]=.2777854612564676*e[8+c]-t*e[24+c]+.09754573032714427*e[40+c]+a*e[56+c],o[3]=.09754573032714427*e[8+c]-.2777854612564676*e[24+c]+a*e[40+c]-t*e[56+c],s[0]=.35355362513961314*(e[c]+e[32+c]),s[3]=.35355362513961314*(e[c]-e[32+c]),s[1]=i[0]+i[3],s[2]=i[1]-i[2],l[0]=s[0]+s[1],l[1]=s[3]+s[2],l[2]=s[3]-s[2],l[3]=s[0]-s[1],e[0+c]=l[0]+o[0],e[8+c]=l[1]+o[1],e[16+c]=l[2]+o[2],e[24+c]=l[3]+o[3],e[32+c]=l[3]-o[3],e[40+c]=l[2]-o[2],e[48+c]=l[1]-o[1],e[56+c]=l[0]-o[0]}(m[e]);!function(e){for(var t=0;t<64;++t){var r=e[0][t],a=e[1][t],n=e[2][t];e[0][t]=r+1.5747*n,e[1][t]=r-.1873*a-.4682*n,e[2][t]=r+1.8556*a}}(m);for(let t=0;t<3;++t)!function(e,t,r){for(var a,n=0;n<64;++n)t[r+n]=o.DataUtils.toHalfFloat((a=e[n])<=1?Math.sign(a)*Math.pow(Math.abs(a),2.2):Math.sign(a)*Math.pow(9.025013291561939,Math.abs(a)-1))}(m[t],b[t],64*e)}let i=0;for(let a=0;a<3;++a){let n=r[e.idx[a]].type;for(let e=8*t;e<8*t+_;++e){i=w[a][e];for(let t=0;t<f;++t){let r=64*t+(7&e)*8;s.setUint16(i+0*n,b[a][r+0],!0),s.setUint16(i+2*n,b[a][r+1],!0),s.setUint16(i+4*n,b[a][r+2],!0),s.setUint16(i+6*n,b[a][r+3],!0),s.setUint16(i+8*n,b[a][r+4],!0),s.setUint16(i+10*n,b[a][r+5],!0),s.setUint16(i+12*n,b[a][r+6],!0),s.setUint16(i+14*n,b[a][r+7],!0),i+=16*n}}if(f!=c)for(let e=8*t;e<8*t+_;++e){let t=w[a][e]+8*f*2*n,r=64*f+(7&e)*8;for(let e=0;e<U;++e)s.setUint16(t+2*e*n,b[a][r+e],!0)}}}for(var k=new Uint16Array(l),s=new DataView(i.buffer),T=0;T<3;++T){r[e.idx[T]].decoded=!0;var C=r[e.idx[T]].type;if(2==r[T].type)for(var M=0;M<u;++M){let e=w[T][M];for(var F=0;F<l;++F)k[F]=s.getUint16(e+2*F*C,!0);for(var F=0;F<l;++F)s.setFloat32(e+2*F*C,A(k[F]),!0)}}}(x,L,m,T,P,a);for(var y=0;y<m.length;++y){var w=m[y];if(!w.decoded){if(2===w.compression)for(var V=0,j=0,G=0;G<e.lines;++G){for(var N=L[y][V],W=0;W<w.width;++W){for(var q=0;q<2*w.type;++q)a[N++]=D[j+q*w.width*w.height];j++}V++}else throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(a.buffer)}function _(e,t){for(var r=new Uint8Array(e),a=0;0!=r[t.value+a];)a+=1;var n=new TextDecoder().decode(r.slice(t.value,t.value+a));return t.value=t.value+a+1,n}function U(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function k(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function T(e,t){var r=e[t.value];return t.value=t.value+1,r}function C(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}let M=function(e,t){let r;return r="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,r};function F(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function E(e,t){return o.DataUtils.toHalfFloat(F(e,t))}function A(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function I(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function R(e,t){return A(I(e,t))}let P=new DataView(e),D=new Uint8Array(e),O={value:0},B=function(e,t,r){let a={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";a.version=e.getUint8(4);let n=e.getUint8(5);a.spec={singleTile:!!(2&n),longName:!!(4&n),deepFormat:!!(8&n),multiPart:!!(16&n)},r.value=8;for(var i=!0;i;){var o=_(t,r);if(0==o)i=!1;else{var s=_(t,r),l=k(e,r),u=function(e,t,r,a,n){var i,o,s,l,u;if("string"===a||"stringvector"===a||"iccProfile"===a)return i=new TextDecoder().decode(new Uint8Array(t).slice(r.value,r.value+n)),r.value=r.value+n,i;if("chlist"===a)return function(e,t,r,a){for(var n=r.value,i=[];r.value<n+a-1;){var o=_(t,r),s=U(e,r),l=C(e,r);r.value+=3;var u=U(e,r),f=U(e,r);i.push({name:o,pixelType:s,pLinear:l,xSampling:u,ySampling:f})}return r.value+=1,i}(e,t,r,n);if("chromaticities"===a)return o=F(e,r),s=F(e,r),l=F(e,r),u=F(e,r),{redX:o,redY:s,greenX:l,greenY:u,blueX:F(e,r),blueY:F(e,r),whiteX:F(e,r),whiteY:F(e,r)};if("compression"===a)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][C(e,r)];if("box2i"===a)return{xMin:k(e,r),yMin:k(e,r),xMax:k(e,r),yMax:k(e,r)};if("lineOrder"===a)return["INCREASING_Y"][C(e,r)];if("float"===a)return F(e,r);else if("v2f"===a)return[F(e,r),F(e,r)];else if("v3f"===a)return[F(e,r),F(e,r),F(e,r)];else if("int"===a)return U(e,r);else if("rational"===a)return[U(e,r),k(e,r)];else if("timecode"===a)return[k(e,r),k(e,r)];else return"preview"===a?(r.value+=n,"skipped"):void(r.value+=n)}(e,t,r,s,l);void 0===u?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${s}'.`):a[o]=u}}if((-5&n)!=0)throw console.error("EXRHeader:",a),"THREE.EXRLoader: provided file is currently unsupported.";return a}(P,e,O),L=function(e,t,r,a,n){let i={size:0,viewer:t,array:r,offset:a,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[Z?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":i.lines=1,i.uncompress=m;break;case"RLE_COMPRESSION":i.lines=1,i.uncompress=y;break;case"ZIPS_COMPRESSION":i.lines=1,i.uncompress=b;break;case"ZIP_COMPRESSION":i.lines=16,i.uncompress=b;break;case"PIZ_COMPRESSION":i.lines=32,i.uncompress=w;break;case"PXR24_COMPRESSION":i.lines=16,i.uncompress=S;break;case"DWAA_COMPRESSION":i.lines=32,i.uncompress=x;break;case"DWAB_COMPRESSION":i.lines=256,i.uncompress=x;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(i.scanlineBlockSize=i.lines,1==i.type)switch(n){case o.FloatType:i.getter=R,i.inputSize=2;break;case o.HalfFloatType:i.getter=I,i.inputSize=2}else if(2==i.type)switch(n){case o.FloatType:i.getter=F,i.inputSize=4;break;case o.HalfFloatType:i.getter=E,i.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+i.type+" for "+e.compression+".";i.blockCount=(e.dataWindow.yMax+1)/i.scanlineBlockSize;for(var s=0;s<i.blockCount;s++)M(t,a);i.outputChannels=3==i.channels?4:i.channels;let l=i.width*i.height*i.outputChannels;switch(n){case o.FloatType:i.byteArray=new Float32Array(l),i.channels<i.outputChannels&&i.byteArray.fill(1,0,l);break;case o.HalfFloatType:i.byteArray=new Uint16Array(l),i.channels<i.outputChannels&&i.byteArray.fill(15360,0,l);break;default:console.error("THREE.EXRLoader: unsupported type: ",n)}return i.bytesPerLine=i.width*i.inputSize*i.channels,4==i.outputChannels?i.format=o.RGBAFormat:i.format=o.RedFormat,Z?i.colorSpace="srgb-linear":i.encoding=3e3,i}(B,P,D,O,this.type),G={value:0},z={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<L.height/L.scanlineBlockSize;e++){let t=k(P,O);L.size=k(P,O),L.lines=t+L.scanlineBlockSize>L.height?L.height-t:L.scanlineBlockSize;let r=L.size<L.lines*L.bytesPerLine?L.uncompress(L):m(L);O.value+=L.size;for(let t=0;t<L.scanlineBlockSize;t++){let a=t+e*L.scanlineBlockSize;if(a>=L.height)break;for(let e=0;e<L.channels;e++){let n=z[B.channels[e].name];for(let i=0;i<L.width;i++){G.value=(L.channels*L.width*t+e*L.width+i)*L.inputSize;let o=(L.height-1-a)*(L.width*L.outputChannels)+i*L.outputChannels+n;L.byteArray[o]=L.getter(r,G)}}}}return{header:B,width:L.width,height:L.height,data:L.byteArray,format:L.format,[Z?"colorSpace":"encoding"]:L[Z?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,a){return super.load(e,function(e,r){Z?e.colorSpace=r.colorSpace:e.encoding=r.encoding,e.minFilter=o.LinearFilter,e.magFilter=o.LinearFilter,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,r)},r,a)}}let J={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},ee=e=>Array.isArray(e);function et({files:e=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:t="",preset:r,encoding:a,extensions:n}={}){var s;let l;let f=null,c=!1;if(r){if(!(r in J))throw Error("Preset must be one of: "+Object.keys(J).join(", "));e=J[r],t="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/"}if(c=ee(e),l=ee(e)?"cube":e.startsWith("data:application/exr")?"exr":e.startsWith("data:application/hdr")?"hdr":null==(s=e.split(".").pop())||null==(s=s.split("?"))||null==(s=s.shift())?void 0:s.toLowerCase(),!(f=c?o.CubeTextureLoader:"hdr"===l?u:"exr"===l?K:null))throw Error("useEnvironment: Unrecognized file extension: "+e);let h=(0,i.F)(f,c?[e]:e,e=>{null==e.setPath||e.setPath(t),n&&n(e)}),d=c?h[0]:h;return d.mapping=c?o.CubeReflectionMapping:o.EquirectangularReflectionMapping,"colorSpace"in d?d.colorSpace=(null!=a?a:c)?"srgb":"srgb-linear":d.encoding=(null!=a?a:c)?3001:3e3,d}let er=e=>e.current&&e.current.isScene,ea=e=>er(e)?e.current:e;function en(e,t,r,a,n=0){let i=ea(t||r),o=i.background,s=i.environment,l=i.backgroundBlurriness||0;return"only"!==e&&(i.environment=a),e&&(i.background=a),e&&void 0!==i.backgroundBlurriness&&(i.backgroundBlurriness=n),()=>{"only"!==e&&(i.environment=s),e&&(i.background=o),e&&void 0!==i.backgroundBlurriness&&(i.backgroundBlurriness=l)}}function ei({scene:e,background:t=!1,blur:r,map:a}){let o=(0,i.A)(e=>e.scene);return n.useLayoutEffect(()=>{if(a)return en(t,e,o,a,r)},[o,e,a,t,r]),null}function eo({background:e=!1,scene:t,blur:r,...a}){let o=et(a),s=(0,i.A)(e=>e.scene);return n.useLayoutEffect(()=>en(e,t,s,o,r),[o,e,t,s,r]),null}function es({children:e,near:t=1,far:r=1e3,resolution:a=256,frames:s=1,map:l,background:u=!1,blur:f,scene:c,files:h,path:d,preset:p,extensions:v}){let g=(0,i.A)(e=>e.gl),m=(0,i.A)(e=>e.scene),y=n.useRef(null),[b]=n.useState(()=>new o.Scene),w=n.useMemo(()=>{let e=new o.WebGLCubeRenderTarget(a);return e.texture.type=o.HalfFloatType,e},[a]);n.useLayoutEffect(()=>(1===s&&y.current.update(g,b),en(u,c,m,w.texture,f)),[e,b,w.texture,c,m,u,s,g]);let S=1;return(0,i.C)(()=>{(s===1/0||S<s)&&(y.current.update(g,b),S++)}),n.createElement(n.Fragment,null,(0,i.g)(n.createElement(n.Fragment,null,e,n.createElement("cubeCamera",{ref:y,args:[t,r,w]}),h||p?n.createElement(eo,{background:!0,files:h,preset:p,path:d,extensions:v}):l?n.createElement(ei,{background:!0,map:l,extensions:v}):null),b))}function el(e){var t,r,o,s;let u=et(e),f=e.map||u;n.useMemo(()=>(0,i.e)({GroundProjectedEnvImpl:l}),[]);let c=n.useMemo(()=>[f],[f]),h=null==(t=e.ground)?void 0:t.height,d=null==(r=e.ground)?void 0:r.radius,p=null!==(o=null==(s=e.ground)?void 0:s.scale)&&void 0!==o?o:1e3;return n.createElement(n.Fragment,null,n.createElement(ei,(0,a.Z)({},e,{map:f})),n.createElement("groundProjectedEnvImpl",{args:c,scale:p,height:h,radius:d}))}function eu(e){return e.ground?n.createElement(el,e):e.map?n.createElement(ei,e):e.children?n.createElement(es,e):n.createElement(eo,e)}},526:function(e,t,r){r.d(t,{z:function(){return f}});var a=r(3428),n=r(6375),i=r(2265),o=r(2955);function s(e,t,r){let a=(0,o.A)(e=>e.size),s=(0,o.A)(e=>e.viewport),l="number"==typeof e?e:a.width*s.dpr,u="number"==typeof t?t:a.height*s.dpr,{samples:f=0,depth:c,...h}=("number"==typeof e?r:e)||{},d=i.useMemo(()=>{let e=new n.WebGLRenderTarget(l,u,{minFilter:n.LinearFilter,magFilter:n.LinearFilter,type:n.HalfFloatType,...h});return c&&(e.depthTexture=new n.DepthTexture(l,u,n.FloatType)),e.samples=f,e},[]);return i.useLayoutEffect(()=>{d.setSize(l,u),f&&(d.samples=f)},[f,d,l,u]),i.useEffect(()=>()=>d.dispose(),[]),d}let l=function(e,t,r,a){let i=class extends n.ShaderMaterial{constructor(i={}){let o=Object.entries(e);super({uniforms:o.reduce((e,[t,r])=>{let a=n.UniformsUtils.clone({[t]:{value:r}});return{...e,...a}},{}),vertexShader:t,fragmentShader:r}),this.key="",o.forEach(([e])=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t})),Object.assign(this,i),a&&a(this)}};return i.key=n.MathUtils.generateUUID(),i}({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");class u extends n.MeshPhysicalMaterial{constructor(e=6,t=!1){super(),this.uniforms={chromaticAberration:{value:.05},transmission:{value:0},_transmission:{value:1},transmissionMap:{value:null},roughness:{value:0},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:1/0},attenuationColor:{value:new n.Color("white")},anisotropicBlur:{value:.1},time:{value:0},distortion:{value:0},distortionScale:{value:.5},temporalDistortion:{value:0},buffer:{value:null}},this.onBeforeCompile=r=>{r.uniforms={...r.uniforms,...this.uniforms},this.anisotropy>0&&(r.defines.USE_ANISOTROPY=""),t?r.defines.USE_SAMPLER="":r.defines.USE_TRANSMISSION="",r.fragmentShader=`
      uniform float chromaticAberration;         
      uniform float anisotropicBlur;      
      uniform float time;
      uniform float distortion;
      uniform float distortionScale;
      uniform float temporalDistortion;
      uniform sampler2D buffer;

      vec3 random3(vec3 c) {
        float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
        vec3 r;
        r.z = fract(512.0*j);
        j *= .125;
        r.x = fract(512.0*j);
        j *= .125;
        r.y = fract(512.0*j);
        return r-0.5;
      }

      float seed = 0.0;
      uint hash( uint x ) {
        x += ( x << 10u );
        x ^= ( x >>  6u );
        x += ( x <<  3u );
        x ^= ( x >> 11u );
        x += ( x << 15u );
        return x;
      }

      // Compound versions of the hashing algorithm I whipped together.
      uint hash( uvec2 v ) { return hash( v.x ^ hash(v.y)                         ); }
      uint hash( uvec3 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z)             ); }
      uint hash( uvec4 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z) ^ hash(v.w) ); }

      // Construct a float with half-open range [0:1] using low 23 bits.
      // All zeroes yields 0.0, all ones yields the next smallest representable value below 1.0.
      float floatConstruct( uint m ) {
        const uint ieeeMantissa = 0x007FFFFFu; // binary32 mantissa bitmask
        const uint ieeeOne      = 0x3F800000u; // 1.0 in IEEE binary32
        m &= ieeeMantissa;                     // Keep only mantissa bits (fractional part)
        m |= ieeeOne;                          // Add fractional part to 1.0
        float  f = uintBitsToFloat( m );       // Range [1:2]
        return f - 1.0;                        // Range [0:1]
      }

      // Pseudo-random value in half-open range [0:1].
      float random( float x ) { return floatConstruct(hash(floatBitsToUint(x))); }
      float random( vec2  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float random( vec3  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float random( vec4  v ) { return floatConstruct(hash(floatBitsToUint(v))); }

      float rand() {
        float result = random(vec3(gl_FragCoord.xy, seed));
        seed += 1.0;
        return result;
      }

      const float F3 =  0.3333333;
      const float G3 =  0.1666667;

      float snoise(vec3 p) {
        vec3 s = floor(p + dot(p, vec3(F3)));
        vec3 x = p - s + dot(s, vec3(G3));
        vec3 e = step(vec3(0.0), x - x.yzx);
        vec3 i1 = e*(1.0 - e.zxy);
        vec3 i2 = 1.0 - e.zxy*(1.0 - e);
        vec3 x1 = x - i1 + G3;
        vec3 x2 = x - i2 + 2.0*G3;
        vec3 x3 = x - 1.0 + 3.0*G3;
        vec4 w, d;
        w.x = dot(x, x);
        w.y = dot(x1, x1);
        w.z = dot(x2, x2);
        w.w = dot(x3, x3);
        w = max(0.6 - w, 0.0);
        d.x = dot(random3(s), x);
        d.y = dot(random3(s + i1), x1);
        d.z = dot(random3(s + i2), x2);
        d.w = dot(random3(s + 1.0), x3);
        w *= w;
        w *= w;
        d *= w;
        return dot(d, vec4(52.0));
      }

      float snoiseFractal(vec3 m) {
        return 0.5333333* snoise(m)
              +0.2666667* snoise(2.0*m)
              +0.1333333* snoise(4.0*m)
              +0.0666667* snoise(8.0*m);
      }
`+r.fragmentShader,r.fragmentShader=r.fragmentShader.replace("#include <transmission_pars_fragment>",`
        #ifdef USE_TRANSMISSION
          // Transmission code is based on glTF-Sampler-Viewer
          // https://github.com/KhronosGroup/glTF-Sample-Viewer
          uniform float _transmission;
          uniform float thickness;
          uniform float attenuationDistance;
          uniform vec3 attenuationColor;
          #ifdef USE_TRANSMISSIONMAP
            uniform sampler2D transmissionMap;
          #endif
          #ifdef USE_THICKNESSMAP
            uniform sampler2D thicknessMap;
          #endif
          uniform vec2 transmissionSamplerSize;
          uniform sampler2D transmissionSamplerMap;
          uniform mat4 modelMatrix;
          uniform mat4 projectionMatrix;
          varying vec3 vWorldPosition;
          vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
            // Direction of refracted light.
            vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
            // Compute rotation-independant scaling of the model matrix.
            vec3 modelScale;
            modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
            modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
            modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
            // The thickness is specified in local space.
            return normalize( refractionVector ) * thickness * modelScale;
          }
          float applyIorToRoughness( const in float roughness, const in float ior ) {
            // Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
            // an IOR of 1.5 results in the default amount of microfacet refraction.
            return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
          }
          vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
            float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );            
            #ifdef USE_SAMPLER
              #ifdef texture2DLodEXT
                return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #else
                return texture2D(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #endif
            #else
              return texture2D(buffer, fragCoord.xy);
            #endif
          }
          vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
            if ( isinf( attenuationDistance ) ) {
              // Attenuation distance is +∞, i.e. the transmitted color is not attenuated at all.
              return radiance;
            } else {
              // Compute light attenuation using Beer's law.
              vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
              vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law
              return transmittance * radiance;
            }
          }
          vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
            const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
            const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
            const in vec3 attenuationColor, const in float attenuationDistance ) {
            vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
            vec3 refractedRayExit = position + transmissionRay;
            // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
            vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
            vec2 refractionCoords = ndcPos.xy / ndcPos.w;
            refractionCoords += 1.0;
            refractionCoords /= 2.0;
            // Sample framebuffer to get pixel the refracted ray hits.
            vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
            vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
            // Get the specular component.
            vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
            return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
          }
        #endif
`),r.fragmentShader=r.fragmentShader.replace("#include <transmission_fragment>",`  
        // Improve the refraction to use the world pos
        material.transmission = _transmission;
        material.transmissionAlpha = 1.0;
        material.thickness = thickness;
        material.attenuationDistance = attenuationDistance;
        material.attenuationColor = attenuationColor;
        #ifdef USE_TRANSMISSIONMAP
          material.transmission *= texture2D( transmissionMap, vUv ).r;
        #endif
        #ifdef USE_THICKNESSMAP
          material.thickness *= texture2D( thicknessMap, vUv ).g;
        #endif
        
        vec3 pos = vWorldPosition;
        vec3 v = normalize( cameraPosition - pos );
        vec3 n = inverseTransformDirection( normal, viewMatrix );
        vec3 transmission = vec3(0.0);
        float transmissionR, transmissionB, transmissionG;
        float randomCoords = rand();
        float thickness_smear = thickness * max(pow(roughnessFactor, 0.33), anisotropicBlur);
        vec3 distortionNormal = vec3(0.0);
        vec3 temporalOffset = vec3(time, -time, -time) * temporalDistortion;
        if (distortion > 0.0) {
          distortionNormal = distortion * vec3(snoiseFractal(vec3((pos * distortionScale + temporalOffset))), snoiseFractal(vec3(pos.zxy * distortionScale - temporalOffset)), snoiseFractal(vec3(pos.yxz * distortionScale + temporalOffset)));
        }
        for (float i = 0.0; i < ${e}.0; i ++) {
          vec3 sampleNorm = normalize(n + roughnessFactor * roughnessFactor * 2.0 * normalize(vec3(rand() - 0.5, rand() - 0.5, rand() - 0.5)) * pow(rand(), 0.33) + distortionNormal);
          transmissionR = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness  + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).r;
          transmissionG = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior  * (1.0 + chromaticAberration * (i + randomCoords) / float(${e})) , material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).g;
          transmissionB = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior * (1.0 + 2.0 * chromaticAberration * (i + randomCoords) / float(${e})), material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).b;
          transmission.r += transmissionR;
          transmission.g += transmissionG;
          transmission.b += transmissionB;
        }
        transmission /= ${e}.0;
        totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
`)},Object.keys(this.uniforms).forEach(e=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t}))}}let f=i.forwardRef(({buffer:e,transmissionSampler:t=!1,backside:r=!1,side:f=n.FrontSide,transmission:c=1,thickness:h=0,backsideThickness:d=0,samples:p=10,resolution:v,backsideResolution:g,background:m,anisotropy:y,anisotropicBlur:b,...w},S)=>{let x,_,U;(0,o.e)({MeshTransmissionMaterial:u});let k=i.useRef(null),[T]=i.useState(()=>new l),C=s(g||v),M=s(v);return(0,o.C)(e=>{k.current.time=e.clock.getElapsedTime(),k.current.buffer===M.texture&&!t&&(U=k.current.__r3f.parent)&&(_=e.gl.toneMapping,x=e.scene.background,e.gl.toneMapping=n.NoToneMapping,m&&(e.scene.background=m),U.material=T,r&&(e.gl.setRenderTarget(C),e.gl.render(e.scene,e.camera),U.material=k.current,U.material.buffer=C.texture,U.material.thickness=d,U.material.side=n.BackSide),e.gl.setRenderTarget(M),e.gl.render(e.scene,e.camera),U.material=k.current,U.material.thickness=h,U.material.side=f,U.material.buffer=M.texture,e.scene.background=x,e.gl.setRenderTarget(null),e.gl.toneMapping=_)}),i.useImperativeHandle(S,()=>k.current,[]),i.createElement("meshTransmissionMaterial",(0,a.Z)({args:[p,t],ref:k},w,{buffer:e||M.texture,_transmission:c,anisotropicBlur:null!=b?b:y,transmission:t?c:0,thickness:h,side:f}))})},4002:function(e,t,r){let a,n;r.d(t,{x:function(){return e_}});var i=r(3428),o=r(2265),s=r(6375);function l(){var e=Object.create(null);function t(e,t){var r=void 0;self.troikaDefine=function(e){return r=e};var a=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(a)}catch(e){console.error(e)}return URL.revokeObjectURL(a),delete self.troikaDefine,r}self.addEventListener("message",function(r){var a=r.data,n=a.messageId,i=a.action,o=a.data;try{"registerModule"===i&&function r(a,n){var i=a.id,o=a.name,s=a.dependencies;void 0===s&&(s=[]);var l=a.init;void 0===l&&(l=function(){});var u=a.getTransferables;if(void 0===u&&(u=null),!e[i])try{s=s.map(function(t){return t&&t.isWorkerModule&&(r(t,function(e){if(e instanceof Error)throw e}),t=e[t.id].value),t}),l=t("<"+o+">.init",l),u&&(u=t("<"+o+">.getTransferables",u));var f=null;"function"==typeof l?f=l.apply(void 0,s):console.error("worker module init function failed to rehydrate"),e[i]={id:i,value:f,getTransferables:u},n(f)}catch(e){e&&e.noLog||console.error(e),n(e)}}(o,function(e){e instanceof Error?postMessage({messageId:n,success:!1,error:e.message}):postMessage({messageId:n,success:!0,result:{isCallable:"function"==typeof e}})}),"callModule"===i&&function(t,r){var a,n=t.id,i=t.args;e[n]&&"function"==typeof e[n].value||r(Error("Worker module "+n+": not found or its 'init' did not return a function"));try{var o=(a=e[n]).value.apply(a,i);o&&"function"==typeof o.then?o.then(s,function(e){return r(e instanceof Error?e:Error(""+e))}):s(o)}catch(e){r(e)}function s(t){try{var a=e[n].getTransferables&&e[n].getTransferables(t);a&&Array.isArray(a)&&a.length||(a=void 0),r(t,a)}catch(e){console.error(e),r(e)}}}(o,function(e,t){e instanceof Error?postMessage({messageId:n,success:!1,error:e.message}):postMessage({messageId:n,success:!0,result:e},t||void 0)})}catch(e){postMessage({messageId:n,success:!1,error:e.stack})}})}r(2601);var u=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(e){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+e.message+"]")}return u=function(){return e},e},f=0,c=0,h=!1,d=Object.create(null),p=Object.create(null),v=Object.create(null);function g(e){if((!e||"function"!=typeof e.init)&&!h)throw Error("requires `options.init` function");var t,r=e.dependencies,a=e.init,n=e.getTransferables,i=e.workerId;if(!u())return(t=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return t._getInitResult().then(function(t){if("function"==typeof t)return t.apply(void 0,e);throw Error("Worker module function was called but `init` did not return a callable function")})})._getInitResult=function(){var r=e.dependencies,a=e.init,n=Promise.all(r=Array.isArray(r)?r.map(function(e){return e&&e._getInitResult?e._getInitResult():e}):[]).then(function(e){return a.apply(null,e)});return t._getInitResult=function(){return n},n},t;null==i&&(i="#default");var o="workerModule"+ ++f,s=e.name||o,l=null;function c(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!l){l=y(i,"registerModule",c.workerModuleData);var r=function(){l=null,p[i].delete(r)};(p[i]||(p[i]=new Set)).add(r)}return l.then(function(t){if(t.isCallable)return y(i,"callModule",{id:o,args:e});throw Error("Worker module function was called but `init` did not return a callable function")})}return r=r&&r.map(function(e){return"function"!=typeof e||e.workerModuleData||(h=!0,e=g({workerId:i,name:"<"+s+"> function dependency: "+e.name,init:"function(){return (\n"+m(e)+"\n)}"}),h=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e}),c.workerModuleData={isWorkerModule:!0,id:o,name:s,dependencies:r,init:m(a),getTransferables:n&&m(n)},c}function m(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function y(e,t,r){return new Promise(function(a,n){var i=++c;v[i]=function(e){e.success?a(e.result):n(Error("Error in worker "+t+" call: "+e.error))},(function(e){var t=d[e];if(!t){var r=m(l);(t=d[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+r+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,r=t.messageId,a=v[r];if(!a)throw Error("WorkerModule response with empty or unknown messageId");delete v[r],a(t)}}return t})(e).postMessage({messageId:i,action:t,data:r})})}function b(){return function(e){function t(e,t){for(var r,a,n,i,o,s=/([MLQCZ])([^MLQCZ]*)/g;r=s.exec(e);){var l=r[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(e){return parseFloat(e)});switch(r[1]){case"M":i=a=l[0],o=n=l[1];break;case"L":(l[0]!==i||l[1]!==o)&&t("L",i,o,i=l[0],o=l[1]);break;case"Q":t("Q",i,o,i=l[2],o=l[3],l[0],l[1]);break;case"C":t("C",i,o,i=l[4],o=l[5],l[0],l[1],l[2],l[3]);break;case"Z":(i!==a||o!==n)&&t("L",i,o,a,n)}}}function r(e,r,a){void 0===a&&(a=16);var n={x:0,y:0};t(e,function(e,t,i,o,s,l,u,f,c){switch(e){case"L":r(t,i,o,s);break;case"Q":for(var h=t,d=i,p=1;p<a;p++)!function(e,t,r,a,n,i,o,s){var l=1-o;s.x=l*l*e+2*l*o*r+o*o*n,s.y=l*l*t+2*l*o*a+o*o*i}(t,i,l,u,o,s,p/(a-1),n),r(h,d,n.x,n.y),h=n.x,d=n.y;break;case"C":for(var v=t,g=i,m=1;m<a;m++)!function(e,t,r,a,n,i,o,s,l,u){var f=1-l;u.x=f*f*f*e+3*f*f*l*r+3*f*l*l*n+l*l*l*o,u.y=f*f*f*t+3*f*f*l*a+3*f*l*l*i+l*l*l*s}(t,i,l,u,f,c,o,s,m/(a-1),n),r(v,g,n.x,n.y),v=n.x,g=n.y}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",n=new WeakMap,i={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function o(e,t){var r=e.getContext?e.getContext("webgl",i):e,a=n.get(r);if(!a){var o="undefined"!=typeof WebGL2RenderingContext&&r instanceof WebGL2RenderingContext,s={},l={},u={},f=-1,c=[];function h(e){var t=s[e];if(!t&&!(t=s[e]=r.getExtension(e)))throw Error(e+" not supported");return t}function d(e,t){var a=r.createShader(t);return r.shaderSource(a,e),r.compileShader(a),a}function p(){s={},l={},u={},f=-1,c.length=0}r.canvas.addEventListener("webglcontextlost",function(e){p(),e.preventDefault()},!1),n.set(r,a={gl:r,isWebGL2:o,getExtension:h,withProgram:function(e,t,a,n){if(!l[e]){var i={},s={},u=r.createProgram();r.attachShader(u,d(t,r.VERTEX_SHADER)),r.attachShader(u,d(a,r.FRAGMENT_SHADER)),r.linkProgram(u),l[e]={program:u,transaction:function(e){r.useProgram(u),e({setUniform:function(e,t){for(var a=[],n=arguments.length-2;n-- >0;)a[n]=arguments[n+2];var i=s[t]||(s[t]=r.getUniformLocation(u,t));r["uniform"+e].apply(r,[i].concat(a))},setAttribute:function(e,t,a,n,s){var l=i[e];l||(l=i[e]={buf:r.createBuffer(),loc:r.getAttribLocation(u,e),data:null}),r.bindBuffer(r.ARRAY_BUFFER,l.buf),r.vertexAttribPointer(l.loc,t,r.FLOAT,!1,0,0),r.enableVertexAttribArray(l.loc),o?r.vertexAttribDivisor(l.loc,n):h("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,n),s!==l.data&&(r.bufferData(r.ARRAY_BUFFER,s,a),l.data=s)}})}}}l[e].transaction(n)},withTexture:function(e,t){f++;try{r.activeTexture(r.TEXTURE0+f);var a=u[e];a||(a=u[e]=r.createTexture(),r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)),r.bindTexture(r.TEXTURE_2D,a),t(a,f)}finally{f--}},withTextureFramebuffer:function(e,t,a){var n=r.createFramebuffer();c.push(n),r.bindFramebuffer(r.FRAMEBUFFER,n),r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,e),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);try{a(n)}finally{r.deleteFramebuffer(n),r.bindFramebuffer(r.FRAMEBUFFER,c[--c.length-1]||null)}},handleContextLoss:p})}t(a)}function s(e,t,r,n,i,s,l,u){void 0===l&&(l=15),void 0===u&&(u=null),o(e,function(e){var o=e.gl,f=e.withProgram;(0,e.withTexture)("copy",function(e,c){o.texImage2D(o.TEXTURE_2D,0,o.RGBA,i,s,0,o.RGBA,o.UNSIGNED_BYTE,t),f("copy",a,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",function(e){var t=e.setUniform;(0,e.setAttribute)("aUV",2,o.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),t("1i","image",c),o.bindFramebuffer(o.FRAMEBUFFER,u||null),o.disable(o.BLEND),o.colorMask(8&l,4&l,2&l,1&l),o.viewport(r,n,i,s),o.scissor(r,n,i,s),o.drawArrays(o.TRIANGLES,0,3)})})})}var l=Object.freeze({__proto__:null,withWebGLContext:o,renderImageData:s,resizeWebGLCanvasWithoutClearing:function(e,t,r){var a=e.width,n=e.height;o(e,function(i){var o=i.gl,l=new Uint8Array(a*n*4);o.readPixels(0,0,a,n,o.RGBA,o.UNSIGNED_BYTE,l),e.width=t,e.height=r,s(o,l,0,0,a,n)})}});function u(e,t,a,n,i,o){void 0===o&&(o=1);var s=new Uint8Array(e*t),l=n[2]-n[0],u=n[3]-n[1],f=[];r(a,function(e,t,r,a){f.push({x1:e,y1:t,x2:r,y2:a,minX:Math.min(e,r),minY:Math.min(t,a),maxX:Math.max(e,r),maxY:Math.max(t,a)})}),f.sort(function(e,t){return e.maxX-t.maxX});for(var c=0;c<e;c++)for(var h=0;h<t;h++){var d=function(e,t){for(var r=1/0,a=1/0,n=f.length;n--;){var i=f[n];if(i.maxX+a<=e)break;if(e+a>i.minX&&t-a<i.maxY&&t+a>i.minY){var o=function(e,t,r,a,n,i){var o=n-r,s=i-a,l=o*o+s*s,u=l?Math.max(0,Math.min(1,((e-r)*o+(t-a)*s)/l)):0,f=e-(r+u*o),c=t-(a+u*s);return f*f+c*c}(e,t,i.x1,i.y1,i.x2,i.y2);o<r&&(a=Math.sqrt(r=o))}}return function(e,t){for(var r=0,a=f.length;a--;){var n=f[a];if(n.maxX<=e)break;n.y1>t!=n.y2>t&&e<(n.x2-n.x1)*(t-n.y1)/(n.y2-n.y1)+n.x1&&(r+=n.y1<n.y2?1:-1)}return 0!==r}(e,t)&&(a=-a),a}(n[0]+l*(c+.5)/e,n[1]+u*(h+.5)/t),p=Math.pow(1-Math.abs(d)/i,o)/2;d<0&&(p=1-p),p=Math.max(0,Math.min(255,Math.round(255*p))),s[h*e+c]=p}return s}function f(e,t,r,a,n,i,o,s,l,u){void 0===i&&(i=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=0),c(e,t,r,a,n,i,o,null,s,l,u)}function c(e,t,r,a,n,i,o,l,f,c,h){void 0===i&&(i=1),void 0===f&&(f=0),void 0===c&&(c=0),void 0===h&&(h=0);for(var d=u(e,t,r,a,n,i),p=new Uint8Array(4*d.length),v=0;v<d.length;v++)p[4*v+h]=d[v];s(o,p,f,c,e,t,1<<3-h,l)}var h=Object.freeze({__proto__:null,generate:u,generateIntoCanvas:f,generateIntoFramebuffer:c}),d=new Float32Array([0,0,2,0,0,2]),p=null,v=!1,g={},m=new WeakMap;function y(e){if(!v&&!x(e))throw Error("WebGL generation not supported")}function b(e,t,r,a,n,i,s){if(void 0===i&&(i=1),void 0===s&&(s=null),!s&&!(s=p)){var l="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!l)throw Error("OffscreenCanvas or DOM canvas not supported");s=p=l.getContext("webgl",{depth:!1})}y(s);var u=new Uint8Array(e*t*4);o(s,function(o){var s=o.gl,l=o.withTexture,f=o.withTextureFramebuffer;l("readable",function(o,l){s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,null),f(o,l,function(o){S(e,t,r,a,n,i,s,o,0,0,0),s.readPixels(0,0,e,t,s.RGBA,s.UNSIGNED_BYTE,u)})})});for(var f=new Uint8Array(e*t),c=0,h=0;c<u.length;c+=4)f[h++]=u[c];return f}function w(e,t,r,a,n,i,o,s,l,u){void 0===i&&(i=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=0),S(e,t,r,a,n,i,o,null,s,l,u)}function S(e,t,n,i,s,l,u,f,c,h,p){void 0===l&&(l=1),void 0===c&&(c=0),void 0===h&&(h=0),void 0===p&&(p=0),y(u);var v=[];r(n,function(e,t,r,a){v.push(e,t,r,a)}),v=new Float32Array(v),o(u,function(r){var n=r.gl,o=r.isWebGL2,u=r.getExtension,g=r.withProgram,m=r.withTexture,y=r.withTextureFramebuffer,b=r.handleContextLoss;if(m("rawDistances",function(r,m){(e!==r._lastWidth||t!==r._lastHeight)&&n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r._lastWidth=e,r._lastHeight=t,0,n.RGBA,n.UNSIGNED_BYTE,null),g("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",function(a){var f=a.setAttribute,c=a.setUniform,h=!o&&u("ANGLE_instanced_arrays"),p=!o&&u("EXT_blend_minmax");f("aUV",2,n.STATIC_DRAW,0,d),f("aLineSegment",4,n.DYNAMIC_DRAW,1,v),c.apply(void 0,["4f","uGlyphBounds"].concat(i)),c("1f","uMaxDistance",s),c("1f","uExponent",l),y(r,m,function(r){n.enable(n.BLEND),n.colorMask(!0,!0,!0,!0),n.viewport(0,0,e,t),n.scissor(0,0,e,t),n.blendFunc(n.ONE,n.ONE),n.blendEquationSeparate(n.FUNC_ADD,o?n.MAX:p.MAX_EXT),n.clear(n.COLOR_BUFFER_BIT),o?n.drawArraysInstanced(n.TRIANGLES,0,3,v.length/4):h.drawArraysInstancedANGLE(n.TRIANGLES,0,3,v.length/4)})}),g("post",a,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",function(r){r.setAttribute("aUV",2,n.STATIC_DRAW,0,d),r.setUniform("1i","tex",m),n.bindFramebuffer(n.FRAMEBUFFER,f),n.disable(n.BLEND),n.colorMask(0===p,1===p,2===p,3===p),n.viewport(c,h,e,t),n.scissor(c,h,e,t),n.drawArrays(n.TRIANGLES,0,3)})}),n.isContextLost())throw b(),Error("webgl context lost")})}function x(e){var t=e&&e!==p?e.canvas||e:g,r=m.get(t);if(void 0===r){v=!0;var a=null;try{var n=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],i=b(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);(r=i&&n.length===i.length&&i.every(function(e,t){return e===n[t]}))||(a="bad trial run results",console.info(n,i))}catch(e){r=!1,a=e.message}a&&console.warn("WebGL SDF generation not supported:",a),v=!1,m.set(t,r)}return r}var _=Object.freeze({__proto__:null,generate:b,generateIntoCanvas:w,generateIntoFramebuffer:S,isSupported:x});return e.forEachPathCommand=t,e.generate=function(e,t,r,a,n,i){void 0===n&&(n=Math.max(a[2]-a[0],a[3]-a[1])/2),void 0===i&&(i=1);try{return b.apply(_,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),u.apply(h,arguments)}},e.generateIntoCanvas=function(e,t,r,a,n,i,o,s,l,u){void 0===n&&(n=Math.max(a[2]-a[0],a[3]-a[1])/2),void 0===i&&(i=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=0);try{return w.apply(_,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),f.apply(h,arguments)}},e.javascript=h,e.pathToLineSegments=r,e.webgl=_,e.webglUtils=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}let w=/\bvoid\s+main\s*\(\s*\)\s*{/g;function S(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){let r=s.ShaderChunk[t];return r?S(r):e})}let x=[];for(let e=0;e<256;e++)x[e]=(e<16?"0":"")+e.toString(16);let _=Object.assign||function(){let e=arguments[0];for(let t=1,r=arguments.length;t<r;t++){let r=arguments[t];if(r)for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},U=Date.now(),k=new WeakMap,T=new Map,C=1e10;function M(e,t,r,a,n){return(a||n||r)&&(e=e.replace(w,`
${r}
void troikaOrigMain${t}() {`)+`
void main() {
  ${a}
  troikaOrigMain${t}();
  ${n}
}`),e}function F(e,t){return"uniforms"===e?void 0:"function"==typeof t?t.toString():t}let E=0,A=new Map;s.DoubleSide;let I=()=>(self.performance||Date).now(),R=b(),P=[],D=0;function O(){let e=I();for(;P.length&&I()-e<5;)P.shift()();D=P.length?setTimeout(O,0):0}let B=(...e)=>new Promise((t,r)=>{P.push(()=>{let a=I();try{R.webgl.generateIntoCanvas(...e),t({timing:I()-a})}catch(e){r(e)}}),D||(D=setTimeout(O,0))}),L={},G=0;function z(e,t,r,a,n,i,o,s,l,u){let f="TroikaTextSDFGenerator_JS_"+G++%4,c=L[f];return c||(c=L[f]={workerModule:g({name:f,workerId:f,dependencies:[b,I],init(e,t){let r=e().javascript.generate;return function(...e){let a=t();return{textureData:r(...e),timing:t()-a}}},getTransferables:e=>[e.textureData.buffer]}),requests:0,idleTimer:null}),c.requests++,clearTimeout(c.idleTimer),c.workerModule(e,t,r,a,n,i).then(({textureData:r,timing:a})=>{let n=I(),i=new Uint8Array(4*r.length);for(let e=0;e<r.length;e++)i[4*e+u]=r[e];return R.webglUtils.renderImageData(o,i,s,l,e,t,1<<3-u),a+=I()-n,0==--c.requests&&(c.idleTimer=setTimeout(()=>{p[f]&&p[f].forEach(function(e){e()}),d[f]&&(d[f].terminate(),delete d[f])},2e3)),{timing:a}})}let V=R.webglUtils.resizeWebGLCanvasWithoutClearing,j=g({name:"Typr Font Parser",dependencies:[/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function(){var e,t,r;return"undefined"==typeof window&&(self.window=self),(e={},(t={parse:function(e){var r=t._bin,a=new Uint8Array(e);if("ttcf"==r.readASCII(a,0,4)){var n=4;r.readUshort(a,n),n+=2,r.readUshort(a,n),n+=2;var i=r.readUint(a,n);n+=4;for(var o=[],s=0;s<i;s++){var l=r.readUint(a,n);n+=4,o.push(t._readFont(a,l))}return o}return[t._readFont(a,0)]},_readFont:function(e,r){var a=t._bin,n=r;a.readFixed(e,r),r+=4;var i=a.readUshort(e,r);r+=2,a.readUshort(e,r),r+=2,a.readUshort(e,r),r+=2,a.readUshort(e,r),r+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],s={_data:e,_offset:n},l={},u=0;u<i;u++){var f=a.readASCII(e,r,4);r+=4,a.readUint(e,r),r+=4;var c=a.readUint(e,r);r+=4;var h=a.readUint(e,r);r+=4,l[f]={offset:c,length:h}}for(u=0;u<o.length;u++){var d=o[u];l[d]&&(s[d.trim()]=t[d.trim()].parse(e,l[d].offset,l[d].length,s))}return s},_tabOffset:function(e,r,a){for(var n=t._bin,i=n.readUshort(e,a+4),o=a+12,s=0;s<i;s++){var l=n.readASCII(e,o,4);o+=4,n.readUint(e,o),o+=4;var u=n.readUint(e,o);if(o+=4,n.readUint(e,o),o+=4,l==r)return u}return 0}})._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,r){return t._bin.readShort(e,r)/16384},readInt:function(e,r){return t._bin._view(e).getInt32(r)},readInt8:function(e,r){return t._bin._view(e).getInt8(r)},readShort:function(e,r){return t._bin._view(e).getInt16(r)},readUshort:function(e,r){return t._bin._view(e).getUint16(r)},readUshorts:function(e,r,a){for(var n=[],i=0;i<a;i++)n.push(t._bin.readUshort(e,r+2*i));return n},readUint:function(e,r){return t._bin._view(e).getUint32(r)},readUint64:function(e,r){return 4294967296*t._bin.readUint(e,r)+t._bin.readUint(e,r+4)},readASCII:function(e,t,r){for(var a="",n=0;n<r;n++)a+=String.fromCharCode(e[t+n]);return a},readUnicode:function(e,t,r){for(var a="",n=0;n<r;n++)a+=String.fromCharCode(e[t++]<<8|e[t++]);return a},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,r,a){var n=t._bin._tdec;return n&&0==r&&a==e.length?n.decode(e):t._bin.readASCII(e,r,a)},readBytes:function(e,t,r){for(var a=[],n=0;n<r;n++)a.push(e[t+n]);return a},readASCIIArray:function(e,t,r){for(var a=[],n=0;n<r;n++)a.push(String.fromCharCode(e[t+n]));return a},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},t._lctf={},t._lctf.parse=function(e,r,a,n,i){var o=t._bin,s={},l=r;o.readFixed(e,r),r+=4;var u=o.readUshort(e,r);r+=2;var f=o.readUshort(e,r);r+=2;var c=o.readUshort(e,r);return r+=2,s.scriptList=t._lctf.readScriptList(e,l+u),s.featureList=t._lctf.readFeatureList(e,l+f),s.lookupList=t._lctf.readLookupList(e,l+c,i),s},t._lctf.readLookupList=function(e,r,a){var n=t._bin,i=r,o=[],s=n.readUshort(e,r);r+=2;for(var l=0;l<s;l++){var u=n.readUshort(e,r);r+=2;var f=t._lctf.readLookupTable(e,i+u,a);o.push(f)}return o},t._lctf.readLookupTable=function(e,r,a){var n=t._bin,i=r,o={tabs:[]};o.ltype=n.readUshort(e,r),r+=2,o.flag=n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);r+=2;for(var l=o.ltype,u=0;u<s;u++){var f=n.readUshort(e,r);r+=2;var c=a(e,l,i+f,o);o.tabs.push(c)}return o},t._lctf.numOfOnes=function(e){for(var t=0,r=0;r<32;r++)0!=(e>>>r&1)&&t++;return t},t._lctf.readClassDef=function(e,r){var a=t._bin,n=[],i=a.readUshort(e,r);if(r+=2,1==i){var o=a.readUshort(e,r);r+=2;var s=a.readUshort(e,r);r+=2;for(var l=0;l<s;l++)n.push(o+l),n.push(o+l),n.push(a.readUshort(e,r)),r+=2}if(2==i){var u=a.readUshort(e,r);for(r+=2,l=0;l<u;l++)n.push(a.readUshort(e,r)),r+=2,n.push(a.readUshort(e,r)),r+=2,n.push(a.readUshort(e,r)),r+=2}return n},t._lctf.getInterval=function(e,t){for(var r=0;r<e.length;r+=3){var a=e[r],n=e[r+1];if(e[r+2],a<=t&&t<=n)return r}return -1},t._lctf.readCoverage=function(e,r){var a=t._bin,n={};n.fmt=a.readUshort(e,r),r+=2;var i=a.readUshort(e,r);return r+=2,1==n.fmt&&(n.tab=a.readUshorts(e,r,i)),2==n.fmt&&(n.tab=a.readUshorts(e,r,3*i)),n},t._lctf.coverageIndex=function(e,r){var a=e.tab;if(1==e.fmt)return a.indexOf(r);if(2==e.fmt){var n=t._lctf.getInterval(a,r);if(-1!=n)return a[n+2]+(r-a[n])}return -1},t._lctf.readFeatureList=function(e,r){var a=t._bin,n=r,i=[],o=a.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=a.readASCII(e,r,4);r+=4;var u=a.readUshort(e,r);r+=2;var f=t._lctf.readFeatureTable(e,n+u);f.tag=l.trim(),i.push(f)}return i},t._lctf.readFeatureTable=function(e,r){var a=t._bin,n=r,i={},o=a.readUshort(e,r);r+=2,o>0&&(i.featureParams=n+o);var s=a.readUshort(e,r);r+=2,i.tab=[];for(var l=0;l<s;l++)i.tab.push(a.readUshort(e,r+2*l));return i},t._lctf.readScriptList=function(e,r){var a=t._bin,n=r,i={},o=a.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=a.readASCII(e,r,4);r+=4;var u=a.readUshort(e,r);r+=2,i[l.trim()]=t._lctf.readScriptTable(e,n+u)}return i},t._lctf.readScriptTable=function(e,r){var a=t._bin,n=r,i={},o=a.readUshort(e,r);r+=2,i.default=t._lctf.readLangSysTable(e,n+o);var s=a.readUshort(e,r);r+=2;for(var l=0;l<s;l++){var u=a.readASCII(e,r,4);r+=4;var f=a.readUshort(e,r);r+=2,i[u.trim()]=t._lctf.readLangSysTable(e,n+f)}return i},t._lctf.readLangSysTable=function(e,r){var a=t._bin,n={};a.readUshort(e,r),r+=2,n.reqFeature=a.readUshort(e,r),r+=2;var i=a.readUshort(e,r);return r+=2,n.features=a.readUshorts(e,r,i),n},t.CFF={},t.CFF.parse=function(e,r,a){var n=t._bin;(e=new Uint8Array(e.buffer,r,a))[r=0],e[++r],e[++r],e[++r],r++;var i=[];r=t.CFF.readIndex(e,r,i);for(var o=[],s=0;s<i.length-1;s++)o.push(n.readASCII(e,r+i[s],i[s+1]-i[s]));r+=i[i.length-1];var l=[];r=t.CFF.readIndex(e,r,l);var u=[];for(s=0;s<l.length-1;s++)u.push(t.CFF.readDict(e,r+l[s],r+l[s+1]));r+=l[l.length-1];var f=u[0],c=[];r=t.CFF.readIndex(e,r,c);var h=[];for(s=0;s<c.length-1;s++)h.push(n.readASCII(e,r+c[s],c[s+1]-c[s]));if(r+=c[c.length-1],t.CFF.readSubrs(e,r,f),f.CharStrings){r=f.CharStrings,c=[],r=t.CFF.readIndex(e,r,c);var d=[];for(s=0;s<c.length-1;s++)d.push(n.readBytes(e,r+c[s],c[s+1]-c[s]));f.CharStrings=d}if(f.ROS){r=f.FDArray;var p=[];for(r=t.CFF.readIndex(e,r,p),f.FDArray=[],s=0;s<p.length-1;s++){var v=t.CFF.readDict(e,r+p[s],r+p[s+1]);t.CFF._readFDict(e,v,h),f.FDArray.push(v)}r+=p[p.length-1],r=f.FDSelect,f.FDSelect=[];var g=e[r];if(r++,3!=g)throw g;var m=n.readUshort(e,r);for(r+=2,s=0;s<m+1;s++)f.FDSelect.push(n.readUshort(e,r),e[r+2]),r+=3}return f.Encoding&&(f.Encoding=t.CFF.readEncoding(e,f.Encoding,f.CharStrings.length)),f.charset&&(f.charset=t.CFF.readCharset(e,f.charset,f.CharStrings.length)),t.CFF._readFDict(e,f,h),f},t.CFF._readFDict=function(e,r,a){var n;for(var i in r.Private&&(n=r.Private[1],r.Private=t.CFF.readDict(e,n,n+r.Private[0]),r.Private.Subrs&&t.CFF.readSubrs(e,n+r.Private.Subrs,r.Private)),r)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(i)&&(r[i]=a[r[i]-426+35])},t.CFF.readSubrs=function(e,r,a){var n=t._bin,i=[];r=t.CFF.readIndex(e,r,i);var o=i.length;a.Bias=o<1240?107:o<33900?1131:32768,a.Subrs=[];for(var s=0;s<i.length-1;s++)a.Subrs.push(n.readBytes(e,r+i[s],i[s+1]-i[s]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var r=0;r<e.charset.length;r++)if(e.charset[r]==t)return r;return -1},t.CFF.glyphBySE=function(e,r){return r<0||r>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[r])},t.CFF.readEncoding=function(e,r,a){t._bin;var n=[".notdef"],i=e[r];if(r++,0!=i)throw"error: unknown encoding format: "+i;var o=e[r];r++;for(var s=0;s<o;s++)n.push(e[r+s]);return n},t.CFF.readCharset=function(e,r,a){var n=t._bin,i=[".notdef"],o=e[r];if(r++,0==o)for(var s=0;s<a;s++){var l=n.readUshort(e,r);r+=2,i.push(l)}else{if(1!=o&&2!=o)throw"error: format: "+o;for(;i.length<a;){l=n.readUshort(e,r),r+=2;var u=0;for(1==o?(u=e[r],r++):(u=n.readUshort(e,r),r+=2),s=0;s<=u;s++)i.push(l),l++}}return i},t.CFF.readIndex=function(e,r,a){var n=t._bin,i=n.readUshort(e,r)+1,o=e[r+=2];if(r++,1==o)for(var s=0;s<i;s++)a.push(e[r+s]);else if(2==o)for(s=0;s<i;s++)a.push(n.readUshort(e,r+2*s));else if(3==o)for(s=0;s<i;s++)a.push(16777215&n.readUint(e,r+3*s-1));else if(1!=i)throw"unsupported offset size: "+o+", count: "+i;return(r+=i*o)-1},t.CFF.getCharString=function(e,r,a){var n=t._bin,i=e[r],o=e[r+1];e[r+2],e[r+3],e[r+4];var s=1,l=null,u=null;i<=20&&(l=i,s=1),12==i&&(l=100*i+o,s=2),21<=i&&i<=27&&(l=i,s=1),28==i&&(u=n.readShort(e,r+1),s=3),29<=i&&i<=31&&(l=i,s=1),32<=i&&i<=246&&(u=i-139,s=1),247<=i&&i<=250&&(u=256*(i-247)+o+108,s=2),251<=i&&i<=254&&(u=-(256*(i-251))-o-108,s=2),255==i&&(u=n.readInt(e,r+1)/65535,s=5),a.val=null!=u?u:"o"+l,a.size=s},t.CFF.readCharString=function(e,r,a){for(var n=r+a,i=t._bin,o=[];r<n;){var s=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var u=1,f=null,c=null;s<=20&&(f=s,u=1),12==s&&(f=100*s+l,u=2),19!=s&&20!=s||(f=s,u=2),21<=s&&s<=27&&(f=s,u=1),28==s&&(c=i.readShort(e,r+1),u=3),29<=s&&s<=31&&(f=s,u=1),32<=s&&s<=246&&(c=s-139,u=1),247<=s&&s<=250&&(c=256*(s-247)+l+108,u=2),251<=s&&s<=254&&(c=-(256*(s-251))-l-108,u=2),255==s&&(c=i.readInt(e,r+1)/65535,u=5),o.push(null!=c?c:"o"+f),r+=u}return o},t.CFF.readDict=function(e,r,a){for(var n=t._bin,i={},o=[];r<a;){var s=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var u=1,f=null,c=null;if(28==s&&(c=n.readShort(e,r+1),u=3),29==s&&(c=n.readInt(e,r+1),u=5),32<=s&&s<=246&&(c=s-139,u=1),247<=s&&s<=250&&(c=256*(s-247)+l+108,u=2),251<=s&&s<=254&&(c=-(256*(s-251))-l-108,u=2),255==s)throw c=n.readInt(e,r+1)/65535,u=5,"unknown number";if(30==s){var h=[];for(u=1;;){var d=e[r+u];u++;var p=d>>4,v=15&d;if(15!=p&&h.push(p),15!=v&&h.push(v),15==v)break}for(var g="",m=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],y=0;y<h.length;y++)g+=m[h[y]];c=parseFloat(g)}s<=21&&(f=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],u=1,12==s&&(f=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],u=2)),null!=f?(i[f]=1==o.length?o[0]:o,o=[]):o.push(c),r+=u}return i},t.cmap={},t.cmap.parse=function(e,r,a){e=new Uint8Array(e.buffer,r,a),r=0;var n=t._bin,i={};n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2;var s=[];i.tables=[];for(var l=0;l<o;l++){var u=n.readUshort(e,r);r+=2;var f=n.readUshort(e,r);r+=2;var c=n.readUint(e,r);r+=4;var h="p"+u+"e"+f,d=s.indexOf(c);if(-1==d){d=i.tables.length,s.push(c);var p,v=n.readUshort(e,c);0==v?p=t.cmap.parse0(e,c):4==v?p=t.cmap.parse4(e,c):6==v?p=t.cmap.parse6(e,c):12==v?p=t.cmap.parse12(e,c):console.debug("unknown format: "+v,u,f,c),i.tables.push(p)}if(null!=i[h])throw"multiple tables for one platform+encoding";i[h]=d}return i},t.cmap.parse0=function(e,r){var a=t._bin,n={};n.format=a.readUshort(e,r),r+=2;var i=a.readUshort(e,r);r+=2,a.readUshort(e,r),r+=2,n.map=[];for(var o=0;o<i-6;o++)n.map.push(e[r+o]);return n},t.cmap.parse4=function(e,r){var a=t._bin,n=r,i={};i.format=a.readUshort(e,r),r+=2;var o=a.readUshort(e,r);r+=2,a.readUshort(e,r),r+=2;var s=a.readUshort(e,r);r+=2;var l=s/2;i.searchRange=a.readUshort(e,r),r+=2,i.entrySelector=a.readUshort(e,r),r+=2,i.rangeShift=a.readUshort(e,r),r+=2,i.endCount=a.readUshorts(e,r,l),r+=2*l+2,i.startCount=a.readUshorts(e,r,l),r+=2*l,i.idDelta=[];for(var u=0;u<l;u++)i.idDelta.push(a.readShort(e,r)),r+=2;for(i.idRangeOffset=a.readUshorts(e,r,l),r+=2*l,i.glyphIdArray=[];r<n+o;)i.glyphIdArray.push(a.readUshort(e,r)),r+=2;return i},t.cmap.parse6=function(e,r){var a=t._bin,n={};n.format=a.readUshort(e,r),r+=2,a.readUshort(e,r),r+=2,a.readUshort(e,r),r+=2,n.firstCode=a.readUshort(e,r),r+=2;var i=a.readUshort(e,r);r+=2,n.glyphIdArray=[];for(var o=0;o<i;o++)n.glyphIdArray.push(a.readUshort(e,r)),r+=2;return n},t.cmap.parse12=function(e,r){var a=t._bin,n={};n.format=a.readUshort(e,r),r+=4,a.readUint(e,r),r+=4,a.readUint(e,r),r+=4;var i=a.readUint(e,r);r+=4,n.groups=[];for(var o=0;o<i;o++){var s=r+12*o,l=a.readUint(e,s+0),u=a.readUint(e,s+4),f=a.readUint(e,s+8);n.groups.push([l,u,f])}return n},t.glyf={},t.glyf.parse=function(e,t,r,a){for(var n=[],i=0;i<a.maxp.numGlyphs;i++)n.push(null);return n},t.glyf._parseGlyf=function(e,r){var a,n=t._bin,i=e._data,o=t._tabOffset(i,"glyf",e._offset)+e.loca[r];if(e.loca[r]==e.loca[r+1])return null;var s={};if(s.noc=n.readShort(i,o),o+=2,s.xMin=n.readShort(i,o),o+=2,s.yMin=n.readShort(i,o),o+=2,s.xMax=n.readShort(i,o),o+=2,s.yMax=n.readShort(i,o),o+=2,s.xMin>=s.xMax||s.yMin>=s.yMax)return null;if(s.noc>0){s.endPts=[];for(var l=0;l<s.noc;l++)s.endPts.push(n.readUshort(i,o)),o+=2;var u=n.readUshort(i,o);if(o+=2,i.length-o<u)return null;s.instructions=n.readBytes(i,o,u),o+=u;var f=s.endPts[s.noc-1]+1;for(l=0,s.flags=[];l<f;l++){var c=i[o];if(o++,s.flags.push(c),0!=(8&c)){var h=i[o];o++;for(var d=0;d<h;d++)s.flags.push(c),l++}}for(l=0,s.xs=[];l<f;l++){var p=0!=(2&s.flags[l]),v=0!=(16&s.flags[l]);p?(s.xs.push(v?i[o]:-i[o]),o++):v?s.xs.push(0):(s.xs.push(n.readShort(i,o)),o+=2)}for(l=0,s.ys=[];l<f;l++)p=0!=(4&s.flags[l]),v=0!=(32&s.flags[l]),p?(s.ys.push(v?i[o]:-i[o]),o++):v?s.ys.push(0):(s.ys.push(n.readShort(i,o)),o+=2);var g=0,m=0;for(l=0;l<f;l++)g+=s.xs[l],m+=s.ys[l],s.xs[l]=g,s.ys[l]=m}else{s.parts=[];do{a=n.readUshort(i,o),o+=2;var y={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(s.parts.push(y),y.glyphIndex=n.readUshort(i,o),o+=2,1&a){var b=n.readShort(i,o);o+=2;var w=n.readShort(i,o);o+=2}else b=n.readInt8(i,o),o++,w=n.readInt8(i,o),o++;2&a?(y.m.tx=b,y.m.ty=w):(y.p1=b,y.p2=w),8&a?(y.m.a=y.m.d=n.readF2dot14(i,o),o+=2):64&a?(y.m.a=n.readF2dot14(i,o),o+=2,y.m.d=n.readF2dot14(i,o),o+=2):128&a&&(y.m.a=n.readF2dot14(i,o),o+=2,y.m.b=n.readF2dot14(i,o),o+=2,y.m.c=n.readF2dot14(i,o),o+=2,y.m.d=n.readF2dot14(i,o),o+=2)}while(32&a);if(256&a){var S=n.readUshort(i,o);for(o+=2,s.instr=[],l=0;l<S;l++)s.instr.push(i[o]),o++}}return s},t.GPOS={},t.GPOS.parse=function(e,r,a,n){return t._lctf.parse(e,r,a,n,t.GPOS.subt)},t.GPOS.subt=function(e,r,a,n){var i=t._bin,o=a,s={};if(s.fmt=i.readUshort(e,a),a+=2,1==r||2==r||3==r||7==r||8==r&&s.fmt<=2){var l=i.readUshort(e,a);a+=2,s.coverage=t._lctf.readCoverage(e,l+o)}if(1==r&&1==s.fmt){var u=i.readUshort(e,a);a+=2;var f=t._lctf.numOfOnes(u);0!=u&&(s.pos=t.GPOS.readValueRecord(e,a,u))}else if(2==r&&s.fmt>=1&&s.fmt<=2){u=i.readUshort(e,a),a+=2;var c=i.readUshort(e,a);a+=2,f=t._lctf.numOfOnes(u);var h=t._lctf.numOfOnes(c);if(1==s.fmt){s.pairsets=[];var d=i.readUshort(e,a);a+=2;for(var p=0;p<d;p++){var v=o+i.readUshort(e,a);a+=2;var g=i.readUshort(e,v);v+=2;for(var m=[],y=0;y<g;y++){var b=i.readUshort(e,v);v+=2,0!=u&&(k=t.GPOS.readValueRecord(e,v,u),v+=2*f),0!=c&&(T=t.GPOS.readValueRecord(e,v,c),v+=2*h),m.push({gid2:b,val1:k,val2:T})}s.pairsets.push(m)}}if(2==s.fmt){var w=i.readUshort(e,a);a+=2;var S=i.readUshort(e,a);a+=2;var x=i.readUshort(e,a);a+=2;var _=i.readUshort(e,a);for(a+=2,s.classDef1=t._lctf.readClassDef(e,o+w),s.classDef2=t._lctf.readClassDef(e,o+S),s.matrix=[],p=0;p<x;p++){var U=[];for(y=0;y<_;y++){var k=null,T=null;0!=u&&(k=t.GPOS.readValueRecord(e,a,u),a+=2*f),0!=c&&(T=t.GPOS.readValueRecord(e,a,c),a+=2*h),U.push({val1:k,val2:T})}s.matrix.push(U)}}}else{if(9==r&&1==s.fmt){var C=i.readUshort(e,a);a+=2;var M=i.readUint(e,a);if(a+=4,9==n.ltype)n.ltype=C;else if(n.ltype!=C)throw"invalid extension substitution";return t.GPOS.subt(e,n.ltype,o+M)}console.debug("unsupported GPOS table LookupType",r,"format",s.fmt)}return s},t.GPOS.readValueRecord=function(e,r,a){var n=t._bin,i=[];return i.push(1&a?n.readShort(e,r):0),r+=1&a?2:0,i.push(2&a?n.readShort(e,r):0),r+=2&a?2:0,i.push(4&a?n.readShort(e,r):0),r+=4&a?2:0,i.push(8&a?n.readShort(e,r):0),r+=8&a?2:0,i},t.GSUB={},t.GSUB.parse=function(e,r,a,n){return t._lctf.parse(e,r,a,n,t.GSUB.subt)},t.GSUB.subt=function(e,r,a,n){var i=t._bin,o=a,s={};if(s.fmt=i.readUshort(e,a),a+=2,1!=r&&4!=r&&5!=r&&6!=r)return null;if(1==r||4==r||5==r&&s.fmt<=2||6==r&&s.fmt<=2){var l=i.readUshort(e,a);a+=2,s.coverage=t._lctf.readCoverage(e,o+l)}if(1==r&&s.fmt>=1&&s.fmt<=2){if(1==s.fmt)s.delta=i.readShort(e,a),a+=2;else if(2==s.fmt){var u=i.readUshort(e,a);a+=2,s.newg=i.readUshorts(e,a,u),a+=2*s.newg.length}}else if(4==r){s.vals=[],u=i.readUshort(e,a),a+=2;for(var f=0;f<u;f++){var c=i.readUshort(e,a);a+=2,s.vals.push(t.GSUB.readLigatureSet(e,o+c))}}else if(5==r&&2==s.fmt){if(2==s.fmt){var h=i.readUshort(e,a);a+=2,s.cDef=t._lctf.readClassDef(e,o+h),s.scset=[];var d=i.readUshort(e,a);for(a+=2,f=0;f<d;f++){var p=i.readUshort(e,a);a+=2,s.scset.push(0==p?null:t.GSUB.readSubClassSet(e,o+p))}}}else if(6==r&&3==s.fmt){if(3==s.fmt){for(f=0;f<3;f++){u=i.readUshort(e,a),a+=2;for(var v=[],g=0;g<u;g++)v.push(t._lctf.readCoverage(e,o+i.readUshort(e,a+2*g)));a+=2*u,0==f&&(s.backCvg=v),1==f&&(s.inptCvg=v),2==f&&(s.ahedCvg=v)}u=i.readUshort(e,a),a+=2,s.lookupRec=t.GSUB.readSubstLookupRecords(e,a,u)}}else{if(7==r&&1==s.fmt){var m=i.readUshort(e,a);a+=2;var y=i.readUint(e,a);if(a+=4,9==n.ltype)n.ltype=m;else if(n.ltype!=m)throw"invalid extension substitution";return t.GSUB.subt(e,n.ltype,o+y)}console.debug("unsupported GSUB table LookupType",r,"format",s.fmt)}return s},t.GSUB.readSubClassSet=function(e,r){var a=t._bin.readUshort,n=r,i=[],o=a(e,r);r+=2;for(var s=0;s<o;s++){var l=a(e,r);r+=2,i.push(t.GSUB.readSubClassRule(e,n+l))}return i},t.GSUB.readSubClassRule=function(e,r){var a=t._bin.readUshort,n={},i=a(e,r),o=a(e,r+=2);r+=2,n.input=[];for(var s=0;s<i-1;s++)n.input.push(a(e,r)),r+=2;return n.substLookupRecords=t.GSUB.readSubstLookupRecords(e,r,o),n},t.GSUB.readSubstLookupRecords=function(e,r,a){for(var n=t._bin.readUshort,i=[],o=0;o<a;o++)i.push(n(e,r),n(e,r+2)),r+=4;return i},t.GSUB.readChainSubClassSet=function(e,r){var a=t._bin,n=r,i=[],o=a.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=a.readUshort(e,r);r+=2,i.push(t.GSUB.readChainSubClassRule(e,n+l))}return i},t.GSUB.readChainSubClassRule=function(e,r){for(var a=t._bin,n={},i=["backtrack","input","lookahead"],o=0;o<i.length;o++){var s=a.readUshort(e,r);r+=2,1==o&&s--,n[i[o]]=a.readUshorts(e,r,s),r+=2*n[i[o]].length}return s=a.readUshort(e,r),r+=2,n.subst=a.readUshorts(e,r,2*s),r+=2*n.subst.length,n},t.GSUB.readLigatureSet=function(e,r){var a=t._bin,n=r,i=[],o=a.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=a.readUshort(e,r);r+=2,i.push(t.GSUB.readLigature(e,n+l))}return i},t.GSUB.readLigature=function(e,r){var a=t._bin,n={chain:[]};n.nglyph=a.readUshort(e,r),r+=2;var i=a.readUshort(e,r);r+=2;for(var o=0;o<i-1;o++)n.chain.push(a.readUshort(e,r)),r+=2;return n},t.head={},t.head.parse=function(e,r,a){var n=t._bin,i={};return n.readFixed(e,r),r+=4,i.fontRevision=n.readFixed(e,r),r+=4,n.readUint(e,r),r+=4,n.readUint(e,r),r+=4,i.flags=n.readUshort(e,r),r+=2,i.unitsPerEm=n.readUshort(e,r),r+=2,i.created=n.readUint64(e,r),r+=8,i.modified=n.readUint64(e,r),r+=8,i.xMin=n.readShort(e,r),r+=2,i.yMin=n.readShort(e,r),r+=2,i.xMax=n.readShort(e,r),r+=2,i.yMax=n.readShort(e,r),r+=2,i.macStyle=n.readUshort(e,r),r+=2,i.lowestRecPPEM=n.readUshort(e,r),r+=2,i.fontDirectionHint=n.readShort(e,r),r+=2,i.indexToLocFormat=n.readShort(e,r),r+=2,i.glyphDataFormat=n.readShort(e,r),r+=2,i},t.hhea={},t.hhea.parse=function(e,r,a){var n=t._bin,i={};return n.readFixed(e,r),r+=4,i.ascender=n.readShort(e,r),r+=2,i.descender=n.readShort(e,r),r+=2,i.lineGap=n.readShort(e,r),r+=2,i.advanceWidthMax=n.readUshort(e,r),r+=2,i.minLeftSideBearing=n.readShort(e,r),r+=2,i.minRightSideBearing=n.readShort(e,r),r+=2,i.xMaxExtent=n.readShort(e,r),r+=2,i.caretSlopeRise=n.readShort(e,r),r+=2,i.caretSlopeRun=n.readShort(e,r),r+=2,i.caretOffset=n.readShort(e,r),r+=10,i.metricDataFormat=n.readShort(e,r),r+=2,i.numberOfHMetrics=n.readUshort(e,r),r+=2,i},t.hmtx={},t.hmtx.parse=function(e,r,a,n){for(var i=t._bin,o={aWidth:[],lsBearing:[]},s=0,l=0,u=0;u<n.maxp.numGlyphs;u++)u<n.hhea.numberOfHMetrics&&(s=i.readUshort(e,r),r+=2,l=i.readShort(e,r),r+=2),o.aWidth.push(s),o.lsBearing.push(l);return o},t.kern={},t.kern.parse=function(e,r,a,n){var i=t._bin,o=i.readUshort(e,r);if(r+=2,1==o)return t.kern.parseV1(e,r-2,a,n);var s=i.readUshort(e,r);r+=2;for(var l={glyph1:[],rval:[]},u=0;u<s;u++){r+=2,a=i.readUshort(e,r),r+=2;var f=i.readUshort(e,r);r+=2;var c=f>>>8;if(0!=(c&=15))throw"unknown kern table format: "+c;r=t.kern.readFormat0(e,r,l)}return l},t.kern.parseV1=function(e,r,a,n){var i=t._bin;i.readFixed(e,r),r+=4;var o=i.readUint(e,r);r+=4;for(var s={glyph1:[],rval:[]},l=0;l<o;l++){i.readUint(e,r),r+=4;var u=i.readUshort(e,r);r+=2,i.readUshort(e,r),r+=2;var f=u>>>8;if(0!=(f&=15))throw"unknown kern table format: "+f;r=t.kern.readFormat0(e,r,s)}return s},t.kern.readFormat0=function(e,r,a){var n=t._bin,i=-1,o=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2;for(var s=0;s<o;s++){var l=n.readUshort(e,r);r+=2;var u=n.readUshort(e,r);r+=2;var f=n.readShort(e,r);r+=2,l!=i&&(a.glyph1.push(l),a.rval.push({glyph2:[],vals:[]}));var c=a.rval[a.rval.length-1];c.glyph2.push(u),c.vals.push(f),i=l}return r},t.loca={},t.loca.parse=function(e,r,a,n){var i=t._bin,o=[],s=n.head.indexToLocFormat,l=n.maxp.numGlyphs+1;if(0==s)for(var u=0;u<l;u++)o.push(i.readUshort(e,r+(u<<1))<<1);if(1==s)for(u=0;u<l;u++)o.push(i.readUint(e,r+(u<<2)));return o},t.maxp={},t.maxp.parse=function(e,r,a){var n=t._bin,i={},o=n.readUint(e,r);return r+=4,i.numGlyphs=n.readUshort(e,r),r+=2,65536==o&&(i.maxPoints=n.readUshort(e,r),r+=2,i.maxContours=n.readUshort(e,r),r+=2,i.maxCompositePoints=n.readUshort(e,r),r+=2,i.maxCompositeContours=n.readUshort(e,r),r+=2,i.maxZones=n.readUshort(e,r),r+=2,i.maxTwilightPoints=n.readUshort(e,r),r+=2,i.maxStorage=n.readUshort(e,r),r+=2,i.maxFunctionDefs=n.readUshort(e,r),r+=2,i.maxInstructionDefs=n.readUshort(e,r),r+=2,i.maxStackElements=n.readUshort(e,r),r+=2,i.maxSizeOfInstructions=n.readUshort(e,r),r+=2,i.maxComponentElements=n.readUshort(e,r),r+=2,i.maxComponentDepth=n.readUshort(e,r),r+=2),i},t.name={},t.name.parse=function(e,r,a){var n=t._bin,i={};n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2,n.readUshort(e,r);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],u=r+=2,f=0;f<o;f++){var c=n.readUshort(e,r);r+=2;var h=n.readUshort(e,r);r+=2;var d=n.readUshort(e,r);r+=2;var p=n.readUshort(e,r);r+=2;var v=n.readUshort(e,r);r+=2;var g=n.readUshort(e,r);r+=2;var m,y=l[p],b=u+12*o+g;if(0==c)m=n.readUnicode(e,b,v/2);else if(3==c&&0==h)m=n.readUnicode(e,b,v/2);else if(0==h)m=n.readASCII(e,b,v);else if(1==h)m=n.readUnicode(e,b,v/2);else if(3==h)m=n.readUnicode(e,b,v/2);else{if(1!=c)throw"unknown encoding "+h+", platformID: "+c;m=n.readASCII(e,b,v),console.debug("reading unknown MAC encoding "+h+" as ASCII")}var w="p"+c+","+d.toString(16);null==i[w]&&(i[w]={}),i[w][void 0!==y?y:p]=m,i[w]._lang=d}for(var S in i)if(null!=i[S].postScriptName&&1033==i[S]._lang)return i[S];for(var S in i)if(null!=i[S].postScriptName&&0==i[S]._lang)return i[S];for(var S in i)if(null!=i[S].postScriptName&&3084==i[S]._lang)return i[S];for(var S in i)if(null!=i[S].postScriptName)return i[S];for(var S in i){s=S;break}return console.debug("returning name table with languageID "+i[s]._lang),i[s]},t["OS/2"]={},t["OS/2"].parse=function(e,r,a){var n=t._bin.readUshort(e,r);r+=2;var i={};if(0==n)t["OS/2"].version0(e,r,i);else if(1==n)t["OS/2"].version1(e,r,i);else if(2==n||3==n||4==n)t["OS/2"].version2(e,r,i);else{if(5!=n)throw"unknown OS/2 table version: "+n;t["OS/2"].version5(e,r,i)}return i},t["OS/2"].version0=function(e,r,a){var n=t._bin;return a.xAvgCharWidth=n.readShort(e,r),r+=2,a.usWeightClass=n.readUshort(e,r),r+=2,a.usWidthClass=n.readUshort(e,r),r+=2,a.fsType=n.readUshort(e,r),r+=2,a.ySubscriptXSize=n.readShort(e,r),r+=2,a.ySubscriptYSize=n.readShort(e,r),r+=2,a.ySubscriptXOffset=n.readShort(e,r),r+=2,a.ySubscriptYOffset=n.readShort(e,r),r+=2,a.ySuperscriptXSize=n.readShort(e,r),r+=2,a.ySuperscriptYSize=n.readShort(e,r),r+=2,a.ySuperscriptXOffset=n.readShort(e,r),r+=2,a.ySuperscriptYOffset=n.readShort(e,r),r+=2,a.yStrikeoutSize=n.readShort(e,r),r+=2,a.yStrikeoutPosition=n.readShort(e,r),r+=2,a.sFamilyClass=n.readShort(e,r),r+=2,a.panose=n.readBytes(e,r,10),r+=10,a.ulUnicodeRange1=n.readUint(e,r),r+=4,a.ulUnicodeRange2=n.readUint(e,r),r+=4,a.ulUnicodeRange3=n.readUint(e,r),r+=4,a.ulUnicodeRange4=n.readUint(e,r),r+=4,a.achVendID=[n.readInt8(e,r),n.readInt8(e,r+1),n.readInt8(e,r+2),n.readInt8(e,r+3)],r+=4,a.fsSelection=n.readUshort(e,r),r+=2,a.usFirstCharIndex=n.readUshort(e,r),r+=2,a.usLastCharIndex=n.readUshort(e,r),r+=2,a.sTypoAscender=n.readShort(e,r),r+=2,a.sTypoDescender=n.readShort(e,r),r+=2,a.sTypoLineGap=n.readShort(e,r),r+=2,a.usWinAscent=n.readUshort(e,r),r+=2,a.usWinDescent=n.readUshort(e,r),r+=2},t["OS/2"].version1=function(e,r,a){var n=t._bin;return r=t["OS/2"].version0(e,r,a),a.ulCodePageRange1=n.readUint(e,r),r+=4,a.ulCodePageRange2=n.readUint(e,r),r+=4},t["OS/2"].version2=function(e,r,a){var n=t._bin;return r=t["OS/2"].version1(e,r,a),a.sxHeight=n.readShort(e,r),r+=2,a.sCapHeight=n.readShort(e,r),r+=2,a.usDefault=n.readUshort(e,r),r+=2,a.usBreak=n.readUshort(e,r),r+=2,a.usMaxContext=n.readUshort(e,r),r+=2},t["OS/2"].version5=function(e,r,a){var n=t._bin;return r=t["OS/2"].version2(e,r,a),a.usLowerOpticalPointSize=n.readUshort(e,r),r+=2,a.usUpperOpticalPointSize=n.readUshort(e,r),r+=2},t.post={},t.post.parse=function(e,r,a){var n=t._bin,i={};return i.version=n.readFixed(e,r),r+=4,i.italicAngle=n.readFixed(e,r),r+=4,i.underlinePosition=n.readShort(e,r),r+=2,i.underlineThickness=n.readShort(e,r),r+=2,i},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var r=e.cmap,a=-1;if(null!=r.p0e4?a=r.p0e4:null!=r.p3e1?a=r.p3e1:null!=r.p1e0?a=r.p1e0:null!=r.p0e3&&(a=r.p0e3),-1==a)throw"no familiar platform and encoding!";var n=r.tables[a];if(0==n.format)return t>=n.map.length?0:n.map[t];if(4==n.format){for(var i=-1,o=0;o<n.endCount.length;o++)if(t<=n.endCount[o]){i=o;break}return -1==i||n.startCount[i]>t?0:65535&(0!=n.idRangeOffset[i]?n.glyphIdArray[t-n.startCount[i]+(n.idRangeOffset[i]>>1)-(n.idRangeOffset.length-i)]:t+n.idDelta[i])}if(12==n.format){if(t>n.groups[n.groups.length-1][1])return 0;for(o=0;o<n.groups.length;o++){var s=n.groups[o];if(s[0]<=t&&t<=s[1])return s[2]+(t-s[0])}return 0}throw"unknown cmap table format "+n.format},t.U.glyphToPath=function(e,r){var a={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[r]){var n=e.SVG.entries[r];return null==n?a:("string"==typeof n&&(n=t.SVG.toPath(n),e.SVG.entries[r]=n),n)}if(e.CFF){var i={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},o=e.CFF,s=e.CFF.Private;if(o.ROS){for(var l=0;o.FDSelect[l+2]<=r;)l+=2;s=o.FDArray[o.FDSelect[l+1]].Private}t.U._drawCFF(e.CFF.CharStrings[r],i,o,s,a)}else e.glyf&&t.U._drawGlyf(r,e,a);return a},t.U._drawGlyf=function(e,r,a){var n=r.glyf[e];null==n&&(n=r.glyf[e]=t.glyf._parseGlyf(r,e)),null!=n&&(n.noc>-1?t.U._simpleGlyph(n,a):t.U._compoGlyph(n,r,a))},t.U._simpleGlyph=function(e,r){for(var a=0;a<e.noc;a++){for(var n=0==a?0:e.endPts[a-1]+1,i=e.endPts[a],o=n;o<=i;o++){var s=o==n?i:o-1,l=o==i?n:o+1,u=1&e.flags[o],f=1&e.flags[s],c=1&e.flags[l],h=e.xs[o],d=e.ys[o];if(o==n){if(u){if(!f){t.U.P.moveTo(r,h,d);continue}t.U.P.moveTo(r,e.xs[s],e.ys[s])}else f?t.U.P.moveTo(r,e.xs[s],e.ys[s]):t.U.P.moveTo(r,(e.xs[s]+h)/2,(e.ys[s]+d)/2)}u?f&&t.U.P.lineTo(r,h,d):c?t.U.P.qcurveTo(r,h,d,e.xs[l],e.ys[l]):t.U.P.qcurveTo(r,h,d,(h+e.xs[l])/2,(d+e.ys[l])/2)}t.U.P.closePath(r)}},t.U._compoGlyph=function(e,r,a){for(var n=0;n<e.parts.length;n++){var i={cmds:[],crds:[]},o=e.parts[n];t.U._drawGlyf(o.glyphIndex,r,i);for(var s=o.m,l=0;l<i.crds.length;l+=2){var u=i.crds[l],f=i.crds[l+1];a.crds.push(u*s.a+f*s.b+s.tx),a.crds.push(u*s.c+f*s.d+s.ty)}for(l=0;l<i.cmds.length;l++)a.cmds.push(i.cmds[l])}},t.U._getGlyphClass=function(e,r){var a=t._lctf.getInterval(r,e);return -1==a?0:r[a+2]},t.U.getPairAdjustment=function(e,r,a){var n=!1;if(e.GPOS)for(var i=e.GPOS,o=i.lookupList,s=i.featureList,l=[],u=0;u<s.length;u++){var f=s[u];if("kern"==f.tag){n=!0;for(var c=0;c<f.tab.length;c++)if(!l[f.tab[c]]){l[f.tab[c]]=!0;for(var h=o[f.tab[c]],d=0;d<h.tabs.length;d++)if(null!=h.tabs[d]){var p,v=h.tabs[d];if(!v.coverage||-1!=(p=t._lctf.coverageIndex(v.coverage,r))){if(1==h.ltype);else if(2==h.ltype){var g=null;if(1==v.fmt){var m=v.pairsets[p];for(u=0;u<m.length;u++)m[u].gid2==a&&(g=m[u])}else if(2==v.fmt){var y=t.U._getGlyphClass(r,v.classDef1),b=t.U._getGlyphClass(a,v.classDef2);g=v.matrix[y][b]}if(g){var w=0;return g.val1&&g.val1[2]&&(w+=g.val1[2]),g.val2&&g.val2[0]&&(w+=g.val2[0]),w}}}}}}}if(e.kern&&!n){var S=e.kern.glyph1.indexOf(r);if(-1!=S){var x=e.kern.rval[S].glyph2.indexOf(a);if(-1!=x)return e.kern.rval[S].vals[x]}}return 0},t.U._applySubs=function(e,r,a,n){for(var i=e.length-r-1,o=0;o<a.tabs.length;o++)if(null!=a.tabs[o]){var s,l=a.tabs[o];if(!l.coverage||-1!=(s=t._lctf.coverageIndex(l.coverage,e[r]))){if(1==a.ltype)e[r],1==l.fmt?e[r]=e[r]+l.delta:e[r]=l.newg[s];else if(4==a.ltype)for(var u=l.vals[s],f=0;f<u.length;f++){var c=u[f],h=c.chain.length;if(!(h>i)){for(var d=!0,p=0,v=0;v<h;v++){for(;-1==e[r+p+(1+v)];)p++;c.chain[v]!=e[r+p+(1+v)]&&(d=!1)}if(d){for(v=0,e[r]=c.nglyph;v<h+p;v++)e[r+v+1]=-1;break}}}else if(5==a.ltype&&2==l.fmt)for(var g=t._lctf.getInterval(l.cDef,e[r]),m=l.cDef[g+2],y=l.scset[m],b=0;b<y.length;b++){var w=y[b],S=w.input;if(!(S.length>i)){for(d=!0,v=0;v<S.length;v++){var x=t._lctf.getInterval(l.cDef,e[r+1+v]);if(-1==g&&l.cDef[x+2]!=S[v]){d=!1;break}}if(d){var _=w.substLookupRecords;for(f=0;f<_.length;f+=2)_[f],_[f+1]}}}else if(6==a.ltype&&3==l.fmt){if(!t.U._glsCovered(e,l.backCvg,r-l.backCvg.length)||!t.U._glsCovered(e,l.inptCvg,r)||!t.U._glsCovered(e,l.ahedCvg,r+l.inptCvg.length))continue;var U=l.lookupRec;for(b=0;b<U.length;b+=2){g=U[b];var k=n[U[b+1]];t.U._applySubs(e,r+g,k,n)}}}}},t.U._glsCovered=function(e,r,a){for(var n=0;n<r.length;n++)if(-1==t._lctf.coverageIndex(r[n],e[a+n]))return!1;return!0},t.U.glyphsToPath=function(e,r,a){for(var n={cmds:[],crds:[]},i=0,o=0;o<r.length;o++){var s=r[o];if(-1!=s){for(var l=o<r.length-1&&-1!=r[o+1]?r[o+1]:0,u=t.U.glyphToPath(e,s),f=0;f<u.crds.length;f+=2)n.crds.push(u.crds[f]+i),n.crds.push(u.crds[f+1]);for(a&&n.cmds.push(a),f=0;f<u.cmds.length;f++)n.cmds.push(u.cmds[f]);a&&n.cmds.push("X"),i+=e.hmtx.aWidth[s],o<r.length-1&&(i+=t.U.getPairAdjustment(e,s,l))}}return n},t.U.P={},t.U.P.moveTo=function(e,t,r){e.cmds.push("M"),e.crds.push(t,r)},t.U.P.lineTo=function(e,t,r){e.cmds.push("L"),e.crds.push(t,r)},t.U.P.curveTo=function(e,t,r,a,n,i,o){e.cmds.push("C"),e.crds.push(t,r,a,n,i,o)},t.U.P.qcurveTo=function(e,t,r,a,n){e.cmds.push("Q"),e.crds.push(t,r,a,n)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,r,a,n,i){for(var o=r.stack,s=r.nStems,l=r.haveWidth,u=r.width,f=r.open,c=0,h=r.x,d=r.y,p=0,v=0,g=0,m=0,y=0,b=0,w=0,S=0,x=0,_=0,U={val:0,size:0};c<e.length;){t.CFF.getCharString(e,c,U);var k=U.val;if(c+=U.size,"o1"==k||"o18"==k)o.length%2==0||l||(u=o.shift()+n.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if("o3"==k||"o23"==k)o.length%2==0||l||(u=o.shift()+n.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if("o4"==k)o.length>1&&!l&&(u=o.shift()+n.nominalWidthX,l=!0),f&&t.U.P.closePath(i),d+=o.pop(),t.U.P.moveTo(i,h,d),f=!0;else if("o5"==k)for(;o.length>0;)h+=o.shift(),d+=o.shift(),t.U.P.lineTo(i,h,d);else if("o6"==k||"o7"==k)for(var T=o.length,C="o6"==k,M=0;M<T;M++){var F=o.shift();C?h+=F:d+=F,C=!C,t.U.P.lineTo(i,h,d)}else if("o8"==k||"o24"==k){T=o.length;for(var E=0;E+6<=T;)p=h+o.shift(),v=d+o.shift(),g=p+o.shift(),m=v+o.shift(),h=g+o.shift(),d=m+o.shift(),t.U.P.curveTo(i,p,v,g,m,h,d),E+=6;"o24"==k&&(h+=o.shift(),d+=o.shift(),t.U.P.lineTo(i,h,d))}else{if("o11"==k)break;if("o1234"==k||"o1235"==k||"o1236"==k||"o1237"==k)"o1234"==k&&(v=d,g=(p=h+o.shift())+o.shift(),_=m=v+o.shift(),b=m,S=d,h=(w=(y=(x=g+o.shift())+o.shift())+o.shift())+o.shift(),t.U.P.curveTo(i,p,v,g,m,x,_),t.U.P.curveTo(i,y,b,w,S,h,d)),"o1235"==k&&(p=h+o.shift(),v=d+o.shift(),g=p+o.shift(),m=v+o.shift(),x=g+o.shift(),_=m+o.shift(),y=x+o.shift(),b=_+o.shift(),w=y+o.shift(),S=b+o.shift(),h=w+o.shift(),d=S+o.shift(),o.shift(),t.U.P.curveTo(i,p,v,g,m,x,_),t.U.P.curveTo(i,y,b,w,S,h,d)),"o1236"==k&&(p=h+o.shift(),v=d+o.shift(),g=p+o.shift(),_=m=v+o.shift(),b=m,w=(y=(x=g+o.shift())+o.shift())+o.shift(),S=b+o.shift(),h=w+o.shift(),t.U.P.curveTo(i,p,v,g,m,x,_),t.U.P.curveTo(i,y,b,w,S,h,d)),"o1237"==k&&(p=h+o.shift(),v=d+o.shift(),g=p+o.shift(),m=v+o.shift(),x=g+o.shift(),_=m+o.shift(),y=x+o.shift(),b=_+o.shift(),Math.abs((w=y+o.shift())-h)>Math.abs((S=b+o.shift())-d)?h=w+o.shift():d=S+o.shift(),t.U.P.curveTo(i,p,v,g,m,x,_),t.U.P.curveTo(i,y,b,w,S,h,d));else if("o14"==k){if(o.length>0&&!l&&(u=o.shift()+a.nominalWidthX,l=!0),4==o.length){var A=o.shift(),I=o.shift(),R=o.shift(),P=o.shift(),D=t.CFF.glyphBySE(a,R),O=t.CFF.glyphBySE(a,P);t.U._drawCFF(a.CharStrings[D],r,a,n,i),r.x=A,r.y=I,t.U._drawCFF(a.CharStrings[O],r,a,n,i)}f&&(t.U.P.closePath(i),f=!1)}else if("o19"==k||"o20"==k)o.length%2==0||l||(u=o.shift()+n.nominalWidthX),s+=o.length>>1,o.length=0,l=!0,c+=s+7>>3;else if("o21"==k)o.length>2&&!l&&(u=o.shift()+n.nominalWidthX,l=!0),d+=o.pop(),h+=o.pop(),f&&t.U.P.closePath(i),t.U.P.moveTo(i,h,d),f=!0;else if("o22"==k)o.length>1&&!l&&(u=o.shift()+n.nominalWidthX,l=!0),h+=o.pop(),f&&t.U.P.closePath(i),t.U.P.moveTo(i,h,d),f=!0;else if("o25"==k){for(;o.length>6;)h+=o.shift(),d+=o.shift(),t.U.P.lineTo(i,h,d);p=h+o.shift(),v=d+o.shift(),g=p+o.shift(),m=v+o.shift(),h=g+o.shift(),d=m+o.shift(),t.U.P.curveTo(i,p,v,g,m,h,d)}else if("o26"==k)for(o.length%2&&(h+=o.shift());o.length>0;)p=h,v=d+o.shift(),h=g=p+o.shift(),d=(m=v+o.shift())+o.shift(),t.U.P.curveTo(i,p,v,g,m,h,d);else if("o27"==k)for(o.length%2&&(d+=o.shift());o.length>0;)v=d,g=(p=h+o.shift())+o.shift(),m=v+o.shift(),h=g+o.shift(),d=m,t.U.P.curveTo(i,p,v,g,m,h,d);else if("o10"==k||"o29"==k){var B="o10"==k?n:a;if(0==o.length)console.debug("error: empty stack");else{var L=o.pop(),G=B.Subrs[L+B.Bias];r.x=h,r.y=d,r.nStems=s,r.haveWidth=l,r.width=u,r.open=f,t.U._drawCFF(G,r,a,n,i),h=r.x,d=r.y,s=r.nStems,l=r.haveWidth,u=r.width,f=r.open}}else if("o30"==k||"o31"==k){var z=o.length,V=(E=0,"o31"==k);for(E+=z-(T=-3&z);E<T;)V?(v=d,g=(p=h+o.shift())+o.shift(),d=(m=v+o.shift())+o.shift(),T-E==5?(h=g+o.shift(),E++):h=g,V=!1):(p=h,v=d+o.shift(),g=p+o.shift(),m=v+o.shift(),h=g+o.shift(),T-E==5?(d=m+o.shift(),E++):d=m,V=!0),t.U.P.curveTo(i,p,v,g,m,h,d),E+=4}else{if("o"==(k+"").charAt(0))throw console.debug("Unknown operation: "+k,e),k;o.push(k)}}}r.x=h,r.y=d,r.nStems=s,r.haveWidth=l,r.width=u,r.open=f},r=t,e.Typr=r,e.default={Typr:r},Object.defineProperty(e,"__esModule",{value:!0}),e).Typr},/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function(){return function(e){var t=Uint8Array,r=Uint16Array,a=Uint32Array,n=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(e,t){for(var n=new r(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var o=new a(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)o[s]=s-n[i]<<5|i;return[n,o]},l=s(n,2),u=l[0],f=l[1];u[28]=258,f[258]=28;for(var c=s(i,0)[0],h=new r(32768),d=0;d<32768;++d){var p=(43690&d)>>>1|(21845&d)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,h[d]=((65280&p)>>>8|(255&p)<<8)>>>1}var v=function(e,t,a){for(var n=e.length,i=0,o=new r(t);i<n;++i)++o[e[i]-1];var s,l=new r(t);for(i=0;i<t;++i)l[i]=l[i-1]+o[i-1]<<1;if(a){s=new r(1<<t);var u=15-t;for(i=0;i<n;++i)if(e[i])for(var f=i<<4|e[i],c=t-e[i],d=l[e[i]-1]++<<c,p=d|(1<<c)-1;d<=p;++d)s[h[d]>>>u]=f}else for(s=new r(n),i=0;i<n;++i)e[i]&&(s[i]=h[l[e[i]-1]++]>>>15-e[i]);return s},g=new t(288);for(d=0;d<144;++d)g[d]=8;for(d=144;d<256;++d)g[d]=9;for(d=256;d<280;++d)g[d]=7;for(d=280;d<288;++d)g[d]=8;var m=new t(32);for(d=0;d<32;++d)m[d]=5;var y=v(g,9,1),b=v(m,5,1),w=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},S=function(e,t,r){var a=t/8|0;return(e[a]|e[a+1]<<8)>>(7&t)&r},x=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],U=function(e,t,r){var a=Error(t||_[e]);if(a.code=e,Error.captureStackTrace&&Error.captureStackTrace(a,U),!r)throw a;return a},k=function(e,s,l){var f,h,d,p,g=e.length;if(!g||l&&!l.l&&g<5)return s||new t(0);var m=!s||l,_=!l||l.i;l||(l={}),s||(s=new t(3*g));var k,T=function(e){var r=s.length;if(e>r){var a=new t(Math.max(2*r,e));a.set(s),s=a}},C=l.f||0,M=l.p||0,F=l.b||0,E=l.l,A=l.d,I=l.m,R=l.n,P=8*g;do{if(!E){l.f=C=S(e,M,1);var D=S(e,M+1,3);if(M+=3,!D){var O=e[(X=((k=M)/8|0)+(7&k&&1)+4)-4]|e[X-3]<<8,B=X+O;if(B>g){_&&U(0);break}m&&T(F+O),s.set(e.subarray(X,B),F),l.b=F+=O,l.p=M=8*B;continue}if(1==D)E=y,A=b,I=9,R=5;else if(2==D){var L=S(e,M,31)+257,G=S(e,M+10,15)+4,z=L+S(e,M+5,31)+1;M+=14;for(var V=new t(z),j=new t(19),N=0;N<G;++N)j[o[N]]=S(e,M+3*N,7);M+=3*G;var W=w(j),q=(1<<W)-1,$=v(j,W,1);for(N=0;N<z;){var X,H=$[S(e,M,q)];if(M+=15&H,(X=H>>>4)<16)V[N++]=X;else{var Y=0,Q=0;for(16==X?(Q=3+S(e,M,3),M+=2,Y=V[N-1]):17==X?(Q=3+S(e,M,7),M+=3):18==X&&(Q=11+S(e,M,127),M+=7);Q--;)V[N++]=Y}}var Z=V.subarray(0,L),K=V.subarray(L);I=w(Z),R=w(K),E=v(Z,I,1),A=v(K,R,1)}else U(1);if(M>P){_&&U(0);break}}m&&T(F+131072);for(var J=(1<<I)-1,ee=(1<<R)-1,et=M;;et=M){var er=(Y=E[x(e,M)&J])>>>4;if((M+=15&Y)>P){_&&U(0);break}if(Y||U(2),er<256)s[F++]=er;else{if(256==er){et=M,E=null;break}var ea=er-254;if(er>264){var en=n[N=er-257];ea=S(e,M,(1<<en)-1)+u[N],M+=en}var ei=A[x(e,M)&ee],eo=ei>>>4;if(ei||U(3),M+=15&ei,K=c[eo],eo>3&&(en=i[eo],K+=x(e,M)&(1<<en)-1,M+=en),M>P){_&&U(0);break}m&&T(F+131072);for(var es=F+ea;F<es;F+=4)s[F]=s[F-K],s[F+1]=s[F+1-K],s[F+2]=s[F+2-K],s[F+3]=s[F+3-K];F=es}}l.l=E,l.p=et,l.b=F,E&&(C=1,l.m=I,l.d=A,l.n=R)}while(!C);return F==s.length?s:(f=s,(h=0)<0&&(h=0),(null==(d=F)||d>f.length)&&(d=f.length),(p=new(f instanceof r?r:f instanceof a?a:t)(d-h)).set(f.subarray(h,d)),p)},T=new t(0),C="undefined"!=typeof TextDecoder&&new TextDecoder;try{C.decode(T,{stream:!0})}catch(e){}return e.convert_streams=function(e){var t=new DataView(e),r=0;function a(){var e=t.getUint16(r);return r+=2,e}function n(){var e=t.getUint32(r);return r+=4,e}function i(e){m.setUint16(y,e),y+=2}function o(e){m.setUint32(y,e),y+=4}for(var s={signature:n(),flavor:n(),length:n(),numTables:a(),reserved:a(),totalSfntSize:n(),majorVersion:a(),minorVersion:a(),metaOffset:n(),metaLength:n(),metaOrigLength:n(),privOffset:n(),privLength:n()},l=0;Math.pow(2,l)<=s.numTables;)l++;l--;for(var u=16*Math.pow(2,l),f=16*s.numTables-u,c=12,h=[],d=0;d<s.numTables;d++)h.push({tag:n(),offset:n(),compLength:n(),origLength:n(),origChecksum:n()}),c+=16;var p,v=new Uint8Array(12+16*h.length+h.reduce(function(e,t){return e+t.origLength+4},0)),g=v.buffer,m=new DataView(g),y=0;return o(s.flavor),i(s.numTables),i(u),i(l),i(f),h.forEach(function(e){o(e.tag),o(e.origChecksum),o(c),o(e.origLength),e.outOffset=c,(c+=e.origLength)%4!=0&&(c+=4-c%4)}),h.forEach(function(t){var r=e.slice(t.offset,t.offset+t.compLength);if(t.compLength!=t.origLength){var a=new Uint8Array(t.origLength);k(new Uint8Array(r,2),a)}else a=new Uint8Array(r);v.set(a,t.outOffset);var n=0;(c=t.outOffset+t.origLength)%4!=0&&(n=4-c%4),v.set(new Uint8Array(n).buffer,t.outOffset+t.origLength),p=c+n}),g.slice(0,p)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,t){let r;let a={M:2,L:2,Q:4,C:6,Z:0},n={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},i=[null,"isol","init","fina","medi"];function o(...e){for(let t=0;t<e.length;t++)if("number"==typeof e[t])return e[t]}return function(s){let l=new Uint8Array(s,0,4),u=e._bin.readASCII(l,0,4);if("wOFF"===u)s=t(s);else if("wOF2"===u)throw Error("woff2 fonts not supported");return function(t){let s=Object.create(null),l=t["OS/2"],u=t.hhea,f=t.head.unitsPerEm,c=o(l&&l.sTypoAscender,u&&u.ascender,f),h={unitsPerEm:f,ascender:c,descender:o(l&&l.sTypoDescender,u&&u.descender,0),capHeight:o(l&&l.sCapHeight,c),xHeight:o(l&&l.sxHeight,c),lineGap:o(l&&l.sTypoLineGap,u&&u.lineGap),forEachGlyph(o,l,u,f){let c=0,d=1/h.unitsPerEm*l,p=function(t,a){let o=[];for(let r=0;r<a.length;r++){let n=a.codePointAt(r);n>65535&&r++,o.push(e.U.codeToGlyph(t,n))}let s=t.GSUB;if(s){let t;let{lookupList:l,featureList:u}=s,f=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,c=[];u.forEach(s=>{if(f.test(s.tag))for(let u=0;u<s.tab.length;u++){if(c[s.tab[u]])continue;c[s.tab[u]]=!0;let f=l[s.tab[u]],h=/^(isol|init|fina|medi)$/.test(s.tag);h&&!t&&(t=function(e){let t=new Uint8Array(e.length),a=32,i=1,o=-1;for(let s=0;s<e.length;s++){let l=e.codePointAt(s),u=0|function(e){if(!r){let e={R:2,L:1,D:4,C:16,U:32,T:8};for(let t in r=new Map,n){let a=0;n[t].split(",").forEach(n=>{let[i,o]=n.split("+");i=parseInt(i,36),o=o?parseInt(o,36):0,r.set(a+=i,e[t]);for(let n=o;n--;)r.set(++a,e[t])})}}return r.get(e)||32}(l),f=1;!(8&u)&&(21&a?22&u?(f=3,(1===i||3===i)&&t[o]++):33&u&&(2===i||4===i)&&t[o]--:34&a&&(2===i||4===i)&&t[o]--,i=t[s]=f,a=u,o=s,l>65535&&s++)}return t}(a));for(let r=0;r<o.length;r++)t&&h&&i[t[r]]!==s.tag||e.U._applySubs(o,r,f,l)}})}return o}(t,o),v=0,g=-1;return p.forEach((r,n)=>{if(-1!==r){let n=s[r];if(!n){let i,o,l,u;let{cmds:f,crds:c}=e.U.glyphToPath(t,r),h="",d=0;for(let e=0,t=f.length;e<t;e++){let t=a[f[e]];h+=f[e];for(let e=1;e<=t;e++)h+=(e>1?",":"")+c[d++]}if(c.length){i=o=1/0,l=u=-1/0;for(let e=0,t=c.length;e<t;e+=2){let t=c[e],r=c[e+1];t<i&&(i=t),r<o&&(o=r),t>l&&(l=t),r>u&&(u=r)}}else i=l=o=u=0;n=s[r]={index:r,advanceWidth:t.hmtx.aWidth[r],xMin:i,yMin:o,xMax:l,yMax:u,path:h,pathCommandCount:f.length}}-1!==g&&(c+=e.U.getPairAdjustment(t,g,r)*d),f.call(null,n,c,v),n.advanceWidth&&(c+=n.advanceWidth*d),u&&(c+=u*l),g=r}v+=o.codePointAt(v)>65535?2:1}),c}};return h}(e.parse(s)[0])}}],init:(e,t,r)=>r(e(),t())}),N={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},W=new s.Color;function q(){return(self.performance||Date).now()}let $=Object.create(null);function X(e,t){var r;e=function(e,t){for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}({},e);let a=q();if(e.font=(r=e.font||N.defaultFontURL,n||(n="undefined"==typeof document?{}:document.createElement("a")),n.href=r,n.href),e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||N.sdfGlyphSize,null!=e.colorRanges){let t={};for(let r in e.colorRanges)if(e.colorRanges.hasOwnProperty(r)){let a=e.colorRanges[r];"number"!=typeof a&&(a=W.set(a).getHex()),t[r]=a}e.colorRanges=t}Object.freeze(e);let{textureWidth:i,sdfExponent:o}=N,{sdfGlyphSize:l}=e,u=i/l*4,f=$[l];if(!f){let e=document.createElement("canvas");e.width=i,e.height=256*l/u,(f=$[l]={glyphCount:0,sdfGlyphSize:l,sdfCanvas:e,sdfTexture:new s.Texture(e,void 0,void 0,void 0,s.LinearFilter,s.LinearFilter),contextLost:!1,glyphsByFont:new Map}).sdfTexture.generateMipmaps=!1,function(e){let t=e.sdfCanvas;t.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),e.contextLost=!0}),t.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),e.contextLost=!1;let r=[];e.glyphsByFont.forEach(t=>{t.forEach(t=>{r.push(H(t,e,!0))})}),Promise.all(r).then(()=>{Y(e),e.sdfTexture.needsUpdate=!0})})}(f)}let{sdfTexture:c,sdfCanvas:h}=f,d=f.glyphsByFont.get(e.font);d||f.glyphsByFont.set(e.font,d=new Map),Z(e).then(r=>{let{glyphIds:n,glyphPositions:s,fontSize:p,unitsPerEm:v,timings:g}=r,m=[],y=new Float32Array(4*n.length),b=p/v,w=0,S=0,x=q();n.forEach((e,t)=>{let a=d.get(e);if(!a){let{path:t,pathBounds:n}=r.glyphData[e],i=Math.max(n[2]-n[0],n[3]-n[1])/l*(N.sdfMargin*l+.5),o=f.glyphCount++,s=[n[0]-i,n[1]-i,n[2]+i,n[3]+i];d.set(e,a={path:t,atlasIndex:o,sdfViewBox:s}),m.push(a)}let{sdfViewBox:i}=a,o=s[S++],u=s[S++];y[w++]=o+i[0]*b,y[w++]=u+i[1]*b,y[w++]=o+i[2]*b,y[w++]=u+i[3]*b,n[t]=a.atlasIndex}),g.quads=(g.quads||0)+(q()-x);let _=q();g.sdf={};let U=h.height,k=Math.pow(2,Math.ceil(Math.log2(Math.ceil(f.glyphCount/u)*l)));k>U&&(console.info(`Increasing SDF texture size ${U}->${k}`),V(h,i,k),c.dispose()),Promise.all(m.map(t=>H(t,f,e.gpuAccelerateSDF).then(({timing:e})=>{g.sdf[t.atlasIndex]=e}))).then(()=>{m.length&&!f.contextLost&&(Y(f),c.needsUpdate=!0),g.sdfTotal=q()-_,g.total=q()-a,t(Object.freeze({parameters:e,sdfTexture:c,sdfGlyphSize:l,sdfExponent:o,glyphBounds:y,glyphAtlasIndices:n,glyphColors:r.glyphColors,caretPositions:r.caretPositions,caretHeight:r.caretHeight,chunkedBounds:r.chunkedBounds,ascender:r.ascender,descender:r.descender,lineHeight:r.lineHeight,capHeight:r.capHeight,xHeight:r.xHeight,topBaseline:r.topBaseline,blockBounds:r.blockBounds,visibleBounds:r.visibleBounds,timings:r.timings}))})}),Promise.resolve().then(()=>{!f.contextLost&&(h._warm||(R.webgl.isSupported(h),h._warm=!0))})}function H({path:e,atlasIndex:t,sdfViewBox:r},{sdfGlyphSize:n,sdfCanvas:i,contextLost:o},s){if(o)return Promise.resolve({timing:-1});let{textureWidth:l,sdfExponent:u}=N,f=Math.max(r[2]-r[0],r[3]-r[1]),c=Math.floor(t/4),h=c%(l/n)*n,d=Math.floor(c/(l/n))*n;return function(e,t,r,n,i,o,s,l,u,f,c=!0){return c?B(e,t,r,n,i,o,s,l,u,f).then(null,c=>(a||(console.warn("WebGL SDF generation failed, falling back to JS",c),a=!0),z(e,t,r,n,i,o,s,l,u,f))):z(e,t,r,n,i,o,s,l,u,f)}(n,n,e,r,f,u,i,h,d,t%4,s)}function Y(e){if("function"!=typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");let{sdfCanvas:t,sdfTexture:r}=e,{width:a,height:n}=t,i=e.sdfCanvas.getContext("webgl"),o=r.image.data;o&&o.length===a*n*4||(o=new Uint8Array(a*n*4),r.image={width:a,height:n,data:o},r.flipY=!1,r.isDataTexture=!0),i.readPixels(0,0,a,n,i.RGBA,i.UNSIGNED_BYTE,o)}}let Q=g({name:"Typesetter",dependencies:[N,j,function(e,t,r){let{defaultFontURL:a}=r,n=Object.create(null),i=1/0,o=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,s="[^\\S\\u00A0]",l=RegExp(`${s}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function u(t,r){t||(t=a);let i=n[t];if(i)i.pending?i.pending.push(r):r(i);else{var o,s;n[t]={pending:[r]},o=t,s=e=>{let r=n[t].pending;n[t]=e,r.forEach(t=>t(e))},function t(){let r=e=>{console.error(`Failure loading font ${o}${o===a?"":"; trying fallback"}`,e),o!==a&&(o=a,t())};try{let t=new XMLHttpRequest;t.open("get",o,!0),t.responseType="arraybuffer",t.onload=function(){if(t.status>=400)r(Error(t.statusText));else if(t.status>0)try{let r=e(t.response);s(r)}catch(e){r(e)}},t.onerror=r,t.send()}catch(e){r(e)}}()}}function f({text:e="",font:r=a,sdfGlyphSize:n=64,fontSize:f=1,letterSpacing:v=0,lineHeight:g="normal",maxWidth:m=i,direction:y,textAlign:b="left",textIndent:w=0,whiteSpace:S="normal",overflowWrap:x="normal",anchorX:_=0,anchorY:U=0,includeCaretPositions:k=!1,chunkedBoundsSize:T=8192,colorRanges:C=null},M,F=!1){let E=d(),A={fontLoad:0,typesetting:0};e.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),f=+f,v=+v,m=+m,g=g||"normal",w=+w,u(r,r=>{let a=isFinite(m),n=null,u=null,I=null,R=null,P=null,D=null,O=null,B=0,L=0,G="nowrap"!==S,{ascender:z,descender:V,unitsPerEm:j,lineGap:N,capHeight:W,xHeight:q}=r;A.fontLoad=d()-E;let $=d(),X=f/j;"normal"===g&&(g=(z-V+N)/j);let H=((g*=f)-(z-V)*X)/2,Y=-(z*X+H),Q=Math.min(g,(z-V)*X),Z=(z+V)/2*X-Q/2,K=w,J=new p,ee=[J];r.forEachGlyph(e,f,v,(t,r,n)=>{let i;let u=e.charAt(n),c=t.advanceWidth*X,h=J.count;if("isEmpty"in t||(t.isWhitespace=!!u&&new RegExp(s).test(u),t.canBreakAfter=!!u&&l.test(u),t.isEmpty=t.xMin===t.xMax||t.yMin===t.yMax||o.test(u)),!t.isWhitespace&&!t.isEmpty&&L++,G&&a&&!t.isWhitespace&&r+c+K>m&&h){if(J.glyphAt(h-1).glyphObj.canBreakAfter)i=new p,K=-r;else for(let e=h;e--;){if(0===e&&"break-word"===x){i=new p,K=-r;break}if(J.glyphAt(e).glyphObj.canBreakAfter){let t=(i=J.splitAt(e+1)).glyphAt(0).x;K-=t;for(let e=i.count;e--;)i.glyphAt(e).x-=t;break}}i&&(J.isSoftWrapped=!0,J=i,ee.push(J),B=m)}let d=J.glyphAt(J.count);d.glyphObj=t,d.x=r+K,d.width=c,d.charIndex=n,"\n"===u&&(J=new p,ee.push(J),K=-(r+c+v*f)+w)}),ee.forEach(e=>{for(let t=e.count;t--;){let{glyphObj:r,x:a,width:n}=e.glyphAt(t);if(!r.isWhitespace){e.width=a+n,e.width>B&&(B=e.width);return}}});let et=0,er=0;if(_&&("number"==typeof _?et=-_:"string"==typeof _&&(et=-B*("left"===_?0:"center"===_?.5:"right"===_?1:c(_)))),U){if("number"==typeof U)er=-U;else if("string"==typeof U){let e=ee.length*g;er="top"===U?0:"top-baseline"===U?-Y:"top-cap"===U?-Y-W*X:"top-ex"===U?-Y-q*X:"middle"===U?e/2:"bottom"===U?e:"bottom-baseline"===U?e-H+V*X:c(U)*e}}if(!F){let a,o;let s=t.getEmbeddingLevels(e,y);n=new Uint16Array(L),u=new Float32Array(2*L),I={},D=[i,i,-i,-i],O=[];let l=Y;k&&(P=new Float32Array(3*e.length)),C&&(R=new Uint8Array(3*L));let f=0,c=-1,d=-1;if(ee.forEach((p,v)=>{let{count:m,width:y}=p;if(m>0){let v,g=0;for(let e=m;e--&&p.glyphAt(e).glyphObj.isWhitespace;)g++;let w=0,S=0;if("center"===b)w=(B-y)/2;else if("right"===b)w=B-y;else if("justify"===b&&p.isSoftWrapped){let e=0;for(let t=m-g;t--;)p.glyphAt(t).glyphObj.isWhitespace&&e++;S=(B-y)/e}if(S||w){let e=0;for(let t=0;t<m;t++){let r=p.glyphAt(t),a=r.glyphObj;r.x+=w+e,0!==S&&a.isWhitespace&&t<m-g&&(e+=S,r.width+=S)}}let x=t.getReorderSegments(e,s,p.glyphAt(0).charIndex,p.glyphAt(p.count-1).charIndex);for(let e=0;e<x.length;e++){let[t,r]=x[e],a=1/0,n=-1/0;for(let e=0;e<m;e++)if(p.glyphAt(e).charIndex>=t){let t=e,i=e;for(;i<m;i++){let e=p.glyphAt(i);if(e.charIndex>r)break;i<m-g&&(a=Math.min(a,e.x),n=Math.max(n,e.x+e.width))}for(let e=t;e<i;e++){let t=p.glyphAt(e);t.x=n-(t.x+t.width-a)}break}}let _=e=>v=e;for(let g=0;g<m;g++){let m=p.glyphAt(g),y=(v=m.glyphObj).index,b=1&s.levels[m.charIndex];if(b){let a=t.getMirroredCharacter(e[m.charIndex]);a&&r.forEachGlyph(a,0,0,_)}if(k){let{charIndex:e}=m,t=m.x+et,r=m.x+m.width+et;P[3*e]=b?r:t,P[3*e+1]=b?t:r,P[3*e+2]=l+Z+er;let a=e-c;a>1&&h(P,c,a),c=e}if(C){let{charIndex:e}=m;for(;e>d;)d++,C.hasOwnProperty(d)&&(o=C[d])}if(!v.isWhitespace&&!v.isEmpty){let e=f++;I[y]||(I[y]={path:v.path,pathBounds:[v.xMin,v.yMin,v.xMax,v.yMax]});let t=m.x+et,r=l+er;u[2*e]=t,u[2*e+1]=r;let s=t+v.xMin*X,c=r+v.yMin*X,h=t+v.xMax*X,d=r+v.yMax*X;s<D[0]&&(D[0]=s),c<D[1]&&(D[1]=c),h>D[2]&&(D[2]=h),d>D[3]&&(D[3]=d),e%T==0&&(a={start:e,end:e,rect:[i,i,-i,-i]},O.push(a)),a.end++;let p=a.rect;if(s<p[0]&&(p[0]=s),c<p[1]&&(p[1]=c),h>p[2]&&(p[2]=h),d>p[3]&&(p[3]=d),n[e]=y,C){let t=3*e;R[t]=o>>16&255,R[t+1]=o>>8&255,R[t+2]=255&o}}}}l-=g}),P){let t=e.length-c;t>1&&h(P,c,t)}}A.typesetting=d()-$,M({glyphIds:n,glyphPositions:u,glyphData:I,caretPositions:P,caretHeight:Q,glyphColors:R,chunkedBounds:O,fontSize:f,unitsPerEm:j,ascender:z*X,descender:V*X,capHeight:W*X,xHeight:q*X,lineHeight:g,topBaseline:Y,blockBounds:[et,er-ee.length*g,et+B,er],visibleBounds:D,timings:A})})}function c(e){let t=e.match(/^([\d.]+)%$/),r=t?parseFloat(t[1]):NaN;return isNaN(r)?0:r/100}function h(e,t,r){let a=e[3*t],n=e[3*t+1],i=e[3*t+2],o=(n-a)/r;for(let n=0;n<r;n++){let r=(t+n)*3;e[r]=a+o*n,e[r+1]=a+o*(n+1),e[r+2]=i}}function d(){return(self.performance||Date).now()}function p(){this.data=[]}let v=["glyphObj","x","width","charIndex"];return p.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/v.length)},glyphAt(e){let t=p.flyweight;return t.data=this.data,t.index=e,t},splitAt(e){let t=new p;return t.data=this.data.splice(e*v.length),t}},p.flyweight=v.reduce((e,t,r,a)=>(Object.defineProperty(e,t,{get(){return this.data[this.index*v.length+r]},set(e){this.data[this.index*v.length+r]=e}}),e),{data:null,index:0}),{typeset:f,measure:function(e,t){f(e,e=>{let[r,a,n,i]=e.blockBounds;t({width:n-r,height:i-a})},{metricsOnly:!0})},loadFont:u}},function(){return function(e){var t,r,a,n,i={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},o={},s={};o.L=1,s[1]="L",Object.keys(i).forEach(function(e,t){o[e]=1<<t+1,s[o[e]]=e}),Object.freeze(o);var l=o.LRI|o.RLI|o.FSI,u=o.L|o.R|o.AL,f=o.B|o.S|o.WS|o.ON|o.FSI|o.LRI|o.RLI|o.PDI,c=o.BN|o.RLE|o.LRE|o.RLO|o.LRO|o.PDF,h=o.S|o.WS|o.B|l|o.PDI|c,d=null;function p(e){return!function(){if(!d){d=new Map;var e=function(e){if(i.hasOwnProperty(e)){var t=0;i[e].split(",").forEach(function(r){var a=r.split("+"),n=a[0],i=a[1];n=parseInt(n,36),i=i?parseInt(i,36):0,d.set(t+=n,o[e]);for(var s=0;s<i;s++)d.set(++t,o[e])})}};for(var t in i)e(t)}}(),d.get(e.codePointAt(0))||o.L}var v={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function g(e,t){var r,a=0,n=new Map,i=t&&new Map;return e.split(",").forEach(function e(o){if(-1!==o.indexOf("+"))for(var s=+o;s--;)e(r);else{r=o;var l=o.split(">"),u=l[0],f=l[1];u=String.fromCodePoint(a+=parseInt(u,36)),f=String.fromCodePoint(a+=parseInt(f,36)),n.set(u,f),t&&i.set(f,u)}}),{map:n,reverseMap:i}}function m(){if(!t){var e=g(v.pairs,!0),n=e.map,i=e.reverseMap;t=n,r=i,a=g(v.canonical,!1).map}}function y(e){return m(),t.get(e)||null}function b(e){return m(),r.get(e)||null}function w(e){return m(),a.get(e)||null}var S=o.L,x=o.R,_=o.EN,U=o.ES,k=o.ET,T=o.AN,C=o.CS,M=o.B,F=o.S,E=o.ON,A=o.BN,I=o.NSM,R=o.AL,P=o.LRO,D=o.RLO,O=o.LRE,B=o.RLE,L=o.PDF,G=o.LRI,z=o.RLI,V=o.FSI,j=o.PDI;function N(e){return!function(){if(!n){var e=g("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),t=e.map;e.reverseMap.forEach(function(e,r){t.set(r,e)}),n=t}}(),n.get(e)||null}function W(e,t,r,a){var n=e.length;r=Math.max(0,null==r?0:+r),a=Math.min(n-1,null==a?n-1:+a);var i=[];return t.paragraphs.forEach(function(n){var o=Math.max(r,n.start),s=Math.min(a,n.end);if(o<s){for(var l=t.levels.slice(o,s+1),u=s;u>=o&&p(e[u])&h;u--)l[u]=n.level;for(var f=n.level,c=1/0,d=0;d<l.length;d++){var v=l[d];v>f&&(f=v),v<c&&(c=1|v)}for(var g=f;g>=c;g--)for(var m=0;m<l.length;m++)if(l[m]>=g){for(var y=m;m+1<l.length&&l[m+1]>=g;)m++;m>y&&i.push([y+o,m+o])}}}),i}function q(e,t,r,a){for(var n=W(e,t,r,a),i=[],o=0;o<e.length;o++)i[o]=o;return n.forEach(function(e){for(var t=e[0],r=e[1],a=i.slice(t,r+1),n=a.length;n--;)i[r-n]=a[n]}),i}return e.closingToOpeningBracket=b,e.getBidiCharType=p,e.getBidiCharTypeName=function(e){return s[p(e)]},e.getCanonicalBracket=w,e.getEmbeddingLevels=function(e,t){for(var r=new Uint32Array(e.length),a=0;a<e.length;a++)r[a]=p(e[a]);var n=new Map;function i(e,t){var a=r[e];r[e]=t,n.set(a,n.get(a)-1),a&f&&n.set(f,n.get(f)-1),n.set(t,(n.get(t)||0)+1),t&f&&n.set(f,(n.get(f)||0)+1)}for(var o=new Uint8Array(e.length),s=new Map,d=[],v=null,g=0;g<e.length;g++)v||d.push(v={start:g,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:tE(g,!1)}),r[g]&M&&(v.end=g,v=null);for(var m=B|O|D|P|l|j|L|M,N=function(e){return e+(1&e?1:2)},W=function(e){return e+(1&e?2:1)},q=0;q<d.length;q++){var $=[{_level:(v=d[q]).level,_override:0,_isolate:0}],X=void 0,H=0,Y=0,Q=0;n.clear();for(var Z=v.start;Z<=v.end;Z++){var K=r[Z];if(X=$[$.length-1],n.set(K,(n.get(K)||0)+1),K&f&&n.set(f,(n.get(f)||0)+1),K&m){if(K&(B|O)){o[Z]=X._level;var J=(K===B?W:N)(X._level);!(J<=125)||H||Y?!H&&Y++:$.push({_level:J,_override:0,_isolate:0})}else if(K&(D|P)){o[Z]=X._level;var ee=(K===D?W:N)(X._level);!(ee<=125)||H||Y?!H&&Y++:$.push({_level:ee,_override:K&D?x:S,_isolate:0})}else if(K&l){K&V&&(K=1===tE(Z+1,!0)?z:G),o[Z]=X._level,X._override&&i(Z,X._override);var et=(K===z?W:N)(X._level);et<=125&&0===H&&0===Y?(Q++,$.push({_level:et,_override:0,_isolate:1,_isolInitIndex:Z})):H++}else if(K&j){if(H>0)H--;else if(Q>0){for(Y=0;!$[$.length-1]._isolate;)$.pop();var er=$[$.length-1]._isolInitIndex;null!=er&&(s.set(er,Z),s.set(Z,er)),$.pop(),Q--}X=$[$.length-1],o[Z]=X._level,X._override&&i(Z,X._override)}else K&L?(0===H&&(Y>0?Y--:!X._isolate&&$.length>1&&($.pop(),X=$[$.length-1])),o[Z]=X._level):K&M&&(o[Z]=v.level)}else o[Z]=X._level,X._override&&K!==A&&i(Z,X._override)}for(var ea=[],en=null,ei=v.start;ei<=v.end;ei++){var eo=r[ei];if(!(eo&c)){var es=o[ei],el=eo&l,eu=eo===j;en&&es===en._level?(en._end=ei,en._endsWithIsolInit=el):ea.push(en={_start:ei,_end:ei,_level:es,_startsWithPDI:eu,_endsWithIsolInit:el})}}for(var ef=[],ec=0;ec<ea.length;ec++){var eh=ea[ec];if(!eh._startsWithPDI||eh._startsWithPDI&&!s.has(eh._start)){for(var ed=[en=eh],ep=void 0;en&&en._endsWithIsolInit&&null!=(ep=s.get(en._end));)for(var ev=ec+1;ev<ea.length;ev++)if(ea[ev]._start===ep){ed.push(en=ea[ev]);break}for(var eg=[],em=0;em<ed.length;em++)for(var ey=ed[em],eb=ey._start;eb<=ey._end;eb++)eg.push(eb);for(var ew=o[eg[0]],eS=v.level,ex=eg[0]-1;ex>=0;ex--)if(!(r[ex]&c)){eS=o[ex];break}var e_=eg[eg.length-1],eU=o[e_],ek=v.level;if(!(r[e_]&l)){for(var eT=e_+1;eT<=v.end;eT++)if(!(r[eT]&c)){ek=o[eT];break}}ef.push({_seqIndices:eg,_sosType:Math.max(eS,ew)%2?x:S,_eosType:Math.max(ek,eU)%2?x:S})}}for(var eC=0;eC<ef.length;eC++){var eM=ef[eC],eF=eM._seqIndices,eE=eM._sosType,eA=eM._eosType,eI=1&o[eF[0]]?x:S;if(n.get(I))for(var eR=0;eR<eF.length;eR++){var eP=eF[eR];if(r[eP]&I){for(var eD=eE,eO=eR-1;eO>=0;eO--)if(!(r[eF[eO]]&c)){eD=r[eF[eO]];break}i(eP,eD&(l|j)?E:eD)}}if(n.get(_))for(var eB=0;eB<eF.length;eB++){var eL=eF[eB];if(r[eL]&_)for(var eG=eB-1;eG>=-1;eG--){var ez=-1===eG?eE:r[eF[eG]];if(ez&u){ez===R&&i(eL,T);break}}}if(n.get(R))for(var eV=0;eV<eF.length;eV++){var ej=eF[eV];r[ej]&R&&i(ej,x)}if(n.get(U)||n.get(C))for(var eN=1;eN<eF.length-1;eN++){var eW=eF[eN];if(r[eW]&(U|C)){for(var eq=0,e$=0,eX=eN-1;eX>=0&&(eq=r[eF[eX]])&c;eX--);for(var eH=eN+1;eH<eF.length&&(e$=r[eF[eH]])&c;eH++);eq===e$&&(r[eW]===U?eq===_:eq&(_|T))&&i(eW,eq)}}if(n.get(_)){for(var eY=0;eY<eF.length;eY++)if(r[eF[eY]]&_){for(var eQ=eY-1;eQ>=0&&r[eF[eQ]]&(k|c);eQ--)i(eF[eQ],_);for(eY++;eY<eF.length&&r[eF[eY]]&(k|c|_);eY++)r[eF[eY]]!==_&&i(eF[eY],_)}}if(n.get(k)||n.get(U)||n.get(C))for(var eZ=0;eZ<eF.length;eZ++){var eK=eF[eZ];if(r[eK]&(k|U|C)){i(eK,E);for(var eJ=eZ-1;eJ>=0&&r[eF[eJ]]&c;eJ--)i(eF[eJ],E);for(var e1=eZ+1;e1<eF.length&&r[eF[e1]]&c;e1++)i(eF[e1],E)}}if(n.get(_))for(var e0=0,e2=eE;e0<eF.length;e0++){var e3=eF[e0],e5=r[e3];e5&_?e2===S&&i(e3,S):e5&u&&(e2=e5)}if(n.get(f)){for(var e4=x|_|T,e6=e4|S,e8=[],e7=[],e9=0;e9<eF.length;e9++)if(r[eF[e9]]&f){var te=e[eF[e9]],tt=void 0;if(null!==y(te)){if(e7.length<63)e7.push({char:te,seqIndex:e9});else break}else if(null!==(tt=b(te)))for(var tr=e7.length-1;tr>=0;tr--){var ta=e7[tr].char;if(ta===tt||ta===b(w(te))||y(w(ta))===te){e8.push([e7[tr].seqIndex,e9]),e7.length=tr;break}}}e8.sort(function(e,t){return e[0]-t[0]});for(var tn=0;tn<e8.length;tn++){for(var ti=e8[tn],to=ti[0],ts=ti[1],tl=!1,tu=0,tf=to+1;tf<ts;tf++){var tc=eF[tf];if(r[tc]&e6){tl=!0;var th=r[tc]&e4?x:S;if(th===eI){tu=th;break}}}if(tl&&!tu){tu=eE;for(var td=to-1;td>=0;td--){var tp=eF[td];if(r[tp]&e6){var tv=r[tp]&e4?x:S;tu=tv!==eI?tv:eI;break}}}if(tu){if(r[eF[to]]=r[eF[ts]]=tu,tu!==eI){for(var tg=to+1;tg<eF.length;tg++)if(!(r[eF[tg]]&c)){p(e[eF[tg]])&I&&(r[eF[tg]]=tu);break}}if(tu!==eI){for(var tm=ts+1;tm<eF.length;tm++)if(!(r[eF[tm]]&c)){p(e[eF[tm]])&I&&(r[eF[tm]]=tu);break}}}}for(var ty=0;ty<eF.length;ty++)if(r[eF[ty]]&f){for(var tb=ty,tw=ty,tS=eE,tx=ty-1;tx>=0;tx--)if(r[eF[tx]]&c)tb=tx;else{tS=r[eF[tx]]&e4?x:S;break}for(var t_=eA,tU=ty+1;tU<eF.length;tU++)if(r[eF[tU]]&(f|c))tw=tU;else{t_=r[eF[tU]]&e4?x:S;break}for(var tk=tb;tk<=tw;tk++)r[eF[tk]]=tS===t_?tS:eI;ty=tw}}}for(var tT=v.start;tT<=v.end;tT++){var tC=o[tT],tM=r[tT];if(1&tC?tM&(S|_|T)&&o[tT]++:tM&x?o[tT]++:tM&(T|_)&&(o[tT]+=2),tM&c&&(o[tT]=0===tT?v.level:o[tT-1]),tT===v.end||p(e[tT])&(F|M))for(var tF=tT;tF>=0&&p(e[tF])&h;tF--)o[tF]=v.level}}return{levels:o,paragraphs:d};function tE(t,a){for(var n=t;n<e.length;n++){var i=r[n];if(i&(x|R))return 1;if(i&(M|S)||a&&i===j)break;if(i&l){var o=function(t){for(var a=1,n=t+1;n<e.length;n++){var i=r[n];if(i&M)break;if(i&j){if(0==--a)return n}else i&l&&a++}return -1}(n);n=-1===o?e.length:o}}return 0}},e.getMirroredCharacter=N,e.getMirroredCharactersMap=function(e,t,r,a){var n=e.length;r=Math.max(0,null==r?0:+r),a=Math.min(n-1,null==a?n-1:+a);for(var i=new Map,o=r;o<=a;o++)if(1&t[o]){var s=N(e[o]);null!==s&&i.set(o,s)}return i},e.getReorderSegments=W,e.getReorderedIndices=q,e.getReorderedString=function(e,t,r,a){var n=q(e,t,r,a),i=[].concat(e);return n.forEach(function(r,a){i[a]=(1&t.levels[r]?N(e[r]):null)||e[r]}),i.join("")},e.openingToClosingBracket=y,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init(e,t,r,a){let{defaultFontURL:n}=e;return r(t,a(),{defaultFontURL:n})}}),Z=g({name:"Typesetter",dependencies:[Q],init:e=>function(t){return new Promise(r=>{e.typeset(t,r)})},getTransferables(e){let t=[e.glyphPositions.buffer,e.glyphIds.buffer];return e.caretPositions&&t.push(e.caretPositions.buffer),e.glyphColors&&t.push(e.glyphColors.buffer),t}}),K={},J="aTroikaGlyphIndex";class ee extends s.InstancedBufferGeometry{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new s.Sphere,this.boundingBox=new s.Box3}computeBoundingSphere(){}computeBoundingBox(){}setSide(e){let t=this.getIndex().count;this.setDrawRange(e===s.BackSide?t/2:0,e===s.DoubleSide?t:t/2)}set detail(e){if(e!==this._detail){this._detail=e,("number"!=typeof e||e<1)&&(e=1);let t=function(e){let t=K[e];if(!t){let r=new s.PlaneGeometry(1,1,e,e),a=r.clone(),n=r.attributes,i=a.attributes,o=new s.BufferGeometry,l=n.uv.count;for(let e=0;e<l;e++)i.position.array[3*e]*=-1,i.normal.array[3*e+2]*=-1;["position","normal","uv"].forEach(e=>{o.setAttribute(e,new s.Float32BufferAttribute([...n[e].array,...i[e].array],n[e].itemSize))}),o.setIndex([...r.index.array,...a.index.array.map(e=>e+l)]),o.translate(.5,.5,0),t=K[e]=o}return t}(e);["position","normal","uv"].forEach(e=>{this.attributes[e]=t.attributes[e].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,r,a,n){et(this,"aTroikaGlyphBounds",e,4),et(this,J,t,1),et(this,"aTroikaGlyphColor",n,3),this._blockBounds=r,this._chunkedBounds=a,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){let e=this._blockBounds;if(e){let{curveRadius:t,boundingBox:r}=this;if(t){let{PI:a,floor:n,min:i,max:o,sin:s,cos:l}=Math,u=a/2,f=2*a,c=Math.abs(t),h=e[0]/c,d=e[2]/c,p=n((h+u)/f)!==n((d+u)/f)?-c:i(s(h)*c,s(d)*c),v=n((h-u)/f)!==n((d-u)/f)?c:o(s(h)*c,s(d)*c),g=n((h+a)/f)!==n((d+a)/f)?2*c:o(c-l(h)*c,c-l(d)*c);r.min.set(p,e[1],t<0?-g:0),r.max.set(v,e[3],t<0?0:g)}else r.min.set(e[0],e[1],0),r.max.set(e[2],e[3],0);r.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(J).count,r=this._chunkedBounds;if(r)for(let a=r.length;a--;){t=r[a].end;let n=r[a].rect;if(n[1]<e.w&&n[3]>e.y&&n[0]<e.z&&n[2]>e.x)break}this.instanceCount=t}}function et(e,t,r,a){let n=e.getAttribute(t);r?n&&n.array.length===r.length?(n.array.set(r),n.needsUpdate=!0):(e.setAttribute(t,new s.InstancedBufferAttribute(r,a)),delete e._maxInstanceCount,e.dispose()):n&&e.deleteAttribute(t)}let er=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,ea=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,en=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,ei=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`,eo=new s.MeshBasicMaterial({color:16777215,side:s.DoubleSide,transparent:!0}),es=new s.Matrix4,el=new s.Vector3,eu=new s.Vector3,ef=[],ec=new s.Vector3,eh="+x+y";function ed(e){return Array.isArray(e)?e[0]:e}let ep=()=>{let e=new s.Mesh(new s.PlaneGeometry(1,1),eo);return ep=()=>e,e},ev=()=>{let e=new s.Mesh(new s.PlaneGeometry(1,1,32,1),eo);return ev=()=>e,e},eg={type:"syncstart"},em={type:"synccomplete"},ey=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],eb=ey.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class ew extends s.Mesh{constructor(){super(new ee,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=8421504,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=eh,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(eg),X({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);let r=this._queuedSyncs;r&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{r.forEach(e=>e&&e())})),this.dispatchEvent(em),e&&e()})))}onBeforeRender(e,t,r,a,n,i){this.sync(),n.isTroikaTextMaterial&&this._prepareForRender(n),n._hadOwnSide=n.hasOwnProperty("side"),this.geometry.setSide(n._actualSide=n.side),n.side=s.FrontSide}onAfterRender(e,t,r,a,n,i){n._hadOwnSide?n.side=n._actualSide:delete n.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let e=this._derivedMaterial,t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=eo.clone());if(e&&e.baseMaterial===t||(e=this._derivedMaterial=function(e){let t=function e(t,r){let a=function(e){let t=JSON.stringify(e,F),r=A.get(t);return null==r&&A.set(t,r=++E),r}(r),n=k.get(t);if(n||k.set(t,n=Object.create(null)),n[a])return new n[a];let i=`_onBeforeCompile${a}`,o=function(e,n){t.onBeforeCompile.call(this,e,n);let o=this.customProgramCacheKey()+"|"+e.vertexShader+"|"+e.fragmentShader,s=T[o];if(!s){let t=function(e,{vertexShader:t,fragmentShader:r},a,n){let{vertexDefs:i,vertexMainIntro:o,vertexMainOutro:s,vertexTransform:l,fragmentDefs:u,fragmentMainIntro:f,fragmentMainOutro:c,fragmentColorTransform:h,customRewriter:d,timeUniform:p}=a;if(i=i||"",o=o||"",s=s||"",u=u||"",f=f||"",c=c||"",(l||d)&&(t=S(t)),(h||d)&&(r=S(r=r.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n"))),d){let e=d({vertexShader:t,fragmentShader:r});t=e.vertexShader,r=e.fragmentShader}if(h){let e=[];r=r.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,t=>(e.push(t),"")),c=`${h}
${e.join("\n")}
${c}`}if(p){let e=`
uniform float ${p};
`;i=e+i,u=e+u}return l&&(t=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${t}
`,i=`${i}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,o=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${o}
`,t=t.replace(/\b(position|normal|uv)\b/g,(e,t,r,a)=>/\battribute\s+vec[23]\s+$/.test(a.substr(0,r))?t:`troika_${t}_${n}`),e.map&&e.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${n}`))),{vertexShader:t=M(t,n,i,o,s),fragmentShader:r=M(r,n,u,f,c)}}(this,e,r,a);s=T[o]=t}e.vertexShader=s.vertexShader,e.fragmentShader=s.fragmentShader,_(e.uniforms,this.uniforms),r.timeUniform&&(e.uniforms[r.timeUniform]={get value(){return Date.now()-U}}),this[i]&&this[i](e)},l=function(){return u(r.chained?t:t.clone())},u=function(e){let n=Object.create(e,f);return Object.defineProperty(n,"baseMaterial",{value:t}),Object.defineProperty(n,"id",{value:C++}),n.uuid=function(){let e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,a=4294967295*Math.random()|0;return(x[255&e]+x[e>>8&255]+x[e>>16&255]+x[e>>24&255]+"-"+x[255&t]+x[t>>8&255]+"-"+x[t>>16&15|64]+x[t>>24&255]+"-"+x[63&r|128]+x[r>>8&255]+"-"+x[r>>16&255]+x[r>>24&255]+x[255&a]+x[a>>8&255]+x[a>>16&255]+x[a>>24&255]).toUpperCase()}(),n.uniforms=_({},e.uniforms,r.uniforms),n.defines=_({},e.defines,r.defines),n.defines[`TROIKA_DERIVED_MATERIAL_${a}`]="",n.extensions=_({},e.extensions,r.extensions),n._listeners=void 0,n},f={constructor:{value:l},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return t.customProgramCacheKey()+"|"+a}},onBeforeCompile:{get:()=>o,set(e){this[i]=e}},copy:{writable:!0,configurable:!0,value:function(e){return t.copy.call(this,e),t.isShaderMaterial||t.isDerivedMaterial||(_(this.extensions,e.extensions),_(this.defines,e.defines),_(this.uniforms,s.UniformsUtils.clone(e.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){return u(new t.constructor).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let a=this._depthMaterial;return a||((a=this._depthMaterial=e(t.isDerivedMaterial?t.getDepthMaterial():new s.MeshDepthMaterial({depthPacking:s.RGBADepthPacking}),r)).defines.IS_DEPTH_MATERIAL="",a.uniforms=this.uniforms),a}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let a=this._distanceMaterial;return a||((a=this._distanceMaterial=e(t.isDerivedMaterial?t.getDistanceMaterial():new s.MeshDistanceMaterial,r)).defines.IS_DISTANCE_MATERIAL="",a.uniforms=this.uniforms),a}},dispose:{writable:!0,configurable:!0,value(){let{_depthMaterial:e,_distanceMaterial:r}=this;e&&e.dispose(),r&&r.dispose(),t.dispose.call(this)}}};return n[a]=l,new l}(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new s.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new s.Vector4(0,0,0,0)},uTroikaClipRect:{value:new s.Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new s.Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new s.Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new s.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:er,vertexTransform:ea,fragmentDefs:en,fragmentColorTransform:ei,customRewriter({vertexShader:e,fragmentShader:t}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(t)&&(t=t.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(e)||(e=e.replace(w,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:e,fragmentShader:t}}});return t.transparent=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}(t),t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),e.dispose()})),!this.outlineWidth&&!this.outlineBlur&&!this.outlineOffsetX&&!this.outlineOffsetY)return e;{let t=e._outlineMtl;return t||((t=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}})).isTextOutlineMaterial=!0,t.depthWrite=!1,t.map=null,e.addEventListener("dispose",function r(){e.removeEventListener("dispose",r),t.dispose()})),[t,e]}}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return ed(this.material).getDepthMaterial()}get customDistanceMaterial(){return ed(this.material).getDistanceMaterial()}_prepareForRender(e){let t=e.isTextOutlineMaterial,r=e.uniforms,a=this.textRenderInfo;if(a){let e,n,i;let{sdfTexture:o,blockBounds:s}=a;r.uTroikaSDFTexture.value=o,r.uTroikaSDFTextureSize.value.set(o.image.width,o.image.height),r.uTroikaSDFGlyphSize.value=a.sdfGlyphSize,r.uTroikaSDFExponent.value=a.sdfExponent,r.uTroikaTotalBounds.value.fromArray(s),r.uTroikaUseGlyphColors.value=!t&&!!a.glyphColors;let l=0,u=0,f=0,c=0,h=0;if(t){let{outlineWidth:t,outlineOffsetX:r,outlineOffsetY:a,outlineBlur:n,outlineOpacity:i}=this;l=this._parsePercent(t)||0,u=Math.max(0,this._parsePercent(n)||0),e=i,c=this._parsePercent(r)||0,h=this._parsePercent(a)||0}else(f=Math.max(0,this._parsePercent(this.strokeWidth)||0))&&(i=this.strokeColor,r.uTroikaStrokeColor.value.set(null==i?8421504:i),null==(n=this.strokeOpacity)&&(n=1)),e=this.fillOpacity;r.uTroikaDistanceOffset.value=l,r.uTroikaPositionOffset.value.set(c,h),r.uTroikaBlurRadius.value=u,r.uTroikaStrokeWidth.value=f,r.uTroikaStrokeOpacity.value=n,r.uTroikaFillOpacity.value=null==e?1:e,r.uTroikaCurveRadius.value=this.curveRadius||0;let d=this.clipRect;if(d&&Array.isArray(d)&&4===d.length)r.uTroikaClipRect.value.fromArray(d);else{let e=100*(this.fontSize||.1);r.uTroikaClipRect.value.set(s[0]-e,s[1]-e,s[2]+e,s[3]+e)}this.geometry.applyClipRect(r.uTroikaClipRect.value)}r.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;let n=t?this.outlineColor||0:this.color;if(null==n)delete e.color;else{let t=e.hasOwnProperty("color")?e.color:e.color=new s.Color;(n!==t._input||"object"==typeof n)&&t.set(t._input=n)}let i=this.orientation||eh;if(i!==e._orientation){let t=r.uTroikaOrient.value,a=(i=i.replace(/[^-+xyz]/g,""))!==eh&&i.match(/^([-+])([xyz])([-+])([xyz])$/);if(a){let[,e,r,n,i]=a;el.set(0,0,0)[r]="-"===e?1:-1,eu.set(0,0,0)[i]="-"===n?-1:1,es.lookAt(ec,el.cross(eu),eu),t.setFromMatrix4(es)}else t.identity();e._orientation=i}}_parsePercent(e){if("string"==typeof e){let t=e.match(/^(-?[\d.]+)%$/),r=t?parseFloat(t[1]):NaN;e=(isNaN(r)?0:r/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new s.Vector2){t.copy(e);let r=this.curveRadius;return r&&(t.x=Math.atan2(e.x,Math.abs(r)-Math.abs(e.z))*Math.abs(r)),t}worldPositionToTextCoords(e,t=new s.Vector2){return el.copy(e),this.localPositionToTextCoords(this.worldToLocal(el),t)}raycast(e,t){let{textRenderInfo:r,curveRadius:a}=this;if(r){let n=r.blockBounds,i=a?ev():ep(),o=i.geometry,{position:s,uv:l}=o.attributes;for(let e=0;e<l.count;e++){let t=n[0]+l.getX(e)*(n[2]-n[0]),r=n[1]+l.getY(e)*(n[3]-n[1]),i=0;a&&(i=a-Math.cos(t/a)*a,t=Math.sin(t/a)*a),s.setXYZ(e,t,r,i)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,i.matrixWorld=this.matrixWorld,i.material.side=this.material.side,ef.length=0,i.raycast(e,ef);for(let e=0;e<ef.length;e++)ef[e].object=this,t.push(ef[e])}}copy(e){let t=this.geometry;return super.copy(e),this.geometry=t,eb.forEach(t=>{this[t]=e[t]}),this}clone(){return new this.constructor().copy(this)}}ey.forEach(e=>{let t="_private_"+e;Object.defineProperty(ew.prototype,e,{get(){return this[t]},set(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})}),new WeakMap,new WeakMap;var eS=r(2955),ex=r(6187);let e_=o.forwardRef(({sdfGlyphSize:e=64,anchorX:t="center",anchorY:r="middle",font:a,fontSize:n=1,children:s,characters:l,onSync:u,...f},c)=>{let h=(0,eS.A)(({invalidate:e})=>e),[d]=o.useState(()=>new ew),[p,v]=o.useMemo(()=>{let e=[],t="";return o.Children.forEach(s,r=>{"string"==typeof r||"number"==typeof r?t+=r:e.push(r)}),[e,t]},[s]);return(0,ex.Rq)(()=>new Promise(e=>(function({font:e,characters:t,sdfGlyphSize:r},a){X({font:e,sdfGlyphSize:r,text:Array.isArray(t)?t.join("\n"):""+t},a)})({font:a,characters:l},e)),["troika-text",a,l]),o.useLayoutEffect(()=>void d.sync(()=>{h(),u&&u(d)})),o.useEffect(()=>()=>d.dispose(),[d]),o.createElement("primitive",(0,i.Z)({object:d,ref:c,font:a,text:v,anchorX:t,anchorY:r,fontSize:n,sdfGlyphSize:e},f),p)})},363:function(e,t,r){r.d(t,{q:function(){return rr},Z5:function(){return ew},q_:function(){return t6}});var a,n,i,o=r(2955),s=_(),l=e=>b(e,s),u=_();l.write=e=>b(e,u);var f=_();l.onStart=e=>b(e,f);var c=_();l.onFrame=e=>b(e,c);var h=_();l.onFinish=e=>b(e,h);var d=[];l.setTimeout=(e,t)=>{let r=l.now()+t,a=()=>{let e=d.findIndex(e=>e.cancel==a);~e&&d.splice(e,1),m-=~e?1:0},n={time:r,handler:e,cancel:a};return d.splice(p(r),0,n),m+=1,w(),n};var p=e=>~(~d.findIndex(t=>t.time>e)||~d.length);l.cancel=e=>{f.delete(e),c.delete(e),h.delete(e),s.delete(e),u.delete(e)},l.sync=e=>{y=!0,l.batchedUpdates(e),y=!1},l.throttle=e=>{let t;function r(){try{e(...t)}finally{t=null}}function a(...e){t=e,l.onStart(r)}return a.handler=e,a.cancel=()=>{f.delete(r),t=null},a};var v="undefined"!=typeof window?window.requestAnimationFrame:()=>{};l.use=e=>v=e,l.now="undefined"!=typeof performance?()=>performance.now():Date.now,l.batchedUpdates=e=>e(),l.catch=console.error,l.frameLoop="always",l.advance=()=>{"demand"!==l.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):x()};var g=-1,m=0,y=!1;function b(e,t){y?(t.delete(e),e(0)):(t.add(e),w())}function w(){g<0&&(g=0,"demand"!==l.frameLoop&&v(S))}function S(){~g&&(v(S),l.batchedUpdates(x))}function x(){let e=g,t=p(g=l.now());if(t&&(U(d.splice(0,t),e=>e.handler()),m-=t),!m){g=-1;return}f.flush(),s.flush(e?Math.min(64,g-e):16.667),c.flush(),u.flush(),h.flush()}function _(){let e=new Set,t=e;return{add(r){m+=t!=e||e.has(r)?0:1,e.add(r)},delete:r=>(m-=t==e&&e.has(r)?1:0,e.delete(r)),flush(r){t.size&&(e=new Set,m-=t.size,U(t,t=>t(r)&&e.add(t)),m+=e.size,t=e)}}}function U(e,t){e.forEach(e=>{try{t(e)}catch(e){l.catch(e)}})}var k=r(2265),T=Object.defineProperty,C={};function M(){}((e,t)=>{for(var r in t)T(e,r,{get:t[r],enumerable:!0})})(C,{assign:()=>V,colors:()=>L,createStringInterpolator:()=>a,skipAnimation:()=>G,to:()=>n,willAdvance:()=>z});var F=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),E={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,und:e=>void 0===e};function A(e,t){if(E.arr(e)){if(!E.arr(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return e===t}var I=(e,t)=>e.forEach(t);function R(e,t,r){if(E.arr(e)){for(let a=0;a<e.length;a++)t.call(r,e[a],`${a}`);return}for(let a in e)e.hasOwnProperty(a)&&t.call(r,e[a],a)}var P=e=>E.und(e)?[]:E.arr(e)?e:[e];function D(e,t){if(e.size){let r=Array.from(e);e.clear(),I(r,t)}}var O=(e,...t)=>D(e,e=>e(...t)),B=()=>"undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),L=null,G=!1,z=M,V=e=>{e.to&&(n=e.to),e.now&&(l.now=e.now),void 0!==e.colors&&(L=e.colors),null!=e.skipAnimation&&(G=e.skipAnimation),e.createStringInterpolator&&(a=e.createStringInterpolator),e.requestAnimationFrame&&l.use(e.requestAnimationFrame),e.batchedUpdates&&(l.batchedUpdates=e.batchedUpdates),e.willAdvance&&(z=e.willAdvance),e.frameLoop&&(l.frameLoop=e.frameLoop)},j=new Set,N=[],W=[],q=0,$={get idle(){return!j.size&&!N.length},start(e){q>e.priority?(j.add(e),l.onStart(X)):(H(e),l(Q))},advance:Q,sort(e){if(q)l.onFrame(()=>$.sort(e));else{let t=N.indexOf(e);~t&&(N.splice(t,1),Y(e))}},clear(){N=[],j.clear()}};function X(){j.forEach(H),j.clear(),l(Q)}function H(e){N.includes(e)||Y(e)}function Y(e){N.splice(function(e,t){let r=e.findIndex(t);return r<0?e.length:r}(N,t=>t.priority>e.priority),0,e)}function Q(e){let t=W;for(let r=0;r<N.length;r++){let a=N[r];q=a.priority,a.idle||(z(a),a.advance(e),a.idle||t.push(a))}return q=0,(W=N).length=0,(N=t).length>0}var Z=(e,t,r)=>Math.min(Math.max(r,e),t),K="[-+]?\\d*\\.?\\d+",J=K+"%";function ee(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}var et=RegExp("rgb"+ee(K,K,K)),er=RegExp("rgba"+ee(K,K,K,K)),ea=RegExp("hsl"+ee(K,J,J)),en=RegExp("hsla"+ee(K,J,J,K)),ei=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,eo=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,es=/^#([0-9a-fA-F]{6})$/,el=/^#([0-9a-fA-F]{8})$/;function eu(e,t,r){return(r<0&&(r+=1),r>1&&(r-=1),r<1/6)?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function ef(e,t,r){let a=r<.5?r*(1+t):r+t-r*t,n=2*r-a;return Math.round(255*eu(n,a,e+1/3))<<24|Math.round(255*eu(n,a,e))<<16|Math.round(255*eu(n,a,e-1/3))<<8}function ec(e){let t=parseInt(e,10);return t<0?0:t>255?255:t}function eh(e){return(parseFloat(e)%360+360)%360/360}function ed(e){let t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function ep(e){let t=parseFloat(e);return t<0?0:t>100?1:t/100}function ev(e){let t;let r="number"==typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=es.exec(e))?parseInt(t[1]+"ff",16)>>>0:L&&void 0!==L[e]?L[e]:(t=et.exec(e))?(ec(t[1])<<24|ec(t[2])<<16|ec(t[3])<<8|255)>>>0:(t=er.exec(e))?(ec(t[1])<<24|ec(t[2])<<16|ec(t[3])<<8|ed(t[4]))>>>0:(t=ei.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=el.exec(e))?parseInt(t[1],16)>>>0:(t=eo.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=ea.exec(e))?(255|ef(eh(t[1]),ep(t[2]),ep(t[3])))>>>0:(t=en.exec(e))?(ef(eh(t[1]),ep(t[2]),ep(t[3]))|ed(t[4]))>>>0:null;if(null===r)return e;let a=(4278190080&(r=r||0))>>>24,n=(16711680&r)>>>16,i=(65280&r)>>>8,o=(255&r)/255;return`rgba(${a}, ${n}, ${i}, ${o})`}var eg=(e,t,r)=>{if(E.fun(e))return e;if(E.arr(e))return eg({range:e,output:t,extrapolate:r});if(E.str(e.output[0]))return a(e);let n=e.output,i=e.range||[0,1],o=e.extrapolateLeft||e.extrapolate||"extend",s=e.extrapolateRight||e.extrapolate||"extend",l=e.easing||(e=>e);return t=>{let r=function(e,t){for(var r=1;r<t.length-1&&!(t[r]>=e);++r);return r-1}(t,i);return function(e,t,r,a,n,i,o,s,l){let u=l?l(e):e;if(u<t){if("identity"===o)return u;"clamp"===o&&(u=t)}if(u>r){if("identity"===s)return u;"clamp"===s&&(u=r)}return a===n?a:t===r?e<=t?a:n:(t===-1/0?u=-u:r===1/0?u-=t:u=(u-t)/(r-t),u=i(u),a===-1/0?u=-u:n===1/0?u+=a:u=u*(n-a)+a,u)}(t,i[r],i[r+1],n[r],n[r+1],l,o,s,e.map)}},em=2*Math.PI/3,ey=2*Math.PI/4.5,eb=e=>e<.36363636363636365?7.5625*e*e:e<.7272727272727273?7.5625*(e-=.5454545454545454)*e+.75:e<.9090909090909091?7.5625*(e-=.8181818181818182)*e+.9375:7.5625*(e-=.9545454545454546)*e+.984375,ew={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>2.70158*e*e*e-1.70158*e*e,easeOutBack:e=>1+2.70158*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(7.189819*e-2.5949095)/2:(Math.pow(2*e-2,2)*(3.5949095*(2*e-2)+2.5949095)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*em),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*em)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*ey))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*ey)/2+1,easeInBounce:e=>1-eb(1-e),easeOutBounce:eb,easeInOutBounce:e=>e<.5?(1-eb(1-2*e))/2:(1+eb(2*e-1))/2,steps:(e,t="end")=>r=>{let a=(r="end"===t?Math.min(r,.999):Math.max(r,.001))*e;return Z(0,1,("end"===t?Math.floor(a):Math.ceil(a))/e)}},eS=Symbol.for("FluidValue.get"),ex=Symbol.for("FluidValue.observers"),e_=e=>!!(e&&e[eS]),eU=e=>e&&e[eS]?e[eS]():e,ek=e=>e[ex]||null;function eT(e,t){let r=e[ex];r&&r.forEach(e=>{e.eventObserved?e.eventObserved(t):e(t)})}var eC=class{constructor(e){if(!e&&!(e=this.get))throw Error("Unknown getter");eM(this,e)}},eM=(e,t)=>eA(e,eS,t);function eF(e,t){if(e[eS]){let r=e[ex];r||eA(e,ex,r=new Set),!r.has(t)&&(r.add(t),e.observerAdded&&e.observerAdded(r.size,t))}return t}function eE(e,t){let r=e[ex];if(r&&r.has(t)){let a=r.size-1;a?r.delete(t):e[ex]=null,e.observerRemoved&&e.observerRemoved(a,t)}}var eA=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),eI=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,eR=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,eP=RegExp(`(${eI.source})(%|[a-z]+)`,"i"),eD=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,eO=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,eB=e=>{let[t,r]=eL(e);if(!t||B())return e;let a=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(a)return a.trim();if(r&&r.startsWith("--")){let e=window.getComputedStyle(document.documentElement).getPropertyValue(r);if(e)return e}else if(r&&eO.test(r))return eB(r);else if(r)return r;return e},eL=e=>{let t=eO.exec(e);if(!t)return[,];let[,r,a]=t;return[r,a]},eG=(e,t,r,a,n)=>`rgba(${Math.round(t)}, ${Math.round(r)}, ${Math.round(a)}, ${n})`,ez=e=>{i||(i=L?RegExp(`(${Object.keys(L).join("|")})(?!\\w)`,"g"):/^\b$/);let t=e.output.map(e=>eU(e).replace(eO,eB).replace(eR,ev).replace(i,ev)),r=t.map(e=>e.match(eI).map(Number)),a=r[0].map((e,t)=>r.map(e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})).map(t=>eg({...e,output:t}));return e=>{let r=!eP.test(t[0])&&t.find(e=>eP.test(e))?.replace(eI,""),n=0;return t[0].replace(eI,()=>`${a[n++](e)}${r||""}`).replace(eD,eG)}},eV="react-spring: ",ej=e=>{let t=!1;if("function"!=typeof e)throw TypeError(`${eV}once requires a function parameter`);return(...r)=>{t||(e(...r),t=!0)}},eN=ej(console.warn),eW=ej(console.warn);function eq(e){return E.str(e)&&("#"==e[0]||/\d/.test(e)||!B()&&eO.test(e)||e in(L||{}))}var e$=B()?k.useEffect:k.useLayoutEffect,eX=()=>{let e=(0,k.useRef)(!1);return e$(()=>(e.current=!0,()=>{e.current=!1}),[]),e};function eH(){let e=(0,k.useState)()[1],t=eX();return()=>{t.current&&e(Math.random())}}var eY=e=>(0,k.useEffect)(e,eQ),eQ=[];function eZ(e){let t=(0,k.useRef)();return(0,k.useEffect)(()=>{t.current=e}),t.current}var eK=Symbol.for("Animated:node"),eJ=e=>!!e&&e[eK]===e,e1=e=>e&&e[eK],e0=(e,t)=>F(e,eK,t),e2=e=>e&&e[eK]&&e[eK].getPayload(),e3=class{constructor(){e0(this,this)}getPayload(){return this.payload||[]}},e5=class extends e3{constructor(e){super(),this._value=e,this.done=!0,this.durationProgress=0,E.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new e5(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return E.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){let{done:e}=this;this.done=!1,E.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}},e4=class extends e5{constructor(e){super(0),this._string=null,this._toString=eg({output:[e,e]})}static create(e){return new e4(e)}getValue(){let e=this._string;return null==e?this._string=this._toString(this._value):e}setValue(e){if(E.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=eg({output:[this.getValue(),e]})),this._value=0,super.reset()}},e6={dependencies:null},e8=class extends e3{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){let t={};return R(this.source,(r,a)=>{eJ(r)?t[a]=r.getValue(e):e_(r)?t[a]=eU(r):e||(t[a]=r)}),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&I(this.payload,e=>e.reset())}_makePayload(e){if(e){let t=new Set;return R(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){e6.dependencies&&e_(e)&&e6.dependencies.add(e);let t=e2(e);t&&I(t,e=>this.add(e))}},e7=class extends e8{constructor(e){super(e)}static create(e){return new e7(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){let t=this.getPayload();return e.length==t.length?t.map((t,r)=>t.setValue(e[r])).some(Boolean):(super.setValue(e.map(e9)),!0)}};function e9(e){return(eq(e)?e4:e5).create(e)}function te(e){let t=e1(e);return t?t.constructor:E.arr(e)?e7:eq(e)?e4:e5}var tt=(e,t)=>{let r=!E.fun(e)||e.prototype&&e.prototype.isReactComponent;return(0,k.forwardRef)((a,n)=>{let i=(0,k.useRef)(null),o=r&&(0,k.useCallback)(e=>{i.current=(n&&(E.fun(n)?n(e):n.current=e),e)},[n]),[s,u]=function(e,t){let r=new Set;return e6.dependencies=r,e.style&&(e={...e,style:t.createAnimatedStyle(e.style)}),e=new e8(e),e6.dependencies=null,[e,r]}(a,t),f=eH(),c=()=>{let e=i.current;(!r||e)&&!1===(!!e&&t.applyAnimatedValues(e,s.getValue(!0)))&&f()},h=new tr(c,u),d=(0,k.useRef)();e$(()=>(d.current=h,I(u,e=>eF(e,h)),()=>{d.current&&(I(d.current.deps,e=>eE(e,d.current)),l.cancel(d.current.update))})),(0,k.useEffect)(c,[]),eY(()=>()=>{let e=d.current;I(e.deps,t=>eE(t,e))});let p=t.getComponentProps(s.getValue());return k.createElement(e,{...p,ref:o})})},tr=class{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&l.write(this.update)}},ta=Symbol.for("AnimatedComponent"),tn=e=>E.str(e)?e:e&&E.str(e.displayName)?e.displayName:E.fun(e)&&e.name||null;function ti(e,...t){return E.fun(e)?e(...t):e}var to=(e,t)=>!0===e||!!(t&&e&&(E.fun(e)?e(t):P(e).includes(t))),ts=(e,t)=>E.obj(e)?t&&e[t]:e,tl=(e,t)=>!0===e.default?e[t]:e.default?e.default[t]:void 0,tu=e=>e,tf=(e,t=tu)=>{let r=tc;e.default&&!0!==e.default&&(r=Object.keys(e=e.default));let a={};for(let n of r){let r=t(e[n],n);E.und(r)||(a[n]=r)}return a},tc=["config","onProps","onStart","onChange","onPause","onResume","onRest"],th={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function td(e){let t=function(e){let t={},r=0;if(R(e,(e,a)=>{!th[a]&&(t[a]=e,r++)}),r)return t}(e);if(t){let r={to:t};return R(e,(e,a)=>a in t||(r[a]=e)),r}return{...e}}function tp(e){return e=eU(e),E.arr(e)?e.map(tp):eq(e)?C.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function tv(e){return E.fun(e)||E.arr(e)&&E.obj(e[0])}var tg={tension:170,friction:26,mass:1,damping:1,easing:ew.linear,clamp:!1},tm=class{constructor(){this.velocity=0,Object.assign(this,tg)}};function ty(e,t){if(E.und(t.decay)){let r=!E.und(t.tension)||!E.und(t.friction);!r&&E.und(t.frequency)&&E.und(t.damping)&&E.und(t.mass)||(e.duration=void 0,e.decay=void 0),r&&(e.frequency=void 0)}else e.duration=void 0}var tb=[],tw=class{constructor(){this.changed=!1,this.values=tb,this.toValues=null,this.fromValues=tb,this.config=new tm,this.immediate=!1}};function tS(e,{key:t,props:r,defaultProps:a,state:n,actions:i}){return new Promise((o,s)=>{let u,f;let c=to(r.cancel??a?.cancel,t);if(c)p();else{E.und(r.pause)||(n.paused=to(r.pause,t));let e=a?.pause;!0!==e&&(e=n.paused||to(e,t)),u=ti(r.delay||0,t),e?(n.resumeQueue.add(d),i.pause()):(i.resume(),d())}function h(){n.resumeQueue.add(d),n.timeouts.delete(f),f.cancel(),u=f.time-l.now()}function d(){u>0&&!C.skipAnimation?(n.delayed=!0,f=l.setTimeout(p,u),n.pauseQueue.add(h),n.timeouts.add(f)):p()}function p(){n.delayed&&(n.delayed=!1),n.pauseQueue.delete(h),n.timeouts.delete(f),e<=(n.cancelId||0)&&(c=!0);try{i.start({...r,callId:e,cancel:c},o)}catch(e){s(e)}}})}var tx=(e,t)=>1==t.length?t[0]:t.some(e=>e.cancelled)?tk(e.get()):t.every(e=>e.noop)?t_(e.get()):tU(e.get(),t.every(e=>e.finished)),t_=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),tU=(e,t,r=!1)=>({value:e,finished:t,cancelled:r}),tk=e=>({value:e,cancelled:!0,finished:!1});function tT(e,t,r,a){let{callId:n,parentId:i,onRest:o}=t,{asyncTo:s,promise:u}=r;return i||e!==s||t.reset?r.promise=(async()=>{let f,c,h;r.asyncId=n,r.asyncTo=e;let d=tf(t,(e,t)=>"onRest"===t?void 0:e),p=new Promise((e,t)=>(f=e,c=t)),v=e=>{let t=n<=(r.cancelId||0)&&tk(a)||n!==r.asyncId&&tU(a,!1);if(t)throw e.result=t,c(e),e},g=(e,t)=>{let i=new tM,o=new tF;return(async()=>{if(C.skipAnimation)throw tC(r),o.result=tU(a,!1),c(o),o;v(i);let s=E.obj(e)?{...e}:{...t,to:e};s.parentId=n,R(d,(e,t)=>{E.und(s[t])&&(s[t]=e)});let l=await a.start(s);return v(i),r.paused&&await new Promise(e=>{r.resumeQueue.add(e)}),l})()};if(C.skipAnimation)return tC(r),tU(a,!1);try{let t;t=E.arr(e)?(async e=>{for(let t of e)await g(t)})(e):Promise.resolve(e(g,a.stop.bind(a))),await Promise.all([t.then(f),p]),h=tU(a.get(),!0,!1)}catch(e){if(e instanceof tM)h=e.result;else if(e instanceof tF)h=e.result;else throw e}finally{n==r.asyncId&&(r.asyncId=i,r.asyncTo=i?s:void 0,r.promise=i?u:void 0)}return E.fun(o)&&l.batchedUpdates(()=>{o(h,a,a.item)}),h})():u}function tC(e,t){D(e.timeouts,e=>e.cancel()),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}var tM=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},tF=class extends Error{constructor(){super("SkipAnimationSignal")}},tE=e=>e instanceof tI,tA=1,tI=class extends eC{constructor(){super(...arguments),this.id=tA++,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){let e=e1(this);return e&&e.getValue()}to(...e){return C.to(this,e)}interpolate(...e){return eN(`${eV}The "interpolate" function is deprecated in v9 (use "to" instead)`),C.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){eT(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||$.sort(this),eT(this,{type:"priority",parent:this,priority:e})}},tR=Symbol.for("SpringPhase"),tP=e=>(1&e[tR])>0,tD=e=>(2&e[tR])>0,tO=e=>(4&e[tR])>0,tB=(e,t)=>t?e[tR]|=3:e[tR]&=-3,tL=(e,t)=>t?e[tR]|=4:e[tR]&=-5,tG=class extends tI{constructor(e,t){if(super(),this.animation=new tw,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!E.und(e)||!E.und(t)){let r=E.obj(e)?{...e}:{...t,from:e};E.und(r.default)&&(r.default=!0),this.start(r)}}get idle(){return!(tD(this)||this._state.asyncTo)||tO(this)}get goal(){return eU(this.animation.to)}get velocity(){let e=e1(this);return e instanceof e5?e.lastVelocity||0:e.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return tP(this)}get isAnimating(){return tD(this)}get isPaused(){return tO(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,r=!1,a=this.animation,{toValues:n}=a,{config:i}=a,o=e2(a.to);!o&&e_(a.to)&&(n=P(eU(a.to))),a.values.forEach((s,l)=>{if(s.done)return;let u=s.constructor==e4?1:o?o[l].lastPosition:n[l],f=a.immediate,c=u;if(!f){let t;if(c=s.lastPosition,i.tension<=0){s.done=!0;return}let r=s.elapsedTime+=e,n=a.fromValues[l],o=null!=s.v0?s.v0:s.v0=E.arr(i.velocity)?i.velocity[l]:i.velocity,h=i.precision||(n==u?.005:Math.min(1,.001*Math.abs(u-n)));if(E.und(i.duration)){if(i.decay){let e=!0===i.decay?.998:i.decay,a=Math.exp(-(1-e)*r);c=n+o/(1-e)*(1-a),f=Math.abs(s.lastPosition-c)<=h,t=o*a}else{t=null==s.lastVelocity?o:s.lastVelocity;let r=i.restVelocity||h/10,a=i.clamp?0:i.bounce,l=!E.und(a),d=n==u?s.v0>0:n<u,p=Math.ceil(e/1);for(let e=0;e<p&&!(!(Math.abs(t)>r)&&(f=Math.abs(u-c)<=h));++e){l&&(c==u||c>u==d)&&(t=-t*a,c=u);let e=(-(1e-6*i.tension)*(c-u)+-(.001*i.friction)*t)/i.mass;t+=1*e,c+=1*t}}}else{let a=1;i.duration>0&&(this._memoizedDuration!==i.duration&&(this._memoizedDuration=i.duration,s.durationProgress>0&&(s.elapsedTime=i.duration*s.durationProgress,r=s.elapsedTime+=e)),a=(a=(i.progress||0)+r/this._memoizedDuration)>1?1:a<0?0:a,s.durationProgress=a),t=((c=n+i.easing(a)*(u-n))-s.lastPosition)/e,f=1==a}s.lastVelocity=t,Number.isNaN(c)&&(console.warn("Got NaN while animating:",this),f=!0)}o&&!o[l].done&&(f=!1),f?s.done=!0:t=!1,s.setValue(c,i.round)&&(r=!0)});let s=e1(this),l=s.getValue();if(t){let e=eU(a.to);(l!==e||r)&&!i.decay?(s.setValue(e),this._onChange(e)):r&&i.decay&&this._onChange(l),this._stop()}else r&&this._onChange(l)}set(e){return l.batchedUpdates(()=>{this._stop(),this._focus(e),this._set(e)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(tD(this)){let{to:e,config:t}=this.animation;l.batchedUpdates(()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()})}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let r;return E.und(e)?(r=this.queue||[],this.queue=[]):r=[E.obj(e)?e:{...t,to:e}],Promise.all(r.map(e=>this._update(e))).then(e=>tx(this,e))}stop(e){let{to:t}=this.animation;return this._focus(this.get()),tC(this._state,e&&this._lastCallId),l.batchedUpdates(()=>this._stop(t,e)),this}reset(){this._update({reset:!0})}eventObserved(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}_prepareNode(e){let t=this.key||"",{to:r,from:a}=e;(null==(r=E.obj(r)?r[t]:r)||tv(r))&&(r=void 0),null==(a=E.obj(a)?a[t]:a)&&(a=void 0);let n={to:r,from:a};return tP(this)||(e.reverse&&([r,a]=[a,r]),a=eU(a),E.und(a)?e1(this)||this._set(r):this._set(a)),n}_update({...e},t){let{key:r,defaultProps:a}=this;e.default&&Object.assign(a,tf(e,(e,t)=>/^on/.test(t)?ts(e,r):e)),tq(this,e,"onProps"),t$(this,"onProps",e,this);let n=this._prepareNode(e);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");let i=this._state;return tS(++this._lastCallId,{key:r,props:e,defaultProps:a,state:i,actions:{pause:()=>{tO(this)||(tL(this,!0),O(i.pauseQueue),t$(this,"onPause",tU(this,tz(this,this.animation.to)),this))},resume:()=>{tO(this)&&(tL(this,!1),tD(this)&&this._resume(),O(i.resumeQueue),t$(this,"onResume",tU(this,tz(this,this.animation.to)),this))},start:this._merge.bind(this,n)}}).then(r=>{if(e.loop&&r.finished&&!(t&&r.noop)){let t=tV(e);if(t)return this._update(t,!0)}return r})}_merge(e,t,r){if(t.cancel)return this.stop(!0),r(tk(this));let a=!E.und(e.to),n=!E.und(e.from);if(a||n){if(!(t.callId>this._lastToId))return r(tk(this));this._lastToId=t.callId}let{key:i,defaultProps:o,animation:s}=this,{to:u,from:f}=s,{to:c=u,from:h=f}=e;n&&!a&&(!t.default||E.und(c))&&(c=h),t.reverse&&([c,h]=[h,c]);let d=!A(h,f);d&&(s.from=h),h=eU(h);let p=!A(c,u);p&&this._focus(c);let v=tv(t.to),{config:g}=s,{decay:m,velocity:y}=g;(a||n)&&(g.velocity=0),t.config&&!v&&function(e,t,r){for(let a in r&&(ty(r={...r},t),t={...r,...t}),ty(e,t),Object.assign(e,t),tg)null==e[a]&&(e[a]=tg[a]);let{frequency:a,damping:n}=e,{mass:i}=e;E.und(a)||(a<.01&&(a=.01),n<0&&(n=0),e.tension=Math.pow(2*Math.PI/a,2)*i,e.friction=4*Math.PI*n*i/a)}(g,ti(t.config,i),t.config!==o.config?ti(o.config,i):void 0);let b=e1(this);if(!b||E.und(c))return r(tU(this,!0));let w=E.und(t.reset)?n&&!t.default:!E.und(h)&&to(t.reset,i),S=w?h:this.get(),x=tp(c),_=E.num(x)||E.arr(x)||eq(x),U=!v&&(!_||to(o.immediate||t.immediate,i));if(p){let e=te(c);if(e!==b.constructor){if(U)b=this._set(x);else throw Error(`Cannot animate between ${b.constructor.name} and ${e.name}, as the "to" prop suggests`)}}let k=b.constructor,T=e_(c),C=!1;if(!T){let e=w||!tP(this)&&d;(p||e)&&(T=!(C=A(tp(S),x))),(A(s.immediate,U)||U)&&A(g.decay,m)&&A(g.velocity,y)||(T=!0)}if(C&&tD(this)&&(s.changed&&!w?T=!0:T||this._stop(u)),!v&&((T||e_(u))&&(s.values=b.getPayload(),s.toValues=e_(c)?null:k==e4?[1]:P(x)),s.immediate==U||(s.immediate=U,U||w||this._set(u)),T)){let{onRest:e}=s;I(tW,e=>tq(this,t,e));let a=tU(this,tz(this,u));O(this._pendingCalls,a),this._pendingCalls.add(r),s.changed&&l.batchedUpdates(()=>{s.changed=!w,e?.(a,this),w?ti(o.onRest,a):s.onStart?.(a,this)})}w&&this._set(S),v?r(tT(t.to,t,this._state,this)):T?this._start():tD(this)&&!p?this._pendingCalls.add(r):r(t_(S))}_focus(e){let t=this.animation;e!==t.to&&(ek(this)&&this._detach(),t.to=e,ek(this)&&this._attach())}_attach(){let e=0,{to:t}=this.animation;e_(t)&&(eF(t,this),tE(t)&&(e=t.priority+1)),this.priority=e}_detach(){let{to:e}=this.animation;e_(e)&&eE(e,this)}_set(e,t=!0){let r=eU(e);if(!E.und(r)){let e=e1(this);if(!e||!A(r,e.getValue())){let a=te(r);e&&e.constructor==a?e.setValue(r):e0(this,a.create(r)),e&&l.batchedUpdates(()=>{this._onChange(r,t)})}}return e1(this)}_onStart(){let e=this.animation;e.changed||(e.changed=!0,t$(this,"onStart",tU(this,tz(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),ti(this.animation.onChange,e,this)),ti(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){let e=this.animation;e1(this).reset(eU(e.to)),e.immediate||(e.fromValues=e.values.map(e=>e.lastPosition)),tD(this)||(tB(this,!0),tO(this)||this._resume())}_resume(){C.skipAnimation?this.finish():$.start(this)}_stop(e,t){if(tD(this)){tB(this,!1);let r=this.animation;I(r.values,e=>{e.done=!0}),r.toValues&&(r.onChange=r.onPause=r.onResume=void 0),eT(this,{type:"idle",parent:this});let a=t?tk(this.get()):tU(this.get(),tz(this,e??r.to));O(this._pendingCalls,a),r.changed&&(r.changed=!1,t$(this,"onRest",a,this))}}};function tz(e,t){let r=tp(t);return A(tp(e.get()),r)}function tV(e,t=e.loop,r=e.to){let a=ti(t);if(a){let n=!0!==a&&td(a),i=(n||e).reverse,o=!n||n.reset;return tj({...e,loop:t,default:!1,pause:void 0,to:!i||tv(r)?r:void 0,from:o?e.from:void 0,reset:o,...n})}}function tj(e){let{to:t,from:r}=e=td(e),a=new Set;return E.obj(t)&&tN(t,a),E.obj(r)&&tN(r,a),e.keys=a.size?Array.from(a):null,e}function tN(e,t){R(e,(e,r)=>null!=e&&t.add(r))}var tW=["onStart","onRest","onChange","onPause","onResume"];function tq(e,t,r){e.animation[r]=t[r]!==tl(t,r)?ts(t[r],e.key):void 0}function t$(e,t,...r){e.animation[t]?.(...r),e.defaultProps[t]?.(...r)}var tX=["onStart","onChange","onRest"],tH=1,tY=class{constructor(e,t){this.id=tH++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){let e={};return this.each((t,r)=>e[r]=t.get()),e}set(e){for(let t in e){let r=e[t];E.und(r)||this.springs[t].set(r)}}update(e){return e&&this.queue.push(tj(e)),this}start(e){let{queue:t}=this;return(e?t=P(e).map(tj):this.queue=[],this._flush)?this._flush(this,t):(t2(this,t),tQ(this,t))}stop(e,t){if(!!e!==e&&(t=e),t){let r=this.springs;I(P(t),t=>r[t].stop(!!e))}else tC(this._state,this._lastAsyncId),this.each(t=>t.stop(!!e));return this}pause(e){if(E.und(e))this.start({pause:!0});else{let t=this.springs;I(P(e),e=>t[e].pause())}return this}resume(e){if(E.und(e))this.start({pause:!1});else{let t=this.springs;I(P(e),e=>t[e].resume())}return this}each(e){R(this.springs,e)}_onFrame(){let{onStart:e,onChange:t,onRest:r}=this._events,a=this._active.size>0,n=this._changed.size>0;(a&&!this._started||n&&!this._started)&&(this._started=!0,D(e,([e,t])=>{t.value=this.get(),e(t,this,this._item)}));let i=!a&&this._started,o=n||i&&r.size?this.get():null;n&&t.size&&D(t,([e,t])=>{t.value=o,e(t,this,this._item)}),i&&(this._started=!1,D(r,([e,t])=>{t.value=o,e(t,this,this._item)}))}eventObserved(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}l.onFrame(this._onFrame)}};function tQ(e,t){return Promise.all(t.map(t=>tZ(e,t))).then(t=>tx(e,t))}async function tZ(e,t,r){let{keys:a,to:n,from:i,loop:o,onRest:s,onResolve:u}=t,f=E.obj(t.default)&&t.default;o&&(t.loop=!1),!1===n&&(t.to=null),!1===i&&(t.from=null);let c=E.arr(n)||E.fun(n)?n:void 0;c?(t.to=void 0,t.onRest=void 0,f&&(f.onRest=void 0)):I(tX,r=>{let a=t[r];if(E.fun(a)){let n=e._events[r];t[r]=({finished:e,cancelled:t})=>{let r=n.get(a);r?(e||(r.finished=!1),t&&(r.cancelled=!0)):n.set(a,{value:null,finished:e||!1,cancelled:t||!1})},f&&(f[r]=t[r])}});let h=e._state;!h.paused===t.pause?(h.paused=t.pause,O(t.pause?h.pauseQueue:h.resumeQueue)):h.paused&&(t.pause=!0);let d=(a||Object.keys(e.springs)).map(r=>e.springs[r].start(t)),p=!0===t.cancel||!0===tl(t,"cancel");(c||p&&h.asyncId)&&d.push(tS(++e._lastAsyncId,{props:t,state:h,actions:{pause:M,resume:M,start(t,r){p?(tC(h,e._lastAsyncId),r(tk(e))):(t.onRest=s,r(tT(c,t,h,e)))}}})),h.paused&&await new Promise(e=>{h.resumeQueue.add(e)});let v=tx(e,await Promise.all(d));if(o&&v.finished&&!(r&&v.noop)){let r=tV(t,o,n);if(r)return t2(e,[r]),tZ(e,r,!0)}return u&&l.batchedUpdates(()=>u(v,e,e.item)),v}function tK(e,t){let r={...e.springs};return t&&I(P(t),e=>{E.und(e.keys)&&(e=tj(e)),E.obj(e.to)||(e={...e,to:void 0}),t0(r,e,e=>t1(e))}),tJ(e,r),r}function tJ(e,t){R(t,(t,r)=>{e.springs[r]||(e.springs[r]=t,eF(t,e))})}function t1(e,t){let r=new tG;return r.key=e,t&&eF(r,t),r}function t0(e,t,r){t.keys&&I(t.keys,a=>{(e[a]||(e[a]=r(a)))._prepareNode(t)})}function t2(e,t){I(t,t=>{t0(e.springs,t,t=>t1(t,e))})}var t3=({children:e,...t})=>{let r=(0,k.useContext)(t5),a=t.pause||!!r.pause,n=t.immediate||!!r.immediate;t=function(e,t){let[r]=(0,k.useState)(()=>({inputs:t,result:e()})),a=(0,k.useRef)(),n=a.current,i=n;return i?t&&i.inputs&&function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(t,i.inputs)||(i={inputs:t,result:e()}):i=r,(0,k.useEffect)(()=>{a.current=i,n==r&&(r.inputs=r.result=void 0)},[i]),i.result}(()=>({pause:a,immediate:n}),[a,n]);let{Provider:i}=t5;return k.createElement(i,{value:t},e)},t5=(Object.assign(t3,k.createContext({})),t3.Provider._context=t3,t3.Consumer._context=t3,t3);t3.Provider=t5.Provider,t3.Consumer=t5.Consumer;var t4=()=>{let e=[],t=function(t){eW(`${eV}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`);let a=[];return I(e,(e,n)=>{if(E.und(t))a.push(e.start());else{let i=r(t,e,n);i&&a.push(e.start(i))}}),a};t.current=e,t.add=function(t){e.includes(t)||e.push(t)},t.delete=function(t){let r=e.indexOf(t);~r&&e.splice(r,1)},t.pause=function(){return I(e,e=>e.pause(...arguments)),this},t.resume=function(){return I(e,e=>e.resume(...arguments)),this},t.set=function(t){I(e,(e,r)=>{let a=E.fun(t)?t(r,e):t;a&&e.set(a)})},t.start=function(t){let r=[];return I(e,(e,a)=>{if(E.und(t))r.push(e.start());else{let n=this._getProps(t,e,a);n&&r.push(e.start(n))}}),r},t.stop=function(){return I(e,e=>e.stop(...arguments)),this},t.update=function(t){return I(e,(e,r)=>e.update(this._getProps(t,e,r))),this};let r=function(e,t,r){return E.fun(e)?e(r,t):e};return t._getProps=r,t};function t6(e,t){let r=E.fun(e),[[a],n]=function(e,t,r){let a=E.fun(t)&&t;a&&!r&&(r=[]);let n=(0,k.useMemo)(()=>a||3==arguments.length?t4():void 0,[]),i=(0,k.useRef)(0),o=eH(),s=(0,k.useMemo)(()=>({ctrls:[],queue:[],flush(e,t){let r=tK(e,t);return!(i.current>0)||s.queue.length||Object.keys(r).some(t=>!e.springs[t])?new Promise(a=>{tJ(e,r),s.queue.push(()=>{a(tQ(e,t))}),o()}):tQ(e,t)}}),[]),l=(0,k.useRef)([...s.ctrls]),u=[],f=eZ(e)||0;function c(e,r){for(let n=e;n<r;n++){let e=l.current[n]||(l.current[n]=new tY(null,s.flush)),r=a?a(n,e):t[n];r&&(u[n]=function(e){let t=tj(e);return E.und(t.default)&&(t.default=tf(t)),t}(r))}}(0,k.useMemo)(()=>{I(l.current.slice(e,f),e=>{e.ref?.delete(e),n?.delete(e),e.stop(!0)}),l.current.length=e,c(f,e)},[e]),(0,k.useMemo)(()=>{c(0,Math.min(f,e))},r);let h=l.current.map((e,t)=>tK(e,u[t])),d=(0,k.useContext)(t3),p=eZ(d),v=d!==p&&function(e){for(let t in e)return!0;return!1}(d);e$(()=>{i.current++,s.ctrls=l.current;let{queue:e}=s;e.length&&(s.queue=[],I(e,e=>e())),I(l.current,(e,t)=>{n?.add(e),v&&e.start({default:d});let r=u[t];if(r){var a;(a=r.ref)&&e.ref!==a&&(e.ref?.delete(e),a.add(e),e.ref=a),e.ref?e.queue.push(r):e.start(r)}})}),eY(()=>()=>{I(s.ctrls,e=>e.stop(!0))});let g=h.map(e=>({...e}));return n?[g,n]:g}(1,r?e:[e],r?t||[]:t);return r||2==arguments.length?[a,n]:a}var t8=class extends tI{constructor(e,t){super(),this.source=e,this.idle=!0,this._active=new Set,this.calc=eg(...t);let r=this._get();e0(this,te(r).create(r))}advance(e){let t=this._get();A(t,this.get())||(e1(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&t9(this._active)&&re(this)}_get(){let e=E.arr(this.source)?this.source.map(eU):P(eU(this.source));return this.calc(...e)}_start(){this.idle&&!t9(this._active)&&(this.idle=!1,I(e2(this),e=>{e.done=!1}),C.skipAnimation?(l.batchedUpdates(()=>this.advance()),re(this)):$.start(this))}_attach(){let e=1;I(P(this.source),t=>{e_(t)&&eF(t,this),tE(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))}),this.priority=e,this._start()}_detach(){I(P(this.source),e=>{e_(e)&&eE(e,this)}),this._active.clear(),re(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=P(this.source).reduce((e,t)=>Math.max(e,(tE(t)?t.priority:0)+1),0))}};function t7(e){return!1!==e.idle}function t9(e){return!e.size||Array.from(e).every(t7)}function re(e){e.idle||(e.idle=!0,I(e2(e),e=>{e.done=!0}),eT(e,{type:"idle",parent:e}))}C.assign({createStringInterpolator:ez,to:(e,t)=>new t8(e,t)}),$.advance;var rt=["primitive"].concat(Object.keys(r(6375)).filter(e=>/^[A-Z]/.test(e)).map(e=>e[0].toLowerCase()+e.slice(1)));C.assign({createStringInterpolator:ez,colors:{transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},frameLoop:"demand"}),(0,o.n)(()=>{l.advance()});var rr=((e,{applyAnimatedValues:t=()=>!1,createAnimatedStyle:r=e=>new e8(e),getComponentProps:a=e=>e}={})=>{let n={applyAnimatedValues:t,createAnimatedStyle:r,getComponentProps:a},i=e=>{let t=tn(e)||"Anonymous";return(e=E.str(e)?i[e]||(i[e]=tt(e,n)):e[ta]||(e[ta]=tt(e,n))).displayName=`Animated(${t})`,e};return R(e,(t,r)=>{E.arr(e)&&(r=tn(t)),i[r]=i(t)}),{animated:i}})(rt,{applyAnimatedValues:o.j}).animated}}]);